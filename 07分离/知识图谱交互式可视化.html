<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Â¢ûÂº∫Áü•ËØÜÂõæË∞±‰∫§‰∫íÂºèÂèØËßÜÂåñ</title>
    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            overflow: hidden;
        }

        .container {
            display: flex;
            height: 100vh;
        }

        .sidebar {
            width: 350px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-right: 1px solid rgba(255, 255, 255, 0.2);
            overflow-y: auto;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
        }

        .main-content {
            flex: 1;
            position: relative;
            background: rgba(255, 255, 255, 0.1);
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .nav-menu {
            padding: 20px 0;
        }

        .nav-item {
            padding: 15px 20px;
            cursor: pointer;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .nav-item:hover {
            background: rgba(79, 172, 254, 0.1);
            transform: translateX(5px);
        }

        .nav-item.active {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            font-weight: bold;
        }

        .nav-item .icon {
            font-size: 18px;
            margin-right: 10px;
        }

        .nav-item .count {
            background: rgba(79, 172, 254, 0.2);
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
        }

        .nav-item.active .count {
            background: rgba(255, 255, 255, 0.3);
        }

        .content-panel {
            padding: 20px;
            height: calc(100vh - 140px);
            overflow-y: auto;
        }

        .panel {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .panel.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #4facfe;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 12px;
            color: #666;
        }

        .search-box {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 14px;
            margin-bottom: 20px;
            transition: border-color 0.3s ease;
        }

        .search-box:focus {
            outline: none;
            border-color: #4facfe;
        }

        .item-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .list-item {
            background: white;
            margin-bottom: 10px;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .list-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        }

        .item-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .item-details {
            font-size: 12px;
            color: #666;
        }

        .relation-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 16px;
            margin: 2px;
            font-weight: bold;
        }

        .disease-disease { background: #ff6b6b; color: white; }
        .disease-drug { background: #4ecdc4; color: white; }
        .disease-test { background: #45b7d1; color: white; }
        .drug-drug { background: #96ceb4; color: #333; }
        .drug-disease { background: #feca57; color: #333; }
        .test-test { background: #ff9ff3; color: #333; }
        .test-drug { background: #54a0ff; color: white; }
        .test-disease { background: #5f27cd; color: white; }

        .graph-container {
            width: 100%;
            height: 100%;
            position: relative;
        }

        .controls {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            gap: 10px;
        }

        .control-btn {
            background: rgba(255, 255, 255, 0.9);
            border: none;
            padding: 10px 15px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .control-btn:hover {
            background: white;
            transform: translateY(-2px);
        }

        .detail-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }

        .close-btn:hover {
            color: #333;
        }

        .parameter-section {
            margin-bottom: 20px;
        }

        .parameter-title {
            font-size: 18px;
            font-weight: bold;
            color: #4facfe;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }

        .parameter-content {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #4facfe;
        }

        .weight-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .weight-item {
            background: white;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #e0e0e0;
        }

        .weight-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }

        .weight-value {
            font-size: 14px;
            font-weight: bold;
            color: #333;
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
            font-size: 18px;
            color: #666;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #4facfe;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .filter-section {
            margin-bottom: 20px;
        }

        .filter-group {
            margin-bottom: 15px;
        }

        .filter-label {
            font-weight: bold;
            margin-bottom: 8px;
            display: block;
        }

        .filter-options {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }

        .filter-option {
            padding: 5px 10px;
            border: 1px solid #ddd;
            border-radius: 15px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .filter-option:hover {
            background: #f0f0f0;
        }

        .filter-option.active {
            background: #4facfe;
            color: white;
            border-color: #4facfe;
        }

        .hierarchy-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
        }

        .triangulated_verified { background: #28a745; }
        .non_triangulated { background: #ffc107; }
        .candidate_only { background: #dc3545; }

        /* ËØ¶ÊÉÖÈù¢ÊùøÊ†∑Âºè */
        .detail-section {
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border-left: 4px solid #4facfe;
        }

        .detail-section h4 {
            color: #4facfe;
            margin-bottom: 10px;
            font-size: 16px;
            font-weight: 600;
        }

        .detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .detail-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .detail-item strong {
            color: #333;
            display: block;
            font-size: 12px;
            margin-bottom: 4px;
        }

        .detail-item span {
            color: #666;
            font-size: 14px;
        }

        /* Ë¥®ÈáèÁ≠âÁ∫ßÈ¢úËâ≤ */
        .quality-platinum { color: #e5e4e2; font-weight: bold; }
        .quality-gold { color: #ffd700; font-weight: bold; }
        .quality-silver { color: #c0c0c0; font-weight: bold; }
        .quality-bronze { color: #cd7f32; font-weight: bold; }

        /* ÁÆóÊ≥ïÂàóË°®Ê†∑Âºè */
        .algorithm-list {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 5px;
        }

        .algorithm-tag {
            background: #4facfe;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }

        /* CPTÊï∞ÊçÆË°®Ê†ºÊ†∑Âºè */
        .cpt-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 6px;
            overflow: hidden;
        }

        .cpt-table th,
        .cpt-table td {
            padding: 8px 12px;
            text-align: left;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .cpt-table th {
            background: #4facfe;
            color: white;
            font-weight: 600;
            font-size: 12px;
        }

        .cpt-table td {
            font-size: 11px;
            color: #333;
        }

        /* ÊïàÂ∫îÁªüËÆ°Ê†∑Âºè */
        .effect-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 15px 0;
        }

        .stat-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-box .value {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-box .label {
            font-size: 12px;
            opacity: 0.9;
        }

        /* ÁΩÆ‰ø°Âå∫Èó¥Ê†∑Âºè */
        .confidence-interval {
            background: rgba(40, 167, 69, 0.1);
            border: 1px solid #28a745;
            border-radius: 6px;
            padding: 8px 12px;
            margin: 5px 0;
        }

        .confidence-interval .range {
            font-weight: bold;
            color: #28a745;
        }

        /* Ë∑ØÂæÑ‰ø°ÊÅØÊ†∑Âºè */
        .pathway-info {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
            padding: 12px;
            margin: 8px 0;
            border-left: 3px solid #ffc107;
        }

        .pathway-info .pathway-id {
            font-weight: bold;
            color: #4facfe;
            margin-bottom: 5px;
        }

        .pathway-info .pathway-desc {
            color: #666;
            font-size: 13px;
            margin-bottom: 8px;
        }

        .effect-values {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-top: 8px;
        }

        .effect-value {
            text-align: center;
            padding: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        .effect-value .type {
            font-size: 10px;
            color: #888;
            margin-bottom: 2px;
        }

        .effect-value .value {
            font-weight: bold;
            color: #333;
        }

        /* ÊòæËëóÊÄßÊåáÁ§∫Âô® */
        .significance-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 5px;
        }

        .significant { background: #28a745; }
        .not-significant { background: #dc3545; }

        /* ‰∏≠‰ªãÊïàÂ∫îËØ¶ÊÉÖÊ†∑Âºè */
        .mediation-section {
            margin-bottom: 25px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            border-left: 4px solid #4facfe;
        }

        .mediation-section h4 {
            color: #4facfe;
            margin-bottom: 15px;
            font-size: 18px;
            font-weight: 600;
            border-bottom: 2px solid rgba(79, 172, 254, 0.3);
            padding-bottom: 8px;
        }

        .stats-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            flex-wrap: wrap;
        }

        .stats-row span {
            flex: 1;
            min-width: 200px;
            margin-bottom: 5px;
        }

        .pathway-membership {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .membership-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 12px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .pathway-item {
            background: rgba(255, 255, 255, 0.08);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.15);
        }

        .pathway-item h5 {
            color: #4facfe;
            margin-bottom: 12px;
            font-size: 16px;
            font-weight: 600;
        }

        .effect-details {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .effect-row {
            margin-bottom: 10px;
            padding: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
            font-size: 14px;
            line-height: 1.4;
        }

        .mediation-stats {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .mediation-stats p {
            margin-bottom: 8px;
            font-size: 14px;
            line-height: 1.4;
        }

        .cpt-section {
            margin-bottom: 25px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            border-left: 4px solid #28a745;
        }

        .cpt-section h4 {
            color: #28a745;
            margin-bottom: 15px;
            font-size: 18px;
            font-weight: 600;
        }

        .cpt-nodes {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .cpt-node {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            font-size: 13px;
            line-height: 1.5;
        }

        /* Ê®°ÊÄÅÊ°ÜÊ†∑Âºè */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            margin: 2% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 1000px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .close-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            margin-top: 20px;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: #c82333;
            transform: translateY(-2px);
        }

        /* Ê®°ÊÄÅÊ°ÜÊ†∑Âºè */
        .detail-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: white;
            color: black;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 15px;
        }

        .modal-header h3 {
            color: #333;
            font-size: 20px;
            margin: 0;
        }

        .modal-header .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
            padding: 0;
            margin: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .modal-header .close-btn:hover {
            background: #f0f0f0;
            color: #333;
        }

        #modal-body {
            color: black;
        }

        #modal-body h3, #modal-body h4, #modal-body h5 {
            color: #333;
        }

        #modal-body p, #modal-body span, #modal-body div {
            color: #333;
        }

        .cpt-section {
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #4facfe;
        }

        .cpt-section h4 {
            color: #4facfe !important;
            margin-bottom: 15px;
            font-size: 18px;
            font-weight: 600;
            border-bottom: 2px solid rgba(79, 172, 254, 0.3);
            padding-bottom: 8px;
        }

        .cpt-section h5 {
            color: #333 !important;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .cpt-section p {
            color: #333 !important;
            margin-bottom: 8px;
            line-height: 1.5;
        }

        .effect-details {
            background: #f0f8ff;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .cpt-data {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }

        .cpt-nodes {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .cpt-node {
            background: white;
            padding: 12px;
            border-radius: 6px;
            border: 1px solid #e0e0e0;
            color: #333 !important;
        }

        .mediation-stats {
            background: #f0f8ff;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .stats-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            flex-wrap: wrap;
        }

        .stats-row span {
            flex: 1;
            min-width: 200px;
            margin-bottom: 5px;
            color: #333 !important;
        }

        /* ÂìçÂ∫îÂºèË∞ÉÊï¥ */
        @media (max-width: 768px) {
            .detail-grid {
                grid-template-columns: 1fr;
            }
            
            .effect-stats {
                grid-template-columns: 1fr;
            }
            
            .effect-values {
                grid-template-columns: 1fr;
            }

            .stats-row {
                flex-direction: column;
            }

            .stats-row span {
                min-width: auto;
            }

            .pathway-membership {
                grid-template-columns: 1fr;
            }

            .cpt-nodes {
                grid-template-columns: 1fr;
            }

            .modal-content {
                width: 95%;
                margin: 5% auto;
                padding: 20px;
            }
        }

        /* Â¢ûÂº∫ËäÇÁÇπËØ¶ÊÉÖÈù¢ÊùøÊ†∑Âºè */
        .node-influence-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .node-influence-section h4 {
            color: white;
            margin-bottom: 15px;
            font-size: 18px;
            font-weight: 600;
            border-bottom: 2px solid rgba(255, 255, 255, 0.3);
            padding-bottom: 8px;
        }

        .influence-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .influence-metric {
            background: rgba(255, 255, 255, 0.15);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .influence-metric .value {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
            color: #fff;
        }

        .influence-metric .label {
            font-size: 12px;
            opacity: 0.9;
            color: #fff;
        }

        .causal-paths-section {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(17, 153, 142, 0.3);
        }

        .causal-paths-section h4 {
            color: white;
            margin-bottom: 15px;
            font-size: 18px;
            font-weight: 600;
            border-bottom: 2px solid rgba(255, 255, 255, 0.3);
            padding-bottom: 8px;
        }

        .path-roles {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin-top: 15px;
        }

        .path-role {
            background: rgba(255, 255, 255, 0.15);
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .path-role .count {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 5px;
            color: #fff;
        }

        .path-role .role {
            font-size: 11px;
            opacity: 0.9;
            color: #fff;
        }

        .stability-section {
            background: linear-gradient(135deg, #fc466b 0%, #3f5efb 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(252, 70, 107, 0.3);
        }

        .stability-section h4 {
            color: white;
            margin-bottom: 15px;
            font-size: 18px;
            font-weight: 600;
            border-bottom: 2px solid rgba(255, 255, 255, 0.3);
            padding-bottom: 8px;
        }

        .stability-indicators {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .stability-indicator {
            background: rgba(255, 255, 255, 0.15);
            padding: 15px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
        }

        .stability-indicator .score {
            font-size: 22px;
            font-weight: bold;
            margin-bottom: 5px;
            color: #fff;
        }

        .stability-indicator .type {
            font-size: 12px;
            opacity: 0.9;
            color: #fff;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            margin-top: 8px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00d2ff 0%, #3a7bd5 100%);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .interactive-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }

        .interactive-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s ease;
            text-align: center;
        }

        .interactive-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .interactive-btn.focus { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); }
        .interactive-btn.subgraph { background: linear-gradient(135deg, #fc466b 0%, #3f5efb 100%); }
        .interactive-btn.export { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .interactive-btn.analyze { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }

        .enhanced-weights-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            border-left: 4px solid #ffc107;
        }

        .enhanced-weights-section h4 {
            color: #333 !important;
            margin-bottom: 15px;
            font-size: 18px;
            font-weight: 600;
            border-bottom: 2px solid rgba(255, 193, 7, 0.3);
            padding-bottom: 8px;
        }

        .weight-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .weight-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .weight-item .edge-info {
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .weight-item .weight-value {
            font-size: 18px;
            font-weight: bold;
            color: #4facfe;
            margin-bottom: 5px;
        }

        .weight-item .weight-details {
            font-size: 12px;
            color: #666;
            line-height: 1.4;
        }

        .enhanced-theta-section {
            background: #f0f8ff;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            border-left: 4px solid #28a745;
        }

        .enhanced-theta-section h4 {
            color: #28a745 !important;
            margin-bottom: 15px;
            font-size: 18px;
            font-weight: 600;
            border-bottom: 2px solid rgba(40, 167, 69, 0.3);
            padding-bottom: 8px;
        }

        .theta-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .theta-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .theta-item .node-info {
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .theta-item .stability-score {
            font-size: 16px;
            font-weight: bold;
            color: #28a745;
            margin-bottom: 5px;
        }

        .theta-item .method-count {
            font-size: 12px;
            color: #666;
            margin-bottom: 8px;
        }

        .enhanced-phi-section {
            background: #fff5f5;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            border-left: 4px solid #dc3545;
        }

        .enhanced-phi-section h4 {
            color: #dc3545 !important;
            margin-bottom: 15px;
            font-size: 18px;
            font-weight: 600;
            border-bottom: 2px solid rgba(220, 53, 69, 0.3);
            padding-bottom: 8px;
        }

        .phi-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .phi-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .phi-item .pathway-info {
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .phi-item .effect-strength {
            font-size: 16px;
            font-weight: bold;
            color: #dc3545;
            margin-bottom: 5px;
        }

        .phi-item .significance {
            font-size: 12px;
            color: #666;
            margin-bottom: 8px;
        }

        .neighbors-enhanced {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            border-left: 4px solid #6c757d;
        }

        .neighbors-enhanced h4 {
            color: #333 !important;
            margin-bottom: 15px;
            font-size: 18px;
            font-weight: 600;
            border-bottom: 2px solid rgba(108, 117, 125, 0.3);
            padding-bottom: 8px;
        }

        .neighbor-categories {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 15px;
        }

        .neighbor-category {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }

        .neighbor-category h5 {
            color: #333 !important;
            margin-bottom: 10px;
            font-size: 16px;
            font-weight: 600;
        }

        .neighbor-list {
            max-height: 200px;
            overflow-y: auto;
        }

        .neighbor-item {
            padding: 8px 12px;
            margin: 5px 0;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 3px solid #4facfe;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .neighbor-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }

        .neighbor-item .node-name {
            font-weight: bold;
            color: #333;
            font-size: 14px;
        }

        .neighbor-item .edge-weight {
            font-size: 12px;
            color: #666;
            margin-top: 2px;
        }

        /* ‰∏≠‰ªãÊïàÂ∫îÂèØËßÜÂåñÊéßÂà∂ÊåâÈíÆÊ†∑Âºè */
        .control-btn.mediation-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .control-btn.path-btn {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .control-btn.effect-btn {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .control-btn.mediation-btn:hover,
        .control-btn.path-btn:hover,
        .control-btn.effect-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        .control-btn.mediation-btn.active {
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
            box-shadow: 0 0 20px rgba(118, 75, 162, 0.5);
        }

        /* ‰∏≠‰ªãÊïàÂ∫îÂõæ‰æãÊ†∑Âºè */
        .mediation-legend {
            position: absolute;
            top: 60px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            border: 1px solid #e0e0e0;
            z-index: 1000;
            min-width: 200px;
        }

        .mediation-legend h4 {
            margin: 0 0 10px 0;
            font-size: 14px;
            font-weight: 600;
            color: #333;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            font-size: 12px;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 3px;
            margin-right: 8px;
            display: inline-block;
        }

        .legend-color.strong-mediation {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
        }

        .legend-color.moderate-mediation {
            background: linear-gradient(135deg, #feca57, #ff9ff3);
        }

        .legend-color.weak-mediation {
            background: linear-gradient(135deg, #48dbfb, #0abde3);
        }

        .legend-color.mediation-path {
            background: linear-gradient(135deg, #667eea, #764ba2);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ‰æßËæπÊ†è -->
        <div class="sidebar">
            <div class="header">
                <h1>üß† Áü•ËØÜÂõæË∞±ÂèØËßÜÂåñ</h1>
                <p>KG = (V, E_core, R, W, Œò, Œ¶)</p>
            </div>
            
            <div class="nav-menu">
                <div class="nav-item" data-panel="overview">
                    <span><span class="icon">üìä</span>Ê¶ÇËßàÁªüËÆ°</span>
                    <span class="count" id="overview-count">-</span>
                </div>
                <div class="nav-item" data-panel="vertices">
                    <span><span class="icon">üîµ</span>ËäÇÁÇπÈõÜÂêà (V)</span>
                    <span class="count" id="vertices-count">-</span>
                </div>
                <div class="nav-item" data-panel="edges">
                    <span><span class="icon">üîó</span>ËæπÈõÜÂêà (E_core)</span>
                    <span class="count" id="edges-count">-</span>
                </div>
                <div class="nav-item" data-panel="relations">
                    <span><span class="icon">üè∑Ô∏è</span>ÂÖ≥Á≥ªÁ±ªÂûã (R)</span>
                    <span class="count" id="relations-count">-</span>
                </div>
                <div class="nav-item" data-panel="weights">
                    <span><span class="icon">‚öñÔ∏è</span>ÊùÉÈáçÁ≥ªÁªü (W)</span>
                    <span class="count" id="weights-count">-</span>
                </div>
                <div class="nav-item" data-panel="mediation">
                    <span><span class="icon">üîÑ</span>ÂèÇÊï∞Â≠¶‰π† (Œò)</span>
                    <span class="count" id="mediation-count">-</span>
                </div>
                <div class="nav-item" data-panel="pathways">
                    <span><span class="icon">üõ§Ô∏è</span>Ë∑ØÂæÑÂàÜÊûê (Œ¶)</span>
                    <span class="count" id="pathways-count">-</span>
                </div>
                <div class="nav-item active" data-panel="graph">
                    <span><span class="icon">üåê</span>ÁΩëÁªúÂõæË∞±</span>
                    <span class="count">ÂèØËßÜÂåñ</span>
                </div>
            </div>
        </div>

        <!-- ‰∏ªÂÜÖÂÆπÂå∫ -->
        <div class="main-content">
            <div class="content-panel">
                <!-- Ê¶ÇËßàÈù¢Êùø -->
                <div class="panel" id="overview-panel">
                    <h2>üìä Áü•ËØÜÂõæË∞±Ê¶ÇËßàÁªüËÆ°</h2>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number" id="total-nodes">-</div>
                            <div class="stat-label">ÊÄªËäÇÁÇπÊï∞</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="total-edges">-</div>
                            <div class="stat-label">ÊÄªËæπÊï∞</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="total-relations">-</div>
                            <div class="stat-label">ÂÖ≥Á≥ªÁ±ªÂûã</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="triangulated-edges">-</div>
                            <div class="stat-label">‰∏âËßíÈ™åËØÅËæπ</div>
                        </div>
                    </div>
                    
                    <div class="parameter-section">
                        <div class="parameter-title">üìã Êï∞ÊçÆÊ∫ê‰ø°ÊÅØ</div>
                        <div class="parameter-content" id="metadata-info">
                            <div class="loading">
                                <div class="spinner"></div>
                                Ê≠£Âú®Âä†ËΩΩÊï∞ÊçÆ...
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ËäÇÁÇπÈù¢Êùø -->
                <div class="panel" id="vertices-panel">
                    <h2>üîµ ËäÇÁÇπÈõÜÂêà (V)</h2>
                    <input type="text" class="search-box" placeholder="ÊêúÁ¥¢ËäÇÁÇπ..." id="vertices-search">
                    
                    <div class="filter-section">
                        <div class="filter-group">
                            <label class="filter-label">ËäÇÁÇπÁ±ªÂûãÁ≠õÈÄâ:</label>
                            <div class="filter-options" id="vertex-type-filters">
                                <div class="filter-option active" data-type="all">ÂÖ®ÈÉ®</div>
                                <div class="filter-option" data-type="ÁñæÁóÖ">ÁñæÁóÖ</div>
                                <div class="filter-option" data-type="ËçØÁâ©">ËçØÁâ©</div>
                                <div class="filter-option" data-type="Ê£ÄÈ™å">Ê£ÄÈ™å</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="item-list" id="vertices-list">
                        <div class="loading">
                            <div class="spinner"></div>
                            Ê≠£Âú®Âä†ËΩΩËäÇÁÇπÊï∞ÊçÆ...
                        </div>
                    </div>
                </div>

                <!-- ËæπÈù¢Êùø -->
                <div class="panel" id="edges-panel">
                    <h2>üîó ËæπÈõÜÂêà (E_core)</h2>
                    <input type="text" class="search-box" placeholder="ÊêúÁ¥¢Ëæπ..." id="edges-search">
                    
                    <div class="filter-section">
                        <div class="filter-group">
                            <label class="filter-label">ËæπÂ±ÇÊ¨°Á≠õÈÄâ:</label>
                            <div class="filter-options" id="edge-hierarchy-filters">
                                <div class="filter-option active" data-hierarchy="all">ÂÖ®ÈÉ®</div>
                                <div class="filter-option" data-hierarchy="triangulated_verified">‰∏âËßíÈ™åËØÅ</div>
                                <div class="filter-option" data-hierarchy="non_triangulated">Èùû‰∏âËßíÈ™åËØÅ</div>
                            </div>
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">ÂÖ≥Á≥ªÁ±ªÂûãÁ≠õÈÄâ:</label>
                            <div class="filter-options" id="edge-relation-filters">
                                <!-- Âä®ÊÄÅÁîüÊàê -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="item-list" id="edges-list">
                        <div class="loading">
                            <div class="spinner"></div>
                            Ê≠£Âú®Âä†ËΩΩËæπÊï∞ÊçÆ...
                        </div>
                    </div>
                </div>

                <!-- ÂÖ≥Á≥ªÈù¢Êùø -->
                <div class="panel" id="relations-panel">
                    <h2>üè∑Ô∏è ÂÖ≥Á≥ªÁ±ªÂûã (R)</h2>
                    <div class="item-list" id="relations-list">
                        <div class="loading">
                            <div class="spinner"></div>
                            Ê≠£Âú®Âä†ËΩΩÂÖ≥Á≥ªÊï∞ÊçÆ...
                        </div>
                    </div>
                </div>

                <!-- ÊùÉÈáçÈù¢Êùø -->
                <div class="panel" id="weights-panel">
                    <h2>‚öñÔ∏è ÊùÉÈáçÁ≥ªÁªü (W)</h2>
                    <input type="text" class="search-box" placeholder="ÊêúÁ¥¢ÊùÉÈáç..." id="weights-search">
                    <div class="item-list" id="weights-list">
                        <div class="loading">
                            <div class="spinner"></div>
                            Ê≠£Âú®Âä†ËΩΩÊùÉÈáçÊï∞ÊçÆ...
                        </div>
                    </div>
                </div>

                <!-- ÂèÇÊï∞Â≠¶‰π†Èù¢Êùø -->
                <div class="panel" id="mediation-panel">
                    <h2>üîÑ ÂèÇÊï∞Â≠¶‰π† (Œò)</h2>
                    <input type="text" class="search-box" placeholder="ÊêúÁ¥¢ÂèÇÊï∞Â≠¶‰π†..." id="mediation-search">
                    <div class="item-list" id="mediation-list">
                        <div class="loading">
                            <div class="spinner"></div>
                            Ê≠£Âú®Âä†ËΩΩ‰∏≠‰ªãÊïàÂ∫îÊï∞ÊçÆ...
                        </div>
                    </div>
                </div>

                <!-- Ë∑ØÂæÑÂàÜÊûêÈù¢Êùø -->
                <div class="panel" id="pathways-panel">
                    <h2>üõ§Ô∏è Ë∑ØÂæÑÂàÜÊûê (Œ¶)</h2>
                    <input type="text" class="search-box" placeholder="ÊêúÁ¥¢Ë∑ØÂæÑ..." id="pathways-search">
                    <div class="item-list" id="pathways-list">
                        <div class="loading">
                            <div class="spinner"></div>
                            Ê≠£Âú®Âä†ËΩΩË∑ØÂæÑÊï∞ÊçÆ...
                        </div>
                    </div>
                </div>

                <!-- ÁΩëÁªúÂõæË∞±Èù¢Êùø -->
                <div class="panel active" id="graph-panel">
                    <div class="graph-container">
                        <div class="mediation-legend" id="mediation-legend" style="display: none;">
                            <h4>‰∏≠‰ªãÊïàÂ∫îÂõæ‰æã</h4>
                            <div class="legend-item">
                                <span class="legend-color strong-mediation"></span>
                                <span>Âº∫‰∏≠‰ªãÊïàÂ∫î (|Œ¶| > 0.5)</span>
                            </div>
                            <div class="legend-item">
                                <span class="legend-color moderate-mediation"></span>
                                <span>‰∏≠Á≠â‰∏≠‰ªãÊïàÂ∫î (0.2 < |Œ¶| ‚â§ 0.5)</span>
                            </div>
                            <div class="legend-item">
                                <span class="legend-color weak-mediation"></span>
                                <span>Âº±‰∏≠‰ªãÊïàÂ∫î (|Œ¶| ‚â§ 0.2)</span>
                            </div>
                            <div class="legend-item">
                                <span class="legend-color mediation-path"></span>
                                <span>‰∏≠‰ªãË∑ØÂæÑ</span>
                            </div>
                        </div>
                        <div id="graph-viz"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ËØ¶ÊÉÖÊ®°ÊÄÅÊ°Ü -->
    <div class="detail-modal" id="detail-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">ËØ¶ÁªÜ‰ø°ÊÅØ</h3>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div id="modal-body">
                <!-- Âä®ÊÄÅÂÜÖÂÆπ -->
            </div>
        </div>
    </div>

    <script>
        // ÂÖ®Â±ÄÂèòÈáè
        let knowledgeGraph = null;
        let graphInstance = null;
        let currentFilter = {
            vertices: { type: 'all' },
            edges: { hierarchy: 'all', relation: 'all' }
        };

        // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOMÂÜÖÂÆπÂä†ËΩΩÂÆåÊàêÔºåÂºÄÂßãÂàùÂßãÂåñ...');
            
            // ÊòæÁ§∫Âä†ËΩΩÁä∂ÊÄÅ
            const loadingIndicator = document.createElement('div');
            loadingIndicator.id = 'loading-indicator';
            loadingIndicator.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(0,0,0,0.8);
                color: white;
                padding: 20px;
                border-radius: 8px;
                z-index: 9999;
                font-size: 16px;
            `;
            loadingIndicator.textContent = 'Ê≠£Âú®Âä†ËΩΩÁü•ËØÜÂõæË∞±Êï∞ÊçÆ...';
            document.body.appendChild(loadingIndicator);
            
            // Âª∂ËøüÊâßË°åÊï∞ÊçÆÂä†ËΩΩÔºåÁ°Æ‰øùDOMÂÆåÂÖ®ÂáÜÂ§áÂ•Ω
            setTimeout(() => {
                loadKnowledgeGraph().then(() => {
                    console.log('Êï∞ÊçÆÂä†ËΩΩÂíåÂàùÂßãÂåñÂÆåÊàê');
                    // ÁßªÈô§Âä†ËΩΩÊåáÁ§∫Âô®
                    const indicator = document.getElementById('loading-indicator');
                    if (indicator) {
                        document.body.removeChild(indicator);
                    }
                }).catch(error => {
                    console.error('ÂàùÂßãÂåñÂ§±Ë¥•:', error);
                    const indicator = document.getElementById('loading-indicator');
                    if (indicator) {
                        indicator.textContent = 'Âä†ËΩΩÂ§±Ë¥•: ' + error.message;
                        indicator.style.background = 'rgba(255,0,0,0.8)';
                    }
                });
            }, 100);
            
            setupEventListeners();
        });

        // Âä†ËΩΩÁü•ËØÜÂõæË∞±Êï∞ÊçÆ
        async function loadKnowledgeGraph() {
            try {
                console.log('ÂºÄÂßãÂä†ËΩΩÁü•ËØÜÂõæË∞±Êï∞ÊçÆ...');
                const response = await fetch('Â¢ûÂº∫Áü•ËØÜÂõæË∞±ÂÆåÊï¥ÁªìÊûÑ.json');
                console.log('ÂìçÂ∫îÁä∂ÊÄÅ:', response.status, response.ok);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                knowledgeGraph = await response.json();
                
                console.log('Áü•ËØÜÂõæË∞±Êï∞ÊçÆÂä†ËΩΩÊàêÂäü:', knowledgeGraph);
                console.log('Êï∞ÊçÆÈîÆ:', Object.keys(knowledgeGraph));
                console.log('VÊï∞ÊçÆÈïøÂ∫¶:', knowledgeGraph.V ? knowledgeGraph.V.length : '‰∏çÂ≠òÂú®');
                console.log('E_coreÊï∞ÊçÆÈïøÂ∫¶:', knowledgeGraph.E_core ? knowledgeGraph.E_core.length : '‰∏çÂ≠òÂú®');
                
                // ÊµãËØïÊùÉÈáçÊï∞ÊçÆ
                if (knowledgeGraph.E_core && knowledgeGraph.E_core.length > 0) {
                    const firstEdge = knowledgeGraph.E_core[0];
                    console.log('Á¨¨‰∏ÄÊù°Ëæπ:', firstEdge);
                    if (firstEdge.weight_ref) {
                        console.log('Á¨¨‰∏ÄÊù°ËæπÁöÑÊùÉÈáçÊï∞ÊçÆ:', knowledgeGraph[firstEdge.weight_ref]);
                    }
                }
                
                // Êõ¥Êñ∞ÁªüËÆ°‰ø°ÊÅØ
                updateOverviewStats();
                
                // ÂàùÂßãÂåñÂêÑ‰∏™Èù¢Êùø
                initializeVerticesPanel();
                initializeEdgesPanel();
                initializeRelationsPanel();
                initializeWeightsPanel();
                initializeMediationPanel();
                initializePathwaysPanel();
                initializeGraphPanel();
                
                // ÊµãËØïÊùÉÈáçÊï∞ÊçÆ
                testWeightData();
                
            } catch (error) {
                console.error('Âä†ËΩΩÁü•ËØÜÂõæË∞±Êï∞ÊçÆÂ§±Ë¥•:', error);
                showError('Êï∞ÊçÆÂä†ËΩΩÂ§±Ë¥•ÔºåËØ∑Ê£ÄÊü•Êñá‰ª∂Ë∑ØÂæÑ: ' + error.message);
            }
        }

        // ËÆæÁΩÆ‰∫ã‰ª∂ÁõëÂê¨Âô®
        function setupEventListeners() {
            // ÂØºËà™ËèúÂçïÁÇπÂáª
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', function() {
                    const panel = this.dataset.panel;
                    switchPanel(panel);
                });
            });

            // ÊêúÁ¥¢Ê°Ü‰∫ã‰ª∂
            setupSearchListeners();
            
            // Á≠õÈÄâÂô®‰∫ã‰ª∂
            setupFilterListeners();

            // Ê®°ÊÄÅÊ°ÜÂÖ≥Èó≠
            document.getElementById('detail-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeModal();
                }
            });
        }

        // ÂàáÊç¢Èù¢Êùø
        function switchPanel(panelName) {
            // Êõ¥Êñ∞ÂØºËà™Áä∂ÊÄÅ
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`[data-panel="${panelName}"]`).classList.add('active');

            // ÊòæÁ§∫ÂØπÂ∫îÈù¢Êùø
            document.querySelectorAll('.panel').forEach(panel => {
                panel.classList.remove('active');
            });
            document.getElementById(`${panelName}-panel`).classList.add('active');
        }

        // Êõ¥Êñ∞Ê¶ÇËßàÁªüËÆ°
        function updateOverviewStats() {
            if (!knowledgeGraph) return;

            const vertices = knowledgeGraph.V || [];
            const edges = knowledgeGraph.E_core || [];
            
            // ÁªüËÆ°ÂÖ≥Á≥ªÁ±ªÂûã
            const relationTypes = new Set();
            edges.forEach(edge => {
                if (edge.relation_type) {
                    relationTypes.add(edge.relation_type);
                }
            });

            // ÁªüËÆ°‰∏âËßíÈ™åËØÅËæπ
            const triangulatedEdges = edges.filter(edge => 
                edge.edge_hierarchy === 'triangulated_verified'
            ).length;

            // Êõ¥Êñ∞ÊòæÁ§∫
            document.getElementById('total-nodes').textContent = vertices.length;
            document.getElementById('total-edges').textContent = edges.length;
            document.getElementById('total-relations').textContent = relationTypes.size;
            document.getElementById('triangulated-edges').textContent = triangulatedEdges;

            // Êõ¥Êñ∞ÂØºËà™ËÆ°Êï∞
            document.getElementById('vertices-count').textContent = vertices.length;
            document.getElementById('edges-count').textContent = edges.length;
            document.getElementById('relations-count').textContent = relationTypes.size;

            // Êõ¥Êñ∞ÂÖÉÊï∞ÊçÆ‰ø°ÊÅØ
            const metadataInfo = document.getElementById('metadata-info');
            if (knowledgeGraph.metadata) {
                metadataInfo.innerHTML = `
                    <div><strong>ÂàõÂª∫Êó∂Èó¥:</strong> ${knowledgeGraph.metadata.creation_time || 'Êú™Áü•'}</div>
                    <div><strong>ÊèèËø∞:</strong> ${knowledgeGraph.metadata.description || 'Êó†ÊèèËø∞'}</div>
                    <div><strong>ÂÄôÈÄâËæπÊï∞:</strong> ${knowledgeGraph.metadata.data_sources?.candidate_edges || 'Êú™Áü•'}</div>
                    <div><strong>Á≤æÁÆÄËæπÊï∞:</strong> ${knowledgeGraph.metadata.data_sources?.refined_edges || 'Êú™Áü•'}</div>
                    <div><strong>‰∏âËßíÈ™åËØÅËæπÊï∞:</strong> ${knowledgeGraph.metadata.data_sources?.triangulation_edges || 'Êú™Áü•'}</div>
                `;
            }
        }

        // ÂàùÂßãÂåñËäÇÁÇπÈù¢Êùø
        function initializeVerticesPanel() {
            if (!knowledgeGraph || !knowledgeGraph.V) return;

            const verticesList = document.getElementById('vertices-list');
            const vertices = knowledgeGraph.V;

            let html = '';
            vertices.forEach((vertex, index) => {
                const type = vertex.split('_')[0];
                const name = vertex.split('_').slice(1).join('_');
                
                html += `
                    <div class="list-item vertex-item" data-type="${type}" onclick="showVertexDetails('${vertex}')">
                        <div class="item-title">${vertex}</div>
                        <div class="item-details">
                            Á±ªÂûã: ${type} | Á¥¢Âºï: ${index}
                        </div>
                    </div>
                `;
            });

            verticesList.innerHTML = html;
        }

        // ÂàùÂßãÂåñËæπÈù¢Êùø
        function initializeEdgesPanel() {
            if (!knowledgeGraph || !knowledgeGraph.E_core) return;

            const edgesList = document.getElementById('edges-list');
            const edges = knowledgeGraph.E_core;

            // Ëé∑ÂèñÊâÄÊúâÂÖ≥Á≥ªÁ±ªÂûãÁî®‰∫éÁ≠õÈÄâÂô®
            const relationTypes = new Set();
            edges.forEach(edge => {
                if (edge.relation_type) {
                    relationTypes.add(edge.relation_type);
                }
            });

            // Êõ¥Êñ∞ÂÖ≥Á≥ªÁ±ªÂûãÁ≠õÈÄâÂô®
            const relationFilters = document.getElementById('edge-relation-filters');
            let filterHtml = '<div class="filter-option active" data-relation="all">ÂÖ®ÈÉ®</div>';
            relationTypes.forEach(type => {
                filterHtml += `<div class="filter-option" data-relation="${type}">${type}</div>`;
            });
            relationFilters.innerHTML = filterHtml;

            // Ê∏≤ÊüìËæπÂàóË°®
            renderEdgesList(edges);
        }

        // Ê∏≤ÊüìËæπÂàóË°®
        function renderEdgesList(edges) {
            const edgesList = document.getElementById('edges-list');
            
            let html = '';
            edges.forEach((edge, index) => {
                const hierarchyClass = edge.edge_hierarchy || 'unknown';
                const relationType = edge.relation_type || 'unknown';
                
                html += `
                    <div class="list-item edge-item" 
                         data-hierarchy="${hierarchyClass}" 
                         data-relation="${relationType}"
                         onclick="showEdgeDetails('${edge.source}', '${edge.target}')">
                        <div class="item-title">
                            <span class="hierarchy-indicator ${hierarchyClass}"></span>
                            ${edge.source} ‚Üí ${edge.target}
                        </div>
                        <div class="item-details">
                            <span class="relation-badge ${relationType}">${relationType}</span>
                            Â±ÇÊ¨°: ${edge.edge_hierarchy} | Áõ¥Êé•: ${edge.is_direct ? 'ÊòØ' : 'Âê¶'}
                        </div>
                    </div>
                `;
            });

            edgesList.innerHTML = html;
        }

        // ÂàùÂßãÂåñÂÖ≥Á≥ªÈù¢Êùø
        function initializeRelationsPanel() {
            if (!knowledgeGraph || !knowledgeGraph.E_core) return;

            const relationsList = document.getElementById('relations-list');
            const edges = knowledgeGraph.E_core;

            // ÁªüËÆ°ÂÖ≥Á≥ªÁ±ªÂûã
            const relationStats = {};
            edges.forEach(edge => {
                const type = edge.relation_type || 'unknown';
                if (!relationStats[type]) {
                    relationStats[type] = {
                        count: 0,
                        triangulated: 0,
                        direct: 0
                    };
                }
                relationStats[type].count++;
                if (edge.edge_hierarchy === 'triangulated_verified') {
                    relationStats[type].triangulated++;
                }
                if (edge.is_direct) {
                    relationStats[type].direct++;
                }
            });

            let html = '';
            Object.entries(relationStats).forEach(([type, stats]) => {
                html += `
                    <div class="list-item" onclick="showRelationDetails('${type}')">
                        <div class="item-title">
                            <span class="relation-badge ${type}">${type}</span>
                        </div>
                        <div class="item-details">
                            ÊÄªÊï∞: ${stats.count} | ‰∏âËßíÈ™åËØÅ: ${stats.triangulated} | Áõ¥Êé•ÂÖ≥Á≥ª: ${stats.direct}
                        </div>
                    </div>
                `;
            });

            relationsList.innerHTML = html;
            document.getElementById('relations-count').textContent = Object.keys(relationStats).length;
        }

        // ÂàùÂßãÂåñÊùÉÈáçÈù¢Êùø
        function initializeWeightsPanel() {
            console.log('ÊùÉÈáçÈù¢Êùø: ÂºÄÂßãÂàùÂßãÂåñ');
            
            const weightsList = document.getElementById('weights-list');
            const weightsCount = document.getElementById('weights-count');
            
            if (!weightsList) {
                console.error('ÊùÉÈáçÈù¢Êùø: weights-listÂÖÉÁ¥†‰∏çÂ≠òÂú®');
                return;
            }
            
            if (!knowledgeGraph) {
                console.log('ÊùÉÈáçÈù¢Êùø: knowledgeGraph‰∏çÂ≠òÂú®');
                weightsList.innerHTML = '<div class="list-item">Êï∞ÊçÆÊú™Âä†ËΩΩ</div>';
                if (weightsCount) weightsCount.textContent = '0';
                return;
            }
            
            if (!knowledgeGraph.E_core) {
                console.log('ÊùÉÈáçÈù¢Êùø: E_coreÊï∞ÊçÆ‰∏çÂ≠òÂú®');
                weightsList.innerHTML = '<div class="list-item">ËæπÊï∞ÊçÆ‰∏çÂ≠òÂú®</div>';
                if (weightsCount) weightsCount.textContent = '0';
                return;
            }

            if (!knowledgeGraph.W) {
                console.log('ÊùÉÈáçÈù¢Êùø: WÊùÉÈáçÊï∞ÊçÆ‰∏çÂ≠òÂú®');
                weightsList.innerHTML = '<div class="list-item">ÊùÉÈáçÊï∞ÊçÆ‰∏çÂ≠òÂú®</div>';
                if (weightsCount) weightsCount.textContent = '0';
                return;
            }

            console.log('ÊùÉÈáçÈù¢Êùø: ËæπÊï∞ÊçÆ:', knowledgeGraph.E_core.length, 'Êù°Ëæπ');
            console.log('ÊùÉÈáçÈù¢Êùø: Áü•ËØÜÂõæË∞±ÊâÄÊúâÈîÆ:', Object.keys(knowledgeGraph));
            console.log('ÊùÉÈáçÈù¢Êùø: WÊùÉÈáçÊï∞ÊçÆÈîÆ:', Object.keys(knowledgeGraph.W));
            
            // Êü•ÊâæÊâÄÊúâÊùÉÈáçÊï∞ÊçÆÈîÆ - ‰ªéWÂØπË±°‰∏≠Ëé∑Âèñ
            const allWeightKeys = Object.keys(knowledgeGraph.W);
            console.log('ÊùÉÈáçÈù¢Êùø: ÊâæÂà∞ÊùÉÈáçÊï∞ÊçÆÈîÆ', allWeightKeys.length, '‰∏™');
            console.log('ÊùÉÈáçÈù¢Êùø: ÊùÉÈáçÊï∞ÊçÆÈîÆÁ§∫‰æã:', allWeightKeys.slice(0, 5));
            
            let html = '';
            let weightCount = 0;
            let edgesWithWeightRef = 0;
            let edgesWithActualData = 0;

            // ‰ªéËæπÊï∞ÊçÆ‰∏≠ÊèêÂèñÊùÉÈáç‰ø°ÊÅØ
            knowledgeGraph.E_core.forEach((edge, index) => {
                if (edge.weight_ref) {
                    edgesWithWeightRef++;
                    console.log(`ÊùÉÈáçÈù¢Êùø: Ëæπ${index} - ÊâæÂà∞ÊùÉÈáçÂºïÁî®:`, edge.weight_ref, 'ÂØπ‰∫éËæπ:', edge.source, '->', edge.target);
                    const weightData = knowledgeGraph.W[edge.weight_ref];  // ‰øÆÂ§çÔºö‰ªéWÂØπË±°‰∏≠Ëé∑ÂèñÊùÉÈáçÊï∞ÊçÆ
                    
                    if (weightData) {
                        edgesWithActualData++;
                        weightCount++;
                        console.log(`ÊùÉÈáçÈù¢Êùø: Ëæπ${index} - ÊùÉÈáçÊï∞ÊçÆÂ≠òÂú®ÔºåÈîÆ:`, Object.keys(weightData));
                        
                        // ÊèêÂèñÊùÉÈáç‰ø°ÊÅØ
                        const baseWeight = weightData.base_weight || {};
                        const candidateDetails = weightData.candidate_details || {};
                        const hierarchyWeight = weightData.hierarchy_weight || {};
                        const triangulationWeights = weightData.triangulation_weights || {};
                        
                        console.log(`ÊùÉÈáçÈù¢Êùø: Ëæπ${index} - Âü∫Á°ÄÊùÉÈáç:`, baseWeight);
                        
                        // Ëé∑ÂèñË¥®ÈáèÁ≠âÁ∫ßÂØπÂ∫îÁöÑÈ¢úËâ≤
                        const qualityColors = {
                            'platinum': '#e5e4e2',
                            'gold': '#ffd700', 
                            'silver': '#c0c0c0',
                            'bronze': '#cd7f32'
                        };
                        const qualityColor = qualityColors[baseWeight.quality_level] || '#95a5a6';
                        
                        html += `
                            <div class="list-item" onclick="showWeightDetails('${edge.weight_ref}')">
                                <div class="item-title">${edge.source} ‚Üí ${edge.target}</div>
                                <div class="item-details">
                                    <span style="background: ${qualityColor}; padding: 2px 6px; border-radius: 3px; color: #333;">
                                        ${baseWeight.quality_level || 'Êú™Áü•'}
                                    </span> | 
                                    ÁªºÂêàËØÑÂàÜ: ${baseWeight.integrated_score?.toFixed(4) || 'Êú™Áü•'} | 
                                    ÊîØÊåÅÁÆóÊ≥ï: ${baseWeight.support_algorithm_count || 0} | 
                                    ÊúÄÁªàÊùÉÈáç: ${hierarchyWeight.final_weight?.toFixed(4) || 'Êú™Áü•'} |
                                    ‰∏âËßíÈ™åËØÅ: ${triangulationWeights.joint_confidence ? '‚úÖ' : '‚ùå'}
                                </div>
                            </div>
                        `;
                    } else {
                        console.log(`ÊùÉÈáçÈù¢Êùø: Ëæπ${index} - ÊùÉÈáçÊï∞ÊçÆ‰∏çÂ≠òÂú®ÔºåÂºïÁî®:`, edge.weight_ref);
                    }
                } else {
                    console.log(`ÊùÉÈáçÈù¢Êùø: Ëæπ${index} - Êó†ÊùÉÈáçÂºïÁî®:`, edge.source, '->', edge.target);
                }
            });

            console.log(`ÊùÉÈáçÈù¢ÊùøÁªüËÆ°: ÊÄªËæπÊï∞=${knowledgeGraph.E_core.length}, ÊúâÊùÉÈáçÂºïÁî®=${edgesWithWeightRef}, ÊúâÂÆûÈôÖÊï∞ÊçÆ=${edgesWithActualData}, ÊúÄÁªàÊùÉÈáçÊï∞=${weightCount}`);
            
            if (html) {
                weightsList.innerHTML = html;
                console.log('ÊùÉÈáçÈù¢Êùø: HTMLÂÜÖÂÆπÂ∑≤ËÆæÁΩÆÔºåÈïøÂ∫¶:', html.length);
            } else {
                weightsList.innerHTML = '<div class="list-item">Êú™ÊâæÂà∞ÊùÉÈáçÊï∞ÊçÆ</div>';
                console.log('ÊùÉÈáçÈù¢Êùø: Êú™ÊâæÂà∞ÊùÉÈáçÊï∞ÊçÆÔºåÊòæÁ§∫ÈªòËÆ§Ê∂àÊÅØ');
            }
            
            // Êõ¥Êñ∞ÂØºËà™Ê†è‰∏≠ÁöÑËÆ°Êï∞
            if (weightsCount) {
                weightsCount.textContent = weightCount;
                console.log('ÊùÉÈáçÈù¢Êùø: Êõ¥Êñ∞ËÆ°Êï∞‰∏∫:', weightCount);
            }
        }

        // ÊµãËØïÂáΩÊï∞ - Ê£ÄÊü•ÊùÉÈáçÊï∞ÊçÆ
        function testWeightData() {
            console.log('=== ÊùÉÈáçÊï∞ÊçÆÊµãËØï ===');
            console.log('knowledgeGraphÂ≠òÂú®:', !!knowledgeGraph);
            if (knowledgeGraph) {
                console.log('knowledgeGraphÊâÄÊúâÈîÆ:', Object.keys(knowledgeGraph));
                console.log('E_coreÂ≠òÂú®:', !!knowledgeGraph.E_core);
                if (knowledgeGraph.E_core) {
                    console.log('E_coreÈïøÂ∫¶:', knowledgeGraph.E_core.length);
                    
                    // Ê£ÄÊü•ÂâçÂá†Êù°ËæπÁöÑÊùÉÈáçÂºïÁî®
                    for (let i = 0; i < Math.min(5, knowledgeGraph.E_core.length); i++) {
                        const edge = knowledgeGraph.E_core[i];
                        console.log(`Ëæπ ${i}:`, edge.source, '->', edge.target);
                        console.log(`  weight_ref:`, edge.weight_ref);
                        if (edge.weight_ref) {
                            const weightData = knowledgeGraph[edge.weight_ref];
                            console.log(`  ÊùÉÈáçÊï∞ÊçÆÂ≠òÂú®:`, !!weightData);
                            if (weightData) {
                                console.log(`  ÊùÉÈáçÊï∞ÊçÆÈîÆ:`, Object.keys(weightData));
                            }
                        }
                    }
                    
                    // Êü•ÊâæÊâÄÊúâÂåÖÂê´'->'ÁöÑÈîÆÔºàÊùÉÈáçÊï∞ÊçÆÈîÆÔºâ
                    const weightKeys = Object.keys(knowledgeGraph).filter(key => key.includes('->'));
                    console.log('ÊâæÂà∞ÊùÉÈáçÊï∞ÊçÆÈîÆ:', weightKeys.length, '‰∏™');
                    console.log('ÊùÉÈáçÊï∞ÊçÆÈîÆÁ§∫‰æã:', weightKeys.slice(0, 5));
                    
                    const edgesWithWeightRef = knowledgeGraph.E_core.filter(e => e.weight_ref);
                    console.log('Êúâweight_refÁöÑËæπÊï∞Èáè:', edgesWithWeightRef.length);
                    if (edgesWithWeightRef.length > 0) {
                        console.log('Á¨¨‰∏Ä‰∏™Êúâweight_refÁöÑËæπ:', edgesWithWeightRef[0]);
                        // ÊµãËØïÁ¨¨‰∏Ä‰∏™ÊùÉÈáçÊï∞ÊçÆÊòØÂê¶Â≠òÂú®
                        const firstWeightRef = edgesWithWeightRef[0].weight_ref;
                        console.log('Á¨¨‰∏Ä‰∏™ÊùÉÈáçÊï∞ÊçÆÂ≠òÂú®:', !!knowledgeGraph[firstWeightRef]);
                        if (knowledgeGraph[firstWeightRef]) {
                            console.log('Á¨¨‰∏Ä‰∏™ÊùÉÈáçÊï∞ÊçÆÂÜÖÂÆπ:', knowledgeGraph[firstWeightRef]);
                        }
                    }
                }
            }
            console.log('=== ÊµãËØïÁªìÊùü ===');
        }

        // ÊòæÁ§∫ÊùÉÈáçËØ¶ÊÉÖ
        function showWeightDetails(weightRef) {
            console.log('=== showWeightDetails ÂºÄÂßã ===');
            console.log('showWeightDetails Ë¢´Ë∞ÉÁî®ÔºåÂèÇÊï∞:', weightRef);
            console.log('knowledgeGraph Â≠òÂú®:', !!knowledgeGraph);
            
            const modal = document.getElementById('detail-modal');
            const title = document.getElementById('modal-title');
            const body = document.getElementById('modal-body');

            if (!modal || !title || !body) {
                console.error('Ê®°ÊÄÅÊ°ÜÂÖÉÁ¥†‰∏çÂ≠òÂú®:', {modal: !!modal, title: !!title, body: !!body});
                alert('Ê®°ÊÄÅÊ°ÜÂÖÉÁ¥†‰∏çÂ≠òÂú®ÔºåËØ∑Ê£ÄÊü•È°µÈù¢ÁªìÊûÑ');
                return;
            }

            title.textContent = `ÊùÉÈáçËØ¶ÊÉÖ: ${weightRef}`;
            
            if (!knowledgeGraph) {
                console.error('knowledgeGraph ‰∏çÂ≠òÂú®');
                body.innerHTML = '<div class="parameter-section"><div class="parameter-content">Áü•ËØÜÂõæË∞±Êï∞ÊçÆÊú™Âä†ËΩΩ</div></div>';
                modal.style.display = 'flex';
                return;
            }
            
            if (!knowledgeGraph.W) {
                console.error('knowledgeGraph.W ‰∏çÂ≠òÂú®');
                body.innerHTML = '<div class="parameter-section"><div class="parameter-content">ÊùÉÈáçÊï∞ÊçÆÊú™Âä†ËΩΩ</div></div>';
                modal.style.display = 'flex';
                return;
            }
            
            console.log('knowledgeGraph.W ÈîÆÊï∞Èáè:', Object.keys(knowledgeGraph.W).length);
            console.log('Êü•ÊâæÊùÉÈáçÊï∞ÊçÆ:', weightRef);
            
            const weightData = knowledgeGraph.W[weightRef];  // ‰øÆÂ§çÔºö‰ªéWÂØπË±°‰∏≠Ëé∑ÂèñÊùÉÈáçÊï∞ÊçÆ
            console.log('ÊùÉÈáçÊï∞ÊçÆÂ≠òÂú®:', !!weightData);
            
            if (!weightData) {
                console.error('ÊùÉÈáçÊï∞ÊçÆ‰∏çÂ≠òÂú®:', weightRef);
                const availableWeightKeys = Object.keys(knowledgeGraph.W);
                console.error('ÂèØÁî®ÁöÑÊùÉÈáçÈîÆÊï∞Èáè:', availableWeightKeys.length);
                console.error('ÂèØÁî®ÁöÑÊùÉÈáçÈîÆÁ§∫‰æã:', availableWeightKeys.slice(0, 10));
                
                body.innerHTML = `
                    <div class="parameter-section">
                        <div class="parameter-content">
                            <div style="color: red;">Êú™ÊâæÂà∞ÊùÉÈáçÊï∞ÊçÆ: ${weightRef}</div>
                            <div style="margin-top: 10px;">ÂèØÁî®ÊùÉÈáçÈîÆÊï∞Èáè: ${availableWeightKeys.length}</div>
                            <div style="margin-top: 5px; font-size: 12px; color: #666;">
                                Á§∫‰æãÈîÆ: ${availableWeightKeys.slice(0, 3).join(', ')}
                            </div>
                        </div>
                    </div>
                `;
                modal.style.display = 'flex';
                return;
            }
            
            console.log('ÊùÉÈáçÊï∞ÊçÆÂÜÖÂÆπ:', weightData);
            console.log('ÊùÉÈáçÊï∞ÊçÆÈîÆ:', Object.keys(weightData));
            
            const baseWeight = weightData.base_weight || {};
            const candidateDetails = weightData.candidate_details || {};
            const hierarchyWeight = weightData.hierarchy_weight || {};
            const triangulationWeights = weightData.triangulation_weights || {};
            const weightParams = weightData.weight_params || {};
            
            console.log('Âü∫Á°ÄÊùÉÈáç:', baseWeight);
            console.log('ÂÄôÈÄâËØ¶ÊÉÖ:', candidateDetails);
            console.log('Â±ÇÊ¨°ÊùÉÈáç:', hierarchyWeight);
            console.log('‰∏âËßíÈ™åËØÅÊùÉÈáç:', triangulationWeights);
            console.log('ÊùÉÈáçÂèÇÊï∞:', weightParams);
            
            body.innerHTML = `
                <div class="parameter-section">
                    <div class="parameter-title">‚öñÔ∏è Âü∫Á°ÄÊùÉÈáç (Base Weight)</div>
                    <div class="parameter-content">
                        <div><strong>Ë¥®ÈáèÁ≠âÁ∫ß:</strong> ${baseWeight.quality_level || 'Êú™Áü•'}</div>
                        <div><strong>ÁªºÂêàËØÑÂàÜ:</strong> ${baseWeight.integrated_score?.toFixed(4) || 'Êú™Áü•'}</div>
                        <div><strong>ÊîØÊåÅÁÆóÊ≥ïÊï∞Èáè:</strong> ${baseWeight.support_algorithm_count || 0}</div>
                    </div>
                </div>
                
                <div class="parameter-section">
                    <div class="parameter-title">üìä ÂÄôÈÄâËØ¶ÊÉÖ (Candidate Details)</div>
                    <div class="parameter-content">
                        <div><strong>È¢ëÁéáËØÑÂàÜ:</strong> ${candidateDetails.frequency_score?.toFixed(4) || 'Êú™Áü•'}</div>
                        <div><strong>Â§öÊ†∑ÊÄßËØÑÂàÜ:</strong> ${candidateDetails.diversity_score?.toFixed(4) || 'Êú™Áü•'}</div>
                        <div><strong>ÁªºÂêàËØÑÂàÜ:</strong> ${candidateDetails.comprehensive_score?.toFixed(4) || 'Êú™Áü•'}</div>
                        <div><strong>ÁÆóÊ≥ï‰∏ÄËá¥ÊÄß:</strong> ${candidateDetails.algorithm_consistency?.toFixed(4) || 'Êú™Áü•'}</div>
                        <div><strong>ÁΩëÁªúÊãìÊâë:</strong> ${candidateDetails.network_topology?.toFixed(4) || 'Êú™Áü•'}</div>
                        <div><strong>ÁªüËÆ°ÊòæËëóÊÄß:</strong> ${candidateDetails.statistical_significance?.toFixed(4) || 'Êú™Áü•'}</div>
                        <div><strong>ÊîØÊåÅÁÆóÊ≥ï:</strong> ${candidateDetails.support_algorithms ? candidateDetails.support_algorithms.join(', ') : 'Êú™Áü•'}</div>
                    </div>
                </div>
                
                <div class="parameter-section">
                    <div class="parameter-title">üèóÔ∏è Â±ÇÊ¨°ÊùÉÈáç (Hierarchy Weight)</div>
                    <div class="parameter-content">
                        <div><strong>Âü∫Á°ÄËØÑÂàÜ:</strong> ${hierarchyWeight.base_score?.toFixed(4) || 'Êú™Áü•'}</div>
                        <div><strong>Ë¥®ÈáèÊùÉÈáç:</strong> ${hierarchyWeight.quality_weight?.toFixed(4) || 'Êú™Áü•'}</div>
                        <div><strong>‰∏âËßíÈ™åËØÅÂ•ñÂä±:</strong> ${hierarchyWeight.triangulation_bonus?.toFixed(4) || 'Êú™Áü•'}</div>
                        <div><strong>ÁÆóÊ≥ïÊùÉÈáç:</strong> ${hierarchyWeight.algorithm_weight?.toFixed(4) || 'Êú™Áü•'}</div>
                        <div><strong>ÊúÄÁªàÊùÉÈáç:</strong> ${hierarchyWeight.final_weight?.toFixed(4) || 'Êú™Áü•'}</div>
                    </div>
                </div>
                
                <div class="parameter-section">
                    <div class="parameter-title">üî∫ ‰∏âËßíÈ™åËØÅÊùÉÈáç (Triangulation Weights)</div>
                    <div class="parameter-content">
                        <div><strong>ËÅîÂêàÁΩÆ‰ø°Â∫¶:</strong> ${triangulationWeights.joint_confidence?.toFixed(4) || 'Êú™Áü•'}</div>
                        <div><strong>Ë¥®ÈáèË∞ÉÊï¥ÁΩÆ‰ø°Â∫¶:</strong> ${triangulationWeights.quality_adjusted_confidence?.toFixed(4) || 'Êú™Áü•'}</div>
                        ${triangulationWeights.four_dimension_scores ? `
                            <div style="margin-top: 10px;"><strong>ÂõõÁª¥ËØÑÂàÜ:</strong></div>
                            <div style="margin-left: 15px;">
                                <div><strong>ÁªìÊûÑ‰∏ÄËá¥ÊÄß:</strong> ${triangulationWeights.four_dimension_scores.structural_consistency?.toFixed(4) || 'Êú™Áü•'}</div>
                                <div><strong>ÂèÇÊï∞ÊãüÂêà:</strong> ${triangulationWeights.four_dimension_scores.parameter_fitting?.toFixed(4) || 'Êú™Áü•'}</div>
                                <div><strong>‰∏≠‰ªãÊîØÊåÅ:</strong> ${triangulationWeights.four_dimension_scores.mediation_support?.toFixed(4) || 'Êú™Áü•'}</div>
                                <div><strong>‰∏ìÂÆ∂ÊñπÂêë:</strong> ${triangulationWeights.four_dimension_scores.expert_direction?.toFixed(4) || 'Êú™Áü•'}</div>
                            </div>
                        ` : `
                            <div style="margin-top: 10px;"><strong>ÂõõÁª¥ËØÑÂàÜ:</strong></div>
                            <div style="margin-left: 15px;">
                                <div><strong>ÁªìÊûÑ‰∏ÄËá¥ÊÄß:</strong> Êú™Áü•</div>
                                <div><strong>ÂèÇÊï∞ÊãüÂêà:</strong> Êú™Áü•</div>
                                <div><strong>‰∏≠‰ªãÊîØÊåÅ:</strong> Êú™Áü•</div>
                                <div><strong>‰∏ìÂÆ∂ÊñπÂêë:</strong> Êú™Áü•</div>
                            </div>
                        `}
                    </div>
                </div>
                
                <div class="parameter-section">
                    <div class="parameter-title">‚öôÔ∏è ÊùÉÈáçÂèÇÊï∞ (Weight Params)</div>
                    <div class="parameter-content">
                        <div><strong>Âü∫Á°ÄÊùÉÈáçÊØî‰æã:</strong> ${weightParams.base_weight?.toFixed(4) || 'Êú™Áü•'}</div>
                        <div><strong>ÂÄôÈÄâÊùÉÈáçÊØî‰æã:</strong> ${weightParams.candidate_weight?.toFixed(4) || 'Êú™Áü•'}</div>
                        <div><strong>‰∏âËßíÈ™åËØÅÊùÉÈáçÊØî‰æã:</strong> ${weightParams.triangulation_weight?.toFixed(4) || 'Êú™Áü•'}</div>
                    </div>
                </div>
            `;

            console.log('Ê®°ÊÄÅÊ°ÜÂÜÖÂÆπÂ∑≤ËÆæÁΩÆÔºåÊòæÁ§∫Ê®°ÊÄÅÊ°Ü');
            modal.style.display = 'flex';
            console.log('=== showWeightDetails ÁªìÊùü ===');
        }

        // ÂàùÂßãÂåñÊù°‰ª∂Ê¶ÇÁéáË°®Èù¢Êùø (ŒòÈù¢Êùø)
        function initializeMediationPanel() {
            console.log('ŒòÈù¢Êùø: ÂºÄÂßãÂàùÂßãÂåñÊù°‰ª∂Ê¶ÇÁéáË°®Èù¢Êùø');
            
            const mediationList = document.getElementById('mediation-list');
            const mediationCount = document.getElementById('mediation-count');
            
            if (!mediationList) {
                console.error('ŒòÈù¢Êùø: mediation-listÂÖÉÁ¥†‰∏çÂ≠òÂú®');
                return;
            }
            
            if (!knowledgeGraph) {
                console.log('ŒòÈù¢Êùø: knowledgeGraph‰∏çÂ≠òÂú®');
                mediationList.innerHTML = '<div class="list-item">Êï∞ÊçÆÊú™Âä†ËΩΩ</div>';
                if (mediationCount) mediationCount.textContent = '0';
                return;
            }

            if (!knowledgeGraph.Theta) {
                console.log('ŒòÈù¢Êùø: ThetaÊï∞ÊçÆ‰∏çÂ≠òÂú®');
                mediationList.innerHTML = '<div class="list-item">Êú™ÊâæÂà∞ThetaÊï∞ÊçÆ</div>';
                if (mediationCount) mediationCount.textContent = '0';
                return;
            }

            console.log('ŒòÈù¢Êùø: ThetaÊï∞ÊçÆÈîÆÊï∞Èáè:', Object.keys(knowledgeGraph.Theta).length);
            
            let html = '';
            let cptCount = 0;

            // ÈÅçÂéÜThetaÊï∞ÊçÆÔºåÊòæÁ§∫ÂõõÁßçÊñπÊ≥ïÁöÑÊù°‰ª∂Ê¶ÇÁéáË°®„ÄÅËæπÈôÖ‰ººÁÑ∂Â¢ûÁõä„ÄÅÂèÇÊï∞Á®≥ÂÆöÊÄß
            Object.keys(knowledgeGraph.Theta).forEach(key => {
                const data = knowledgeGraph.Theta[key];
                if (data && typeof data === 'object') {
                    console.log(`ŒòÈù¢Êùø: Â§ÑÁêÜÊï∞ÊçÆ ${key}:`, data);
                    cptCount++;
                    
                    const paramLearning = data.parameter_learning || {};
                    const paramStability = data.parameter_stability || {};
                    const methodEstimates = data.method_estimates || {};
                    
                    // Ëé∑ÂèñÂèØÁî®ÊñπÊ≥ï
                    const availableMethods = Object.keys(paramLearning);
                    const methodCount = availableMethods.length;
                    
                    // Ëé∑ÂèñÂèÇÊï∞Á®≥ÂÆöÊÄß‰ø°ÊÅØ
                    const stabilityScore = paramStability.stability_score;
                    const consistencyLevel = paramStability.consistency_level || 'Êú™Áü•';
                    const meanScore = paramStability.mean_score;
                    
                    // ËÆ°ÁÆóÂπ≥ÂùáËæπÈôÖ‰ººÁÑ∂Â¢ûÁõä
                    let avgLikelihoodGain = 0;
                    let likelihoodCount = 0;
                    ['MLE', 'Bayesian', 'EM'].forEach(method => {
                        if (methodEstimates[method] && typeof methodEstimates[method].likelihood_gain === 'number') {
                            avgLikelihoodGain += methodEstimates[method].likelihood_gain;
                            likelihoodCount++;
                        }
                    });
                    avgLikelihoodGain = likelihoodCount > 0 ? avgLikelihoodGain / likelihoodCount : 0;
                    
                    // Ëé∑ÂèñÁõÆÊ†áËäÇÁÇπÂêçÁß∞
                    const targetNode = key.split('->')[1] || key;
                    const sourceNode = key.split('->')[0] || '';

                    html += `
                        <div class="list-item" onclick="showCPTDetails('${key}')">
                            <div class="item-title">CPT - ${targetNode}</div>
                            <div class="item-details">
                                Êù•Ê∫ê: ${sourceNode} | ÊñπÊ≥ïÊï∞: ${methodCount} | 
                                Á®≥ÂÆöÊÄß: ${(typeof stabilityScore === 'number') ? stabilityScore.toFixed(3) : 'Êú™Áü•'} (${consistencyLevel}) | 
                                Âπ≥Âùá‰ººÁÑ∂Â¢ûÁõä: ${avgLikelihoodGain.toFixed(2)} |
                                ÂèØÁî®ÊñπÊ≥ï: ${availableMethods.join(', ')}
                            </div>
                        </div>
                    `;
                }
            });

            console.log(`ŒòÈù¢ÊùøÁªüËÆ°: ÊâæÂà∞ ${cptCount} ‰∏™CPTÊï∞ÊçÆ`);
            
            if (html) {
                mediationList.innerHTML = html;
            } else {
                mediationList.innerHTML = '<div class="list-item">Êú™ÊâæÂà∞Êù°‰ª∂Ê¶ÇÁéáË°®Êï∞ÊçÆ</div>';
            }
            
            if (mediationCount) {
                mediationCount.textContent = cptCount;
            }
        }

        // ÊòæÁ§∫Êù°‰ª∂Ê¶ÇÁéáË°®ËØ¶ÊÉÖ
        function showCPTDetails(cptRef) {
            if (!knowledgeGraph || !knowledgeGraph.Theta || !knowledgeGraph.Theta[cptRef]) {
                console.error('CPTÊï∞ÊçÆ‰∏çÂ≠òÂú®:', cptRef);
                return;
            }
            
            const data = knowledgeGraph.Theta[cptRef];
            const paramLearning = data.parameter_learning || {};
            const paramStability = data.parameter_stability || {};
            const methodEstimates = data.method_estimates || {};
            const cptInfo = data.cpt_info || {};
            
            // Ëé∑ÂèñÁõÆÊ†áËäÇÁÇπÂíåÊ∫êËäÇÁÇπ
            const targetNode = cptRef.split('->')[1] || cptRef;
            const sourceNode = cptRef.split('->')[0] || '';
            
            let detailsHtml = `
                <div class="modal-content">
                    <h3>Êù°‰ª∂Ê¶ÇÁéáË°®ËØ¶ÊÉÖ - ${targetNode}</h3>
                    
                    <div class="cpt-section">
                        <h4>Âü∫Êú¨‰ø°ÊÅØ</h4>
                        <p><strong>ËæπÂÖ≥Á≥ª:</strong> ${sourceNode} ‚Üí ${targetNode}</p>
                        <p><strong>ÂèØÁî®ÊñπÊ≥ï:</strong> ${Object.keys(paramLearning).join(', ')}</p>
                    </div>
                    
                    <div class="cpt-section">
                        <h4>ÂèÇÊï∞Á®≥ÂÆöÊÄß</h4>
                        <p><strong>Á®≥ÂÆöÊÄßËØÑÂàÜ:</strong> ${(typeof paramStability.stability_score === 'number') ? paramStability.stability_score.toFixed(4) : 'Êú™Áü•'}</p>
                        <p><strong>Âπ≥ÂùáÂàÜÊï∞:</strong> ${(typeof paramStability.mean_score === 'number') ? paramStability.mean_score.toFixed(4) : 'Êú™Áü•'}</p>
                        <p><strong>Ê†áÂáÜÂ∑Æ:</strong> ${(typeof paramStability.std_score === 'number') ? paramStability.std_score.toFixed(4) : 'Êú™Áü•'}</p>
                        <p><strong>‰∏ÄËá¥ÊÄßÊ∞¥Âπ≥:</strong> ${paramStability.consistency_level || 'Êú™Áü•'}</p>
                        <p><strong>ÂèòÂºÇÁ≥ªÊï∞:</strong> ${(typeof paramStability.coefficient_of_variation === 'number') ? paramStability.coefficient_of_variation.toFixed(4) : 'Êú™Áü•'}</p>
                        <p><strong>ÊúÄÂ§ßÊàêÂØπÂ∑ÆÂºÇ:</strong> ${(typeof paramStability.max_pairwise_diff === 'number') ? paramStability.max_pairwise_diff.toFixed(4) : 'Êú™Áü•'}</p>
                        ${paramStability.method_scores ? `
                            <p><strong>ÊñπÊ≥ïÂàÜÊï∞:</strong></p>
                            <div class="stats-row">
                                ${Object.entries(paramStability.method_scores).map(([method, score]) => 
                                    `<span>${method}: ${(typeof score === 'number') ? score.toFixed(3) : 'Êú™Áü•'}</span>`
                                ).join('')}
                            </div>
                        ` : ''}
                    </div>
                    
                    <div class="cpt-section">
                        <h4>ËæπÈôÖ‰ººÁÑ∂Â¢ûÁõä</h4>
                        <div class="stats-row">
                            ${['MLE', 'Bayesian', 'EM'].map(method => {
                                const estimates = methodEstimates[method];
                                if (estimates && typeof estimates.likelihood_gain === 'number') {
                                    return `<span><strong>${method}:</strong> ${estimates.likelihood_gain.toFixed(2)}</span>`;
                                }
                                return `<span><strong>${method}:</strong> Êú™Áü•</span>`;
                            }).join('')}
                        </div>
                        ${methodEstimates.SEM ? `
                            <p><strong>SEM R¬≤:</strong> ${(typeof methodEstimates.SEM.r_squared === 'number') ? methodEstimates.SEM.r_squared.toFixed(4) : 'Êú™Áü•'}</p>
                            <p><strong>SEM Ë∞ÉÊï¥R¬≤:</strong> ${(typeof methodEstimates.SEM.adjusted_r_squared === 'number') ? methodEstimates.SEM.adjusted_r_squared.toFixed(4) : 'Êú™Áü•'}</p>
                        ` : ''}
                    </div>
            `;
            
            // ÊòæÁ§∫ÂêÑÁßçÂ≠¶‰π†ÊñπÊ≥ïÁöÑÊù°‰ª∂Ê¶ÇÁéáË°®
            const methods = ['MLE', 'Bayesian', 'EM', 'SEM'];
            methods.forEach(method => {
                if (paramLearning[method]) {
                    const methodData = paramLearning[method];
                    const estimates = methodEstimates[method];
                    
                    detailsHtml += `
                        <div class="cpt-section">
                            <h4>${method} Êù°‰ª∂Ê¶ÇÁéáË°®</h4>
                            <p><strong>ËäÇÁÇπÁ±ªÂûã:</strong> ${methodData.node_type || 'Êú™Áü•'}</p>
                            <p><strong>Áà∂ËäÇÁÇπ:</strong> ${methodData.parents ? methodData.parents.join(', ') : 'Êó†'}</p>
                            <p><strong>ÂÆåÊï¥CPT:</strong> ${methodData.has_complete_cpt ? '‚úÖ ÊòØ' : '‚ùå Âê¶'}</p>
                            
                            ${method === 'SEM' ? `
                                <div class="effect-details">
                                    <h5>ÁªìÊûÑÊñπÁ®ãÊ®°ÂûãÂèÇÊï∞:</h5>
                                    <p><strong>Á≥ªÊï∞:</strong> ${(typeof methodData.cpt_data.coefficient === 'number') ? methodData.cpt_data.coefficient.toFixed(4) : 'Êú™Áü•'}</p>
                                    <p><strong>Êà™Ë∑ù:</strong> ${(typeof methodData.cpt_data.intercept === 'number') ? methodData.cpt_data.intercept.toFixed(6) : 'Êú™Áü•'}</p>
                                    <p><strong>R¬≤:</strong> ${(typeof methodData.cpt_data.r_squared === 'number') ? methodData.cpt_data.r_squared.toFixed(4) : 'Êú™Áü•'}</p>
                                    ${estimates ? `
                                        <p><strong>Ê†áÂáÜËØØÂ∑Æ:</strong> ${(typeof estimates.coefficient_std_error === 'number') ? estimates.coefficient_std_error.toFixed(4) : 'Êú™Áü•'}</p>
                                        <p><strong>tÁªüËÆ°Èáè:</strong> ${(typeof estimates.t_statistic === 'number') ? estimates.t_statistic.toFixed(4) : 'Êú™Áü•'}</p>
                                        <p><strong>MSE:</strong> ${(typeof estimates.mse === 'number') ? estimates.mse.toFixed(4) : 'Êú™Áü•'}</p>
                                        <p><strong>RMSE:</strong> ${(typeof estimates.rmse === 'number') ? estimates.rmse.toFixed(4) : 'Êú™Áü•'}</p>
                                    ` : ''}
                                </div>
                            ` : methodData.cpt_data ? `
                                <div class="cpt-data">
                                    <h5>Êù°‰ª∂Ê¶ÇÁéáË°®Êï∞ÊçÆ:</h5>
                                    <div class="cpt-nodes">
                                        ${Object.entries(methodData.cpt_data).map(([condition, probabilities]) => `
                                            <div class="cpt-node">
                                                <strong>Êù°‰ª∂ ${condition}:</strong><br>
                                                ${Array.isArray(probabilities) ? 
                                                    `Ê¶ÇÁéá: [${probabilities.map(p => (typeof p === 'number') ? p.toFixed(4) : p).join(', ')}]` 
                                                    : `ÂÄº: ${probabilities}`}
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            ` : '<p>Êó†CPTÊï∞ÊçÆ</p>'}
                            
                            ${estimates && estimates.likelihood_gain ? `
                                <div class="mediation-stats">
                                    <p><strong>‰ººÁÑ∂Â¢ûÁõä:</strong> ${estimates.likelihood_gain.toFixed(4)}</p>
                                    <p><strong>ÂÆåÊï¥‰ººÁÑ∂:</strong> ${estimates.full_likelihood}</p>
                                    <p><strong>Âà†Èô§‰ººÁÑ∂:</strong> ${estimates.drop_likelihood.toFixed(4)}</p>
                                    ${estimates.S_param ? `<p><strong>SÂèÇÊï∞:</strong> ${estimates.S_param.toFixed(4)}</p>` : ''}
                                </div>
                            ` : ''}
                        </div>
                    `;
                }
            });
            
            detailsHtml += `
                    <button onclick="closeModal()" class="close-btn">ÂÖ≥Èó≠</button>
                </div>
            `;
            
            showModal(`Êù°‰ª∂Ê¶ÇÁéáË°®ËØ¶ÊÉÖ - ${targetNode}`, detailsHtml);
        }

        // ÂàùÂßãÂåñ‰∏≠‰ªãÊïàÂ∫îÈù¢Êùø (Œ¶Èù¢Êùø)
        function initializePathwaysPanel() {
            console.log('Œ¶Èù¢Êùø: ÂºÄÂßãÂàùÂßãÂåñ‰∏≠‰ªãÊïàÂ∫îÈù¢Êùø');
            
            const pathwaysList = document.getElementById('pathways-list');
            const pathwaysCount = document.getElementById('pathways-count');
            
            if (!pathwaysList) {
                console.error('Œ¶Èù¢Êùø: pathways-listÂÖÉÁ¥†‰∏çÂ≠òÂú®');
                return;
            }
            
            if (!knowledgeGraph || !knowledgeGraph.Phi) {
                console.log('Œ¶Èù¢Êùø: knowledgeGraph.Phi‰∏çÂ≠òÂú®');
                pathwaysList.innerHTML = '<div class="list-item">Êï∞ÊçÆÊú™Âä†ËΩΩ</div>';
                if (pathwaysCount) pathwaysCount.textContent = '0';
                return;
            }

            console.log('Œ¶Èù¢Êùø: Áü•ËØÜÂõæË∞±PhiÊï∞ÊçÆÈîÆ:', Object.keys(knowledgeGraph.Phi));
            
            let html = '';
            let mediationCount = 0;
            let totalPathways = 0;
            let significantPathways = 0;

            // ÈÅçÂéÜPhiÂØπË±°‰∏≠ÁöÑÊâÄÊúâÈîÆÔºåÂØªÊâæÂåÖÂê´mediation_effectsÁöÑÊï∞ÊçÆ
            Object.keys(knowledgeGraph.Phi).forEach(key => {
                const data = knowledgeGraph.Phi[key];
                if (data && typeof data === 'object') {
                    console.log(`Œ¶Èù¢Êùø: Â§ÑÁêÜ‰∏≠‰ªãÊïàÂ∫îÊï∞ÊçÆ ${key}:`, data);
                    mediationCount++;
                    
                    // Ëé∑ÂèñÂêÑÁßçÊï∞ÊçÆ
                    const mediationEffects = data.mediation_effects || {};
                    const effectStats = data.effect_statistics || {};
                    const significanceInfo = data.significance_info || {};
                    const pathwayMembership = data.pathway_membership || {};
                    const confidenceIntervals = data.confidence_intervals || {};
                    
                    const pathwayCount = effectStats.pathways_count || Object.keys(mediationEffects).length || 0;
                    const significantCount = effectStats.significant_pathways_count || 
                        Object.values(mediationEffects).filter(effect => effect && effect.is_significant).length;
                    
                    totalPathways += pathwayCount;
                    significantPathways += significantCount;
                    
                    // Ëé∑ÂèñÁªüËÆ°‰ø°ÊÅØ
                    const maxSignificance = significanceInfo.max_significance || 0;
                    const avgEffectStrength = effectStats.avg_effect_strength || 0;
                    const primaryEffectTypes = effectStats.primary_effect_types || [];

                    html += `
                        <div class="list-item" onclick="showMediationEffectDetails('${key}')">
                            <div class="item-title">‰∏≠‰ªãÊïàÂ∫îÂàÜÊûê - ${key}</div>
                            <div class="item-details">
                                <div class="stats-row">
                                    <span><strong>Ë∑ØÂæÑÊï∞:</strong> ${pathwayCount}</span>
                                    <span><strong>ÊòæËëóË∑ØÂæÑ:</strong> ${significantCount}</span>
                                </div>
                                <div class="stats-row">
                                    <span><strong>ÊúÄÂ§ßÊòæËëóÊÄß:</strong> ${maxSignificance > 0 ? maxSignificance.toFixed(3) : 'Êú™Áü•'}</span>
                                    <span><strong>ÊúÄÊòæËëóË∑ØÂæÑ:</strong> ${significanceInfo.most_significant_pathway || 'Êú™Áü•'}</span>
                                </div>
                                <div class="stats-row">
                                    <span><strong>‰∏ªË¶ÅÊïàÂ∫îÁ±ªÂûã:</strong> ${primaryEffectTypes.length > 0 ? primaryEffectTypes.join(', ') : 'Êú™Áü•'}</span>
                                    <span><strong>ÊòæËëóÁéá:</strong> ${pathwayCount > 0 ? ((significantCount / pathwayCount) * 100).toFixed(1) + '%' : '0%'}</span>
                                </div>
                            </div>
                        </div>
                    `;
                }
            });

            console.log(`Œ¶Èù¢ÊùøÁªüËÆ°: ÊâæÂà∞ ${mediationCount} ‰∏™‰∏≠‰ªãÊïàÂ∫îÊï∞ÊçÆÔºåÊÄªË∑ØÂæÑÊï∞: ${totalPathways}ÔºåÊòæËëóË∑ØÂæÑÊï∞: ${significantPathways}`);
            
            if (html) {
                pathwaysList.innerHTML = html;
            } else {
                pathwaysList.innerHTML = '<div class="list-item">Êú™ÊâæÂà∞‰∏≠‰ªãÊïàÂ∫îÊï∞ÊçÆ</div>';
            }
            
            if (pathwaysCount) {
                pathwaysCount.textContent = mediationCount;
            }
        }

        // ÊòæÁ§∫‰∏≠‰ªãÊïàÂ∫îËØ¶ÊÉÖ
        function showMediationEffectDetails(mediationRef) {
            if (!knowledgeGraph || !knowledgeGraph.Phi || !knowledgeGraph.Phi[mediationRef]) {
                console.error('‰∏≠‰ªãÊïàÂ∫îÊï∞ÊçÆ‰∏çÂ≠òÂú®:', mediationRef);
                return;
            }
            
            const data = knowledgeGraph.Phi[mediationRef];
            
            // Ëé∑ÂèñÂÆûÈôÖÊï∞ÊçÆ
            const mediationEffects = data.mediation_effects || {};
            const effectStats = data.effect_statistics || {};
            const significanceInfo = data.significance_info || {};
            const pathwayMembership = data.pathway_membership || [];
            const confidenceIntervals = data.confidence_intervals || {};
            
            // ËÆ°ÁÆóÁªüËÆ°‰ø°ÊÅØ
            const pathwayCount = effectStats.pathways_count || Object.keys(mediationEffects).length;
            const significantCount = effectStats.significant_pathways_count || 
                Object.values(mediationEffects).filter(effect => effect && effect.is_significant).length;
            
            // Ëé∑ÂèñÂπ≥ÂùáÊïàÂ∫îÂº∫Â∫¶
            const avgEffectStrength = (effectStats.avg_effect_strength !== undefined && effectStats.avg_effect_strength !== null) ? 
                (Array.isArray(effectStats.avg_effect_strength) ? 
                    effectStats.avg_effect_strength.join(', ') : effectStats.avg_effect_strength) : 'Êú™Áü•';
            
            // Ëé∑Âèñ‰∏ªË¶ÅÊïàÂ∫îÁ±ªÂûã
            const primaryEffectTypes = effectStats.primary_effect_types ? 
                (Array.isArray(effectStats.primary_effect_types) ? 
                    [...new Set(effectStats.primary_effect_types)].join(', ') : effectStats.primary_effect_types) : 'Êú™Áü•';
            
            // ËÆ°ÁÆóÁΩÆ‰ø°Âå∫Èó¥Ôºà‰ΩøÁî®Á¨¨‰∏Ä‰∏™ÊòæËëóË∑ØÂæÑÁöÑÊï∞ÊçÆ‰Ωú‰∏∫‰ª£Ë°®Ôºâ
            const firstSignificantEffect = Object.values(mediationEffects).find(effect => effect && effect.is_significant);
            const representativeEffect = firstSignificantEffect || Object.values(mediationEffects)[0];
            
            let indirectHDI = 'Êú™Áü•', directHDI = 'Êú™Áü•', totalHDI = 'Êú™Áü•';
            if (representativeEffect) {
                if (representativeEffect.indirect_effect) {
                    indirectHDI = `[${representativeEffect.indirect_effect.hdi_lower?.toFixed(4) || 'N/A'}, ${representativeEffect.indirect_effect.hdi_upper?.toFixed(4) || 'N/A'}]`;
                }
                if (representativeEffect.direct_effect) {
                    directHDI = `[${representativeEffect.direct_effect.hdi_lower?.toFixed(4) || 'N/A'}, ${representativeEffect.direct_effect.hdi_upper?.toFixed(4) || 'N/A'}]`;
                }
                if (representativeEffect.total_effect) {
                    totalHDI = `[${representativeEffect.total_effect.hdi_lower?.toFixed(4) || 'N/A'}, ${representativeEffect.total_effect.hdi_upper?.toFixed(4) || 'N/A'}]`;
                }
            }
            
            // ÊûÑÂª∫HTML
            let detailsHtml = `
                <h3>‰∏≠‰ªãÊïàÂ∫îËØ¶ÊÉÖ - ${mediationRef}</h3>
                <div class="mediation-section">
                    <h4>1. ÊïàÂ∫îÁªüËÆ° (Effect Statistics)</h4>
                    <p><strong>Ë∑ØÂæÑÊï∞Èáè:</strong> ${pathwayCount}</p>
                    <p><strong>ÊòæËëóË∑ØÂæÑÊï∞Èáè:</strong> ${significantCount}</p>
                    <p><strong>ÊòæËëóÁéá:</strong> ${pathwayCount > 0 ? ((significantCount / pathwayCount) * 100).toFixed(1) + '%' : '0%'}</p>
                    <p><strong>‰∏ªË¶ÅÊïàÂ∫îÁ±ªÂûã:</strong> ${primaryEffectTypes}</p>
                </div>
                <div class="mediation-section">
                    <h4>2. ÊòæËëóÊÄß‰ø°ÊÅØ (Significance Info)</h4>
                    <p><strong>ÊúÄÂ§ßÊòæËëóÊÄß:</strong> ${significanceInfo.max_significance?.toFixed(4) || 'Êú™Áü•'}</p>
                    <p><strong>ÊúÄÊòæËëóË∑ØÂæÑ:</strong> ${significanceInfo.most_significant_pathway || 'Êú™Áü•'}</p>
                </div>
                <div class="mediation-section">
                    <h4>3. ÁΩÆ‰ø°Âå∫Èó¥ (Confidence Intervals - HDI Ranges)</h4>
                    <p><strong>Èó¥Êé•ÊïàÂ∫îHDI:</strong> ${indirectHDI}</p>
                    <p><strong>Áõ¥Êé•ÊïàÂ∫îHDI:</strong> ${directHDI}</p>
                    <p><strong>ÊÄªÊïàÂ∫îHDI:</strong> ${totalHDI}</p>
                </div>
                <div class="mediation-section">
                    <h4>4. Ë∑ØÂæÑÊàêÂëòÂÖ≥Á≥ª (Pathway Membership)</h4>
                    <div class="pathway-membership">
            `;
            
            // Ê∑ªÂä†Ë∑ØÂæÑÊàêÂëòÂÖ≥Á≥ª
            pathwayMembership.forEach(member => {
                detailsHtml += `
                        <div class="membership-item">
                            <strong>Ë∑ØÂæÑID:</strong> ${member.pathway_id}<br>
                            <strong>ËßíËâ≤:</strong> ${member.role_in_pathway}<br>
                            <strong>Ë∑ØÂæÑÊòæËëóÊÄß:</strong> ${member.pathway_significance?.toFixed(4) || 'Êú™Áü•'}
                        </div>
                `;
            });
            
            detailsHtml += `
                    </div>
                </div>
                <div class="mediation-section">
                    <h4>5. ‰∏≠‰ªãÊïàÂ∫îËØ¶ÊÉÖ (Mediation Effects)</h4>
                    <div class="pathway-details">
            `;
            
            // Ê∑ªÂä†‰∏≠‰ªãÊïàÂ∫îËØ¶ÊÉÖ
            const effectEntries = Object.entries(mediationEffects);
            const maxDisplayed = 3; // ÊúÄÂ§öÊòæÁ§∫3‰∏™Ë∑ØÂæÑÁöÑËØ¶ÁªÜ‰ø°ÊÅØ
            
            effectEntries.slice(0, maxDisplayed).forEach(([pathwayId, effect]) => {
                if (!effect) return;
                
                detailsHtml += `
                        <div class="pathway-item">
                            <h5>üîó Ë∑ØÂæÑ ${pathwayId}</h5>
                            <p><strong>Ë∑ØÂæÑÊèèËø∞:</strong> ${effect.pathway_description || 'Êú™Áü•'}</p>
                            <div class="effect-details">
                                <div class="effect-row">
                                    <strong>Èó¥Êé•ÊïàÂ∫î:</strong> ÂùáÂÄº: ${effect.indirect_effect?.mean?.toFixed(4) || 'N/A'} | Ê†áÂáÜÂ∑Æ: ${effect.indirect_effect?.std?.toFixed(4) || 'N/A'} | HDI: [${effect.indirect_effect?.hdi_lower?.toFixed(4) || 'N/A'}, ${effect.indirect_effect?.hdi_upper?.toFixed(4) || 'N/A'}]
                                </div>
                                <div class="effect-row">
                                    <strong>Áõ¥Êé•ÊïàÂ∫î:</strong> ÂùáÂÄº: ${effect.direct_effect?.mean?.toFixed(4) || 'N/A'} | Ê†áÂáÜÂ∑Æ: ${effect.direct_effect?.std?.toFixed(4) || 'N/A'} | HDI: [${effect.direct_effect?.hdi_lower?.toFixed(4) || 'N/A'}, ${effect.direct_effect?.hdi_upper?.toFixed(4) || 'N/A'}]
                                </div>
                                <div class="effect-row">
                                    <strong>ÊÄªÊïàÂ∫î:</strong> ÂùáÂÄº: ${effect.total_effect?.mean?.toFixed(4) || 'N/A'} | Ê†áÂáÜÂ∑Æ: ${effect.total_effect?.std?.toFixed(4) || 'N/A'} | HDI: [${effect.total_effect?.hdi_lower?.toFixed(4) || 'N/A'}, ${effect.total_effect?.hdi_upper?.toFixed(4) || 'N/A'}]
                                </div>
                            </div>
                            <div class="mediation-stats">
                                <p><strong>‰∏≠‰ªãÊØî‰æã:</strong> ${effect.mediation_ratio?.toFixed(4) || 'N/A'} (${effect.mediation_ratio_percentage || 'N/A'}%)</p>
                                <p><strong>ÊòæËëóÊÄßÊ¶ÇÁéá:</strong> ${effect.significance_probability?.toFixed(4) || 'N/A'} ${effect.is_significant ? '‚úÖ ÊòæËëó' : '‚ùå ‰∏çÊòæËëó'}</p>
                                <p><strong>‰∏ªË¶ÅÊïàÂ∫îÁ±ªÂûã:</strong> ${effect.primary_effect_type || 'Êú™Áü•'} | <strong>ÊïàÂ∫îÂº∫Â∫¶:</strong> ${effect.effect_strength || 'Êú™Áü•'}</p>
                                <p><strong>Èó¥Êé•ÊïàÂ∫îÊñπÂêë:</strong> ${effect.indirect_effect_direction || 'Êú™Áü•'} | <strong>Áõ¥Êé•ÊïàÂ∫îÊñπÂêë:</strong> ${effect.direct_effect_direction || 'Êú™Áü•'}</p>
                                <p><strong>‰∏≠‰ªãÁ±ªÂûã:</strong> ${effect.mediation_type || 'Êú™Áü•'}</p>
                                <p><strong>Ê≠£ÊïàÂ∫îÊ¶ÇÁéá:</strong> ${effect.positive_effect_probability?.toFixed(4) || 'N/A'} | <strong>Ë¥üÊïàÂ∫îÊ¶ÇÁéá:</strong> ${effect.negative_effect_probability?.toFixed(4) || 'N/A'}</p>
                                <p><strong>ÁªìËÆ∫:</strong> ${effect.conclusion || 'Êó†ÁªìËÆ∫‰ø°ÊÅØ'}</p>
                            </div>
                        </div>
                `;
            });
            
            // Â¶ÇÊûúÊúâÊõ¥Â§öË∑ØÂæÑÔºåÊ∑ªÂä†Â±ïÂºÄÊèêÁ§∫
            if (effectEntries.length > maxDisplayed) {
                const remainingCount = effectEntries.length - maxDisplayed;
                detailsHtml += `
                        <div class="pathway-item" onclick="showAllMediationEffects('${mediationRef}')" style="cursor: pointer; background-color: #f8f9fa; border: 2px dashed #dee2e6;">
                            <p><strong>... ËøòÊúâ ${remainingCount} ‰∏™Ë∑ØÂæÑÊïàÂ∫î</strong></p>
                            <p>ÁÇπÂáªÂ±ïÂºÄÊü•ÁúãÊõ¥Â§öËØ¶ÊÉÖ</p>
                        </div>
                `;
            }
            
            detailsHtml += `
                    </div>
                </div>
                <button onclick="closeModal()" class="close-btn">ÂÖ≥Èó≠</button>
            `;
            
            showModal('‰∏≠‰ªãÊïàÂ∫îËØ¶ÊÉÖ', detailsHtml);
        }

        // ÊòæÁ§∫ÊâÄÊúâ‰∏≠‰ªãÊïàÂ∫îËØ¶ÊÉÖ
        function showAllMediationEffects(mediationRef) {
            if (!knowledgeGraph || !knowledgeGraph.Phi || !knowledgeGraph.Phi[mediationRef]) {
                console.error('‰∏≠‰ªãÊïàÂ∫îÊï∞ÊçÆ‰∏çÂ≠òÂú®:', mediationRef);
                return;
            }
            
            const data = knowledgeGraph.Phi[mediationRef];
            const mediationEffects = data.mediation_effects || {};
            
            let detailsHtml = `
                <h3>ÂÆåÊï¥‰∏≠‰ªãÊïàÂ∫îËØ¶ÊÉÖ - ${mediationRef}</h3>
                <div class="mediation-section">
                    <h4>ÊâÄÊúâË∑ØÂæÑÊïàÂ∫î (${Object.keys(mediationEffects).length} ‰∏™Ë∑ØÂæÑ)</h4>
                    <div class="pathway-details">
            `;
            
            // ÊòæÁ§∫ÊâÄÊúâ‰∏≠‰ªãÊïàÂ∫îËØ¶ÊÉÖ
            Object.entries(mediationEffects).forEach(([pathwayId, effect]) => {
                if (!effect) return;
                
                detailsHtml += `
                        <div class="pathway-item">
                            <h5>üîó Ë∑ØÂæÑ ${pathwayId}</h5>
                            <p><strong>Ë∑ØÂæÑÊèèËø∞:</strong> ${effect.pathway_description || 'Êú™Áü•'}</p>
                            <div class="effect-details">
                                <div class="effect-row">
                                    <strong>Èó¥Êé•ÊïàÂ∫î:</strong> ÂùáÂÄº: ${effect.indirect_effect?.mean?.toFixed(4) || 'N/A'} | Ê†áÂáÜÂ∑Æ: ${effect.indirect_effect?.std?.toFixed(4) || 'N/A'} | HDI: [${effect.indirect_effect?.hdi_lower?.toFixed(4) || 'N/A'}, ${effect.indirect_effect?.hdi_upper?.toFixed(4) || 'N/A'}]
                                </div>
                                <div class="effect-row">
                                    <strong>Áõ¥Êé•ÊïàÂ∫î:</strong> ÂùáÂÄº: ${effect.direct_effect?.mean?.toFixed(4) || 'N/A'} | Ê†áÂáÜÂ∑Æ: ${effect.direct_effect?.std?.toFixed(4) || 'N/A'} | HDI: [${effect.direct_effect?.hdi_lower?.toFixed(4) || 'N/A'}, ${effect.direct_effect?.hdi_upper?.toFixed(4) || 'N/A'}]
                                </div>
                                <div class="effect-row">
                                    <strong>ÊÄªÊïàÂ∫î:</strong> ÂùáÂÄº: ${effect.total_effect?.mean?.toFixed(4) || 'N/A'} | Ê†áÂáÜÂ∑Æ: ${effect.total_effect?.std?.toFixed(4) || 'N/A'} | HDI: [${effect.total_effect?.hdi_lower?.toFixed(4) || 'N/A'}, ${effect.total_effect?.hdi_upper?.toFixed(4) || 'N/A'}]
                                </div>
                            </div>
                            <div class="mediation-stats">
                                <p><strong>‰∏≠‰ªãÊØî‰æã:</strong> ${effect.mediation_ratio?.toFixed(4) || 'N/A'} (${effect.mediation_ratio_percentage || 'N/A'}%)</p>
                                <p><strong>ÊòæËëóÊÄßÊ¶ÇÁéá:</strong> ${effect.significance_probability?.toFixed(4) || 'N/A'} ${effect.is_significant ? '‚úÖ ÊòæËëó' : '‚ùå ‰∏çÊòæËëó'}</p>
                                <p><strong>‰∏ªË¶ÅÊïàÂ∫îÁ±ªÂûã:</strong> ${effect.primary_effect_type || 'Êú™Áü•'} | <strong>ÊïàÂ∫îÂº∫Â∫¶:</strong> ${effect.effect_strength || 'Êú™Áü•'}</p>
                                <p><strong>Èó¥Êé•ÊïàÂ∫îÊñπÂêë:</strong> ${effect.indirect_effect_direction || 'Êú™Áü•'} | <strong>Áõ¥Êé•ÊïàÂ∫îÊñπÂêë:</strong> ${effect.direct_effect_direction || 'Êú™Áü•'}</p>
                                <p><strong>‰∏≠‰ªãÁ±ªÂûã:</strong> ${effect.mediation_type || 'Êú™Áü•'}</p>
                                <p><strong>Ê≠£ÊïàÂ∫îÊ¶ÇÁéá:</strong> ${effect.positive_effect_probability?.toFixed(4) || 'N/A'} | <strong>Ë¥üÊïàÂ∫îÊ¶ÇÁéá:</strong> ${effect.negative_effect_probability?.toFixed(4) || 'N/A'}</p>
                                <p><strong>ÁªìËÆ∫:</strong> ${effect.conclusion || 'Êó†ÁªìËÆ∫‰ø°ÊÅØ'}</p>
                            </div>
                        </div>
                `;
            });
            
            detailsHtml += `
                    </div>
                </div>
                <button onclick="closeModal()" class="close-btn">ÂÖ≥Èó≠</button>
            `;
            
            showModal('ÂÆåÊï¥‰∏≠‰ªãÊïàÂ∫îËØ¶ÊÉÖ', detailsHtml);
        }

        // ÂàùÂßãÂåñÁΩëÁªúÂõæË∞±
        function initializeGraphPanel() {
            console.log('ÂàùÂßãÂåñCanvasÂõæË∞±Èù¢Êùø...');
            
            // Ê£ÄÊü•Êï∞ÊçÆÂÆåÊï¥ÊÄß
            if (!knowledgeGraph || !knowledgeGraph.V || !knowledgeGraph.E_core) {
                console.error('Áü•ËØÜÂõæË∞±Êï∞ÊçÆ‰∏çÂÆåÊï¥');
                const graphContainer = document.getElementById('graph-viz');
                if (graphContainer) {
                    graphContainer.innerHTML = '<div style="display: flex; justify-content: center; align-items: center; height: 100%; color: #666;">Áü•ËØÜÂõæË∞±Êï∞ÊçÆÂä†ËΩΩ‰∏≠...</div>';
                }
                return;
            }

            const graphContainer = document.getElementById('graph-viz');
            if (!graphContainer) {
                console.error('ÂõæË∞±ÂÆπÂô®‰∏çÂ≠òÂú®');
                return;
            }
            
            // Á°Æ‰øùÂÆπÂô®ÊúâÂêàÈÄÇÁöÑÂ∞∫ÂØ∏
            if (graphContainer.offsetWidth === 0 || graphContainer.offsetHeight === 0) {
                console.warn('ÂõæË∞±ÂÆπÂô®Â∞∫ÂØ∏‰∏∫0ÔºåËÆæÁΩÆÈªòËÆ§Â∞∫ÂØ∏');
                graphContainer.style.width = '100%';
                graphContainer.style.height = '600px';
                graphContainer.style.minHeight = '600px';
            }
            
            console.log('ÂõæË∞±ÂÆπÂô®Â∞∫ÂØ∏:', graphContainer.offsetWidth, 'x', graphContainer.offsetHeight);
            
            // ËÆ∞ÂΩïÊï∞ÊçÆÁªüËÆ°
            console.log('Áü•ËØÜÂõæË∞±Êï∞ÊçÆÁªüËÆ°:');
            console.log('- ËäÇÁÇπÊï∞Èáè:', knowledgeGraph.V.length);
            console.log('- ËæπÊï∞Èáè:', knowledgeGraph.E_core.length);
            console.log('- ÊùÉÈáçÊï∞ÊçÆ:', knowledgeGraph.W ? Object.keys(knowledgeGraph.W).length : 0);
            console.log('- Êù°‰ª∂Ê¶ÇÁéáË°®:', knowledgeGraph.Theta ? Object.keys(knowledgeGraph.Theta).length : 0);
            console.log('- ‰∏≠‰ªãÊïàÂ∫î:', knowledgeGraph.Phi ? Object.keys(knowledgeGraph.Phi).length : 0);
            
            // ÂáÜÂ§áËäÇÁÇπÊï∞ÊçÆ - Â¢ûÂº∫ËäÇÁÇπ‰ø°ÊÅØ
            const nodes = knowledgeGraph.V.map(vertex => {
                const type = vertex.split('_')[0];
                const name = vertex.split('_').slice(1).join('_');
                
                // ËÆ°ÁÆóËäÇÁÇπÁöÑËøûÊé•Â∫¶
                const inDegree = knowledgeGraph.E_core.filter(edge => edge.target === vertex).length;
                const outDegree = knowledgeGraph.E_core.filter(edge => edge.source === vertex).length;
                const totalDegree = inDegree + outDegree;
                
                // ËÆ°ÁÆóËäÇÁÇπÂ§ßÂ∞èÔºàÂü∫‰∫éËøûÊé•Â∫¶Ôºâ
                const nodeSize = Math.max(8, Math.min(20, 8 + totalDegree * 2));
                
                return {
                    id: vertex,
                    name: name,
                    fullName: vertex,
                    type: type,
                    color: getNodeColor(type),
                    size: nodeSize,
                    inDegree: inDegree,
                    outDegree: outDegree,
                    totalDegree: totalDegree
                };
            });

            // ÂáÜÂ§áËæπÊï∞ÊçÆ - Â¢ûÂº∫Ëæπ‰ø°ÊÅØ
            const links = knowledgeGraph.E_core.map(edge => {
                const weightData = knowledgeGraph.W && knowledgeGraph.W[edge.weight_ref];
                const hasWeight = !!weightData;
                const finalWeight = weightData?.hierarchy_weight?.final_weight || 0;
                
                return {
                    source: edge.source,
                    target: edge.target,
                    relation: edge.relation_type,
                    hierarchy: edge.edge_hierarchy,
                    isDirect: edge.is_direct,
                    color: getEdgeColor(edge.relation_type),
                    width: edge.edge_hierarchy === 'triangulated_verified' ? 3 : (hasWeight && finalWeight > 0.5 ? 2 : 1),
                    opacity: edge.edge_hierarchy === 'triangulated_verified' ? 1.0 : 0.7,
                    weightRef: edge.weight_ref,
                    hasWeight: hasWeight,
                    finalWeight: finalWeight
                };
            });

            console.log('ËäÇÁÇπÁªüËÆ°:', {
                ÁñæÁóÖ: nodes.filter(n => n.type === 'ÁñæÁóÖ').length,
                ËçØÁâ©: nodes.filter(n => n.type === 'ËçØÁâ©').length,
                Ê£ÄÈ™å: nodes.filter(n => n.type === 'Ê£ÄÈ™å').length
            });

            console.log('ËæπÁªüËÆ°:', {
                triangulated_verified: links.filter(l => l.hierarchy === 'triangulated_verified').length,
                non_triangulated: links.filter(l => l.hierarchy === 'non_triangulated').length,
                hasWeight: links.filter(l => l.hasWeight).length
            });

            try {
                // Ê∏ÖÁ©∫ÂÆπÂô®
                graphContainer.innerHTML = '';
                console.log('ÂÆπÂô®Â∑≤Ê∏ÖÁ©∫ÔºåÂáÜÂ§áÂàõÂª∫Vis.jsÂõæË∞±');
                
                // ÂáÜÂ§áVis.jsÊï∞ÊçÆÊ†ºÂºè
                const visNodes = new vis.DataSet(nodes.map(node => ({
                    id: node.id,
                    label: node.name,
                    title: `${node.fullName}\nÁ±ªÂûã: ${node.type}\nÂÖ•Â∫¶: ${node.inDegree}\nÂá∫Â∫¶: ${node.outDegree}`,
                    color: {
                        background: node.color,
                        border: '#2B7CE9',
                        highlight: {
                            background: node.color,
                            border: '#2B7CE9'
                        }
                    },
                    size: node.size,
                    font: {
                        size: 12,
                        color: '#333333'
                    },
                    group: node.type
                })));
                
                const visEdges = new vis.DataSet(links.map((link, index) => {
                    // Â¢ûÂº∫ÊùÉÈáçÊòæÁ§∫
                    const weightDisplay = link.hasWeight ? 
                        `W:${link.finalWeight.toFixed(3)}` : 'W:N/A';
                    const edgeLabel = `${link.relation}\n${weightDisplay}`;
                    
                    // Ê†πÊçÆÊùÉÈáçË∞ÉÊï¥ËæπÁöÑÈ¢úËâ≤Âº∫Â∫¶
                    let edgeColor = link.color;
                    let edgeOpacity = link.opacity;
                    if (link.hasWeight && link.finalWeight > 0) {
                        // ÊùÉÈáçË∂äÈ´òÔºåÈ¢úËâ≤Ë∂äÊ∑±
                        edgeOpacity = Math.max(0.3, Math.min(1.0, link.opacity + link.finalWeight * 0.3));
                        if (link.finalWeight > 0.7) {
                            edgeColor = '#d32f2f'; // È´òÊùÉÈáçÁî®Á∫¢Ëâ≤
                        } else if (link.finalWeight > 0.4) {
                            edgeColor = '#f57c00'; // ‰∏≠ÊùÉÈáçÁî®Ê©ôËâ≤
                        }
                    }
                    
                    return {
                        id: index,
                        from: link.source,
                        to: link.target,
                        label: edgeLabel,
                        title: `ÂÖ≥Á≥ª: ${link.relation}\nÂ±ÇÁ∫ß: ${link.hierarchy}\nÊùÉÈáç: ${link.finalWeight.toFixed(3)}\nÊùÉÈáçÂºïÁî®: ${link.weightRef || 'N/A'}`,
                        color: {
                            color: edgeColor,
                            opacity: edgeOpacity
                        },
                        width: Math.max(1, link.width + (link.hasWeight ? link.finalWeight * 2 : 0)),
                        arrows: {
                            to: {
                                enabled: true,
                                scaleFactor: 0.8
                            }
                        },
                        smooth: {
                            type: 'continuous'
                        },
                        dashes: link.hierarchy === 'non_triangulated',
                        font: {
                            size: 10,
                            color: '#333',
                            background: 'rgba(255,255,255,0.8)',
                            strokeWidth: 1,
                            strokeColor: '#fff'
                        }
                    };
                }));
                
                console.log('Vis.jsÊï∞ÊçÆÂáÜÂ§áÂÆåÊàêÔºåËäÇÁÇπÊï∞:', visNodes.length, 'ËæπÊï∞:', visEdges.length);
                
                // ÈÖçÁΩÆVis.jsÁΩëÁªúÈÄâÈ°π
                const options = {
                    nodes: {
                        shape: 'dot',
                        scaling: {
                            min: 10,
                            max: 30
                        },
                        font: {
                            size: 12,
                            face: 'Microsoft YaHei'
                        },
                        borderWidth: 2,
                        shadow: true
                    },
                    edges: {
                        width: 0.15,
                        color: { inherit: 'from' },
                        smooth: {
                            type: 'continuous'
                        },
                        arrows: {
                            to: {
                                enabled: true,
                                scaleFactor: 0.8
                            }
                        },
                        font: {
                            size: 10,
                            align: 'middle'
                        }
                    },
                    physics: {
                        enabled: true,
                        stabilization: {
                            enabled: true,
                            iterations: 1000,
                            updateInterval: 25
                        },
                        barnesHut: {
                            gravitationalConstant: -8000,
                            centralGravity: 0.3,
                            springLength: 95,
                            springConstant: 0.04,
                            damping: 0.09,
                            avoidOverlap: 0.1
                        }
                    },
                    interaction: {
                        dragNodes: true,
                        dragView: true,
                        zoomView: true,
                        selectConnectedEdges: true,
                        hover: true,
                        hoverConnectedEdges: true,
                        tooltipDelay: 200
                    },
                    layout: {
                        improvedLayout: true,
                        clusterThreshold: 150
                    }
                };
                
                // ÂàõÂª∫Vis.jsÁΩëÁªú
                console.log('ÂàõÂª∫Vis.jsÁΩëÁªúÂÆû‰æã...');
                const data = { nodes: visNodes, edges: visEdges };
                const network = new vis.Network(graphContainer, data, options);
                
                // Â≠òÂÇ®ÁΩëÁªúÂÆû‰æã
                window.currentGraph = network;
                window.currentGraphData = { nodes: visNodes, edges: visEdges };
                
                console.log('Vis.jsÂõæË∞±ÂàùÂßãÂåñÊàêÂäü');
                
                // ÁΩëÁªú‰∫ã‰ª∂ÁõëÂê¨
                network.on('click', function(params) {
                    if (params.nodes.length > 0) {
                        const nodeId = params.nodes[0];
                        const node = nodes.find(n => n.id === nodeId);
                        if (node) {
                            console.log('ÁÇπÂáªËäÇÁÇπ:', node);
                            showNodeDetails(node);
                        }
                    } else if (params.edges.length > 0) {
                        // ÁÇπÂáªËæπÊó∂ÊòæÁ§∫ÊùÉÈáçËØ¶ÊÉÖ
                        const edgeId = params.edges[0];
                        const link = links[edgeId];
                        if (link) {
                            console.log('ÁÇπÂáªËæπ:', link);
                            showEdgeWeightDetails(link);
                        }
                    }
                });
                
                network.on('doubleClick', function(params) {
                    if (params.nodes.length > 0) {
                        network.focus(params.nodes[0], {
                            scale: 1.5,
                            animation: true
                        });
                    }
                });
                
                // Á®≥ÂÆöÂåñÂÆåÊàêÂêéÊ∑ªÂä†Âõæ‰æã
                network.once('stabilizationIterationsDone', function() {
                    console.log('ÁΩëÁªúÁ®≥ÂÆöÂåñÂÆåÊàêÔºåÊ∑ªÂä†Âõæ‰æã...');
                    addGraphLegend();
                });
                
            } catch (error) {
                console.error('Vis.jsÂõæË∞±ÂàùÂßãÂåñÂ§±Ë¥•:', error);
                console.error('ÈîôËØØÂ†ÜÊ†à:', error.stack);
                graphContainer.innerHTML = `
                    <div style="display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100%; color: #ff6b6b;">
                        <h3>ÂõæÂΩ¢ÂàùÂßãÂåñÂ§±Ë¥•</h3>
                        <p>ÈîôËØØ‰ø°ÊÅØ: ${error.message}</p>
                        <button onclick="location.reload()" style="margin-top: 10px; padding: 8px 16px; background: #4facfe; color: white; border: none; border-radius: 4px; cursor: pointer;">
                            Âà∑Êñ∞È°µÈù¢ÈáçËØï
                        </button>
                    </div>
                `;
            }
        }

        // Ê∑ªÂä†Âõæ‰æã
        function addGraphLegend() {
            const graphContainer = document.getElementById('graph-viz');
            if (!graphContainer || document.getElementById('graph-legend')) return;

            const legend = document.createElement('div');
            legend.id = 'graph-legend';
            legend.style.cssText = `
                position: absolute;
                top: 20px;
                left: 20px;
                background: rgba(255, 255, 255, 0.95);
                padding: 15px;
                border-radius: 8px;
                box-shadow: 0 2px 10px rgba(0,0,0,0.1);
                font-size: 12px;
                z-index: 1000;
                max-width: 250px;
            `;

            const nodeTypes = [
                { type: 'ÁñæÁóÖ', color: '#ff6b6b', count: knowledgeGraph.V.filter(v => v.startsWith('ÁñæÁóÖ_')).length },
                { type: 'ËçØÁâ©', color: '#4ecdc4', count: knowledgeGraph.V.filter(v => v.startsWith('ËçØÁâ©_')).length },
                { type: 'Ê£ÄÈ™å', color: '#45b7d1', count: knowledgeGraph.V.filter(v => v.startsWith('Ê£ÄÈ™å_')).length }
            ];

            const edgeTypes = [
                { type: '‰∏âËßíÈ™åËØÅËæπ', color: '#333', width: '3px', count: knowledgeGraph.E_core.filter(e => e.edge_hierarchy === 'triangulated_verified').length },
                { type: 'ÂÄôÈÄâËæπ', color: '#666', width: '1px', count: knowledgeGraph.E_core.filter(e => e.edge_hierarchy === 'non_triangulated').length }
            ];

            legend.innerHTML = `
                <h4 style="margin: 0 0 10px 0; color: #333;">Áü•ËØÜÂõæË∞±Âõæ‰æã</h4>
                <div style="margin-bottom: 10px;">
                    <strong>ËäÇÁÇπÁ±ªÂûã:</strong><br/>
                    ${nodeTypes.map(nt => `
                        <div style="display: flex; align-items: center; margin: 3px 0;">
                            <div style="width: 12px; height: 12px; background: ${nt.color}; border-radius: 50%; margin-right: 8px;"></div>
                            <span>${nt.type} (${nt.count})</span>
                        </div>
                    `).join('')}
                </div>
                <div>
                    <strong>ËæπÁ±ªÂûã:</strong><br/>
                    ${edgeTypes.map(et => `
                        <div style="display: flex; align-items: center; margin: 3px 0;">
                            <div style="width: 20px; height: ${et.width}; background: ${et.color}; margin-right: 8px;"></div>
                            <span>${et.type} (${et.count})</span>
                        </div>
                    `).join('')}
                </div>
                <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #eee; font-size: 11px; color: #666;">
                    ÊÄªËäÇÁÇπ: ${knowledgeGraph.V.length}<br/>
                    ÊÄªËæπÊï∞: ${knowledgeGraph.E_core.length}<br/>
                    ÊùÉÈáçÊï∞ÊçÆ: ${knowledgeGraph.W ? Object.keys(knowledgeGraph.W).length : 0}
                </div>
            `;

            graphContainer.appendChild(legend);
        }

        // ÊòæÁ§∫ËäÇÁÇπËØ¶ÊÉÖ
        function showNodeDetails(node) {
            const detailsHtml = `
                <div style="max-width: 500px;">
                    <h3 style="color: ${node.color}; margin-bottom: 15px;">
                        ${node.fullName}
                    </h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px;">
                        <div><strong>Á±ªÂûã:</strong> ${node.type}</div>
                        <div><strong>ËäÇÁÇπÂ§ßÂ∞è:</strong> ${node.size}</div>
                        <div><strong>ÂÖ•Â∫¶:</strong> ${node.inDegree}</div>
                        <div><strong>Âá∫Â∫¶:</strong> ${node.outDegree}</div>
                        <div><strong>ÊÄªËøûÊé•Â∫¶:</strong> ${node.totalDegree}</div>
                    </div>
                    
                    <div style="margin-top: 15px;">
                        <h4>Áõ∏ÂÖ≥ËøûÊé•:</h4>
                        <div style="max-height: 200px; overflow-y: auto; border: 1px solid #ddd; padding: 10px; border-radius: 4px;">
                            ${getNodeConnections(node.id)}
                        </div>
                    </div>
                    
                    <div style="margin-top: 15px; text-align: center;">
                        <button onclick="focusOnNode('${node.id}')" 
                                style="padding: 8px 16px; background: #4facfe; color: white; border: none; border-radius: 4px; cursor: pointer; margin-right: 10px;">
                            ËÅöÁÑ¶Âà∞Ê≠§ËäÇÁÇπ
                        </button>
                        <button onclick="highlightNodeConnections('${node.id}')" 
                                style="padding: 8px 16px; background: #ff6b6b; color: white; border: none; border-radius: 4px; cursor: pointer;">
                            È´ò‰∫ÆËøûÊé•
                        </button>
                    </div>
                </div>
            `;
            
            showModal('ËäÇÁÇπËØ¶ÊÉÖ', detailsHtml);
        }

        // Ëé∑ÂèñËäÇÁÇπËøûÊé•‰ø°ÊÅØ
        function getNodeConnections(nodeId) {
            if (!knowledgeGraph || !knowledgeGraph.E_core) return 'Êó†ËøûÊé•‰ø°ÊÅØ';
            
            const connections = knowledgeGraph.E_core.filter(edge => 
                edge.source === nodeId || edge.target === nodeId
            );
            
            if (connections.length === 0) return 'Ê≠§ËäÇÁÇπÊ≤°ÊúâËøûÊé•';
            
            return connections.map(edge => {
                const isSource = edge.source === nodeId;
                const otherNode = isSource ? edge.target : edge.source;
                const direction = isSource ? '‚Üí' : '‚Üê';
                
                return `
                    <div style="margin: 5px 0; padding: 5px; background: #f8f9fa; border-radius: 3px;">
                        <strong>${direction} ${otherNode}</strong><br/>
                        <small>ÂÖ≥Á≥ª: ${edge.relation_type} | Â±ÇÁ∫ß: ${edge.edge_hierarchy}</small>
                    </div>
                `;
            }).join('');
        }

        // ËÅöÁÑ¶Âà∞ÊåáÂÆöËäÇÁÇπ
        function focusOnNode(nodeId) {
            if (window.currentGraph && window.currentGraph.focus) {
                window.currentGraph.focus(nodeId, {
                    scale: 2.0,
                    animation: true
                });
            }
        }

        // È´ò‰∫ÆËäÇÁÇπËøûÊé•
        function highlightNodeConnections(nodeId) {
            if (!window.currentGraph || !window.currentGraphData) return;
            
            // Ëé∑ÂèñËøûÊé•ÁöÑËæπÂíåËäÇÁÇπ
            const connectedEdges = [];
            const connectedNodes = new Set([nodeId]);
            
            knowledgeGraph.E_core.forEach((edge, index) => {
                if (edge.source === nodeId || edge.target === nodeId) {
                    connectedEdges.push(index);
                    connectedNodes.add(edge.source);
                    connectedNodes.add(edge.target);
                }
            });
            
            // È´ò‰∫ÆÈÄâ‰∏≠ÁöÑËäÇÁÇπÂíåËæπ
            window.currentGraph.selectNodes(Array.from(connectedNodes));
            window.currentGraph.selectEdges(connectedEdges);
        }

        // Ëé∑ÂèñËäÇÁÇπÈ¢úËâ≤
        function getNodeColor(type) {
            const colors = {
                'ÁñæÁóÖ': '#ff6b6b',
                'ËçØÁâ©': '#4ecdc4',
                'Ê£ÄÈ™å': '#45b7d1'
            };
            return colors[type] || '#95a5a6';
        }

        // Ëé∑ÂèñËæπÈ¢úËâ≤
        function getEdgeColor(relationType) {
            const colors = {
                'disease_disease': '#ff6b6b',
                'disease_drug': '#4ecdc4',
                'disease_test': '#45b7d1',
                'drug_drug': '#96ceb4',
                'drug_disease': '#feca57',
                'test_test': '#ff9ff3',
                'test_drug': '#54a0ff',
                'test_disease': '#5f27cd'
            };
            return colors[relationType] || '#95a5a6';
        }

        // ÊòæÁ§∫ËäÇÁÇπËØ¶ÊÉÖ
        function showVertexDetails(vertexId) {
            const modal = document.getElementById('detail-modal');
            const title = document.getElementById('modal-title');
            const body = document.getElementById('modal-body');

            title.textContent = `ËäÇÁÇπËØ¶ÊÉÖ: ${vertexId}`;
            
            // Êü•ÊâæÁõ∏ÂÖ≥Ëæπ
            const relatedEdges = knowledgeGraph.E_core.filter(edge => 
                edge.source === vertexId || edge.target === vertexId
            );

            const type = vertexId.split('_')[0];
            const name = vertexId.split('_').slice(1).join('_');

            body.innerHTML = `
                <div class="parameter-section">
                    <div class="parameter-title">üîµ Âü∫Êú¨‰ø°ÊÅØ</div>
                    <div class="parameter-content">
                        <div><strong>ËäÇÁÇπID:</strong> ${vertexId}</div>
                        <div><strong>Á±ªÂûã:</strong> ${type}</div>
                        <div><strong>ÂêçÁß∞:</strong> ${name}</div>
                        <div><strong>Áõ∏ÂÖ≥ËæπÊï∞:</strong> ${relatedEdges.length}</div>
                    </div>
                </div>
                
                <div class="parameter-section">
                    <div class="parameter-title">üîó Áõ∏ÂÖ≥ËøûÊé•</div>
                    <div class="parameter-content">
                        ${relatedEdges.map(edge => `
                            <div style="margin-bottom: 10px; padding: 10px; background: white; border-radius: 5px;">
                                <strong>${edge.source} ‚Üí ${edge.target}</strong><br>
                                <span class="relation-badge ${edge.relation_type}">${edge.relation_type}</span>
                                <span style="margin-left: 10px;">Â±ÇÊ¨°: ${edge.edge_hierarchy}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;

            modal.style.display = 'flex';
        }

        // ÊòæÁ§∫ËæπËØ¶ÊÉÖ
        function showEdgeDetails(sourceId, targetId) {
            const modal = document.getElementById('detail-modal');
            const title = document.getElementById('modal-title');
            const body = document.getElementById('modal-body');

            // Êü•ÊâæËæπ‰ø°ÊÅØ
            const edge = knowledgeGraph.E_core.find(e => 
                e.source === sourceId && e.target === targetId
            );

            if (!edge) {
                body.innerHTML = '<div>Êú™ÊâæÂà∞Ëæπ‰ø°ÊÅØ</div>';
                return;
            }

            title.textContent = `ËæπËØ¶ÊÉÖ: ${sourceId} ‚Üí ${targetId}`;

            body.innerHTML = `
                <div class="parameter-section">
                    <div class="parameter-title">üîó ËæπÂü∫Êú¨‰ø°ÊÅØ</div>
                    <div class="parameter-content">
                        <div><strong>Ê∫êËäÇÁÇπ:</strong> ${edge.source}</div>
                        <div><strong>ÁõÆÊ†áËäÇÁÇπ:</strong> ${edge.target}</div>
                        <div><strong>ÂÖ≥Á≥ªÁ±ªÂûã:</strong> <span class="relation-badge ${edge.relation_type}">${edge.relation_type}</span></div>
                        <div><strong>ËæπÂ±ÇÊ¨°:</strong> ${edge.edge_hierarchy}</div>
                        <div><strong>ÊòØÂê¶Áõ¥Êé•:</strong> ${edge.is_direct ? 'ÊòØ' : 'Âê¶'}</div>
                        <div><strong>ËØÜÂà´Êó∂Èó¥:</strong> ${edge.identification_time}</div>
                    </div>
                </div>
            `;

            modal.style.display = 'flex';
        }



        // ÊòæÁ§∫‰∏≠‰ªãÊïàÂ∫îËØ¶ÊÉÖ
        function showMediationDetails(mediationKey) {
            const modal = document.getElementById('detail-modal');
            const title = document.getElementById('modal-title');
            const body = document.getElementById('modal-body');

            title.textContent = `‰∏≠‰ªãÊïàÂ∫îËØ¶ÊÉÖ: ${mediationKey}`;
            
            const data = knowledgeGraph[mediationKey];
            const mediationData = data?.mediation_effects;
            if (!mediationData || typeof mediationData !== 'object') {
                body.innerHTML = '<div>Êú™ÊâæÂà∞‰∏≠‰ªãÊïàÂ∫îÊï∞ÊçÆ</div>';
                return;
            }

            // ËÆ°ÁÆóÁªüËÆ°‰ø°ÊÅØ
            const effects = Object.values(mediationData);
            const significantCount = effects.filter(e => e.is_significant).length;
            const maxSignificance = Math.max(...effects.map(e => e.significance_probability || 0));
            const mostSignificantPathway = effects.find(e => e.significance_probability === maxSignificance)?.pathway_description || 'Êú™Áü•';
            
            body.innerHTML = `
                <div class="parameter-section">
                    <div class="parameter-title">üîÑ ‰∏≠‰ªãÊïàÂ∫îÊ¶ÇËßà</div>
                    <div class="parameter-content">
                        <div><strong>Ë∑ØÂæÑÊï∞Èáè:</strong> ${effects.length}</div>
                        <div><strong>ÊòæËëóË∑ØÂæÑÊï∞:</strong> ${significantCount}</div>
                        <div><strong>ÊúÄÂ§ßÊòæËëóÊÄß:</strong> ${maxSignificance.toFixed(3)}</div>
                        <div><strong>ÊúÄÊòæËëóË∑ØÂæÑ:</strong> ${mostSignificantPathway}</div>
                    </div>
                </div>
                
                <div class="parameter-section">
                    <div class="parameter-title">üìä Ë∑ØÂæÑËØ¶ÊÉÖ</div>
                    <div class="parameter-content">
                        ${Object.entries(mediationData).map(([pathwayId, effect]) => `
                            <div style="margin-bottom: 15px; padding: 15px; background: white; border-radius: 8px; border-left: 4px solid ${effect.is_significant ? '#28a745' : '#dc3545'};">
                                <h4>Ë∑ØÂæÑ ${pathwayId}: ${effect.pathway_description}</h4>
                                <div style="margin-top: 10px;">
                                    <div><strong>Èó¥Êé•ÊïàÂ∫î:</strong> ${effect.indirect_effect?.mean?.toFixed(4)} (${effect.indirect_effect?.hdi_lower?.toFixed(4)} - ${effect.indirect_effect?.hdi_upper?.toFixed(4)})</div>
                                    <div><strong>Áõ¥Êé•ÊïàÂ∫î:</strong> ${effect.direct_effect?.mean?.toFixed(4)} (${effect.direct_effect?.hdi_lower?.toFixed(4)} - ${effect.direct_effect?.hdi_upper?.toFixed(4)})</div>
                                    <div><strong>ÊÄªÊïàÂ∫î:</strong> ${effect.total_effect?.mean?.toFixed(4)} (${effect.total_effect?.hdi_lower?.toFixed(4)} - ${effect.total_effect?.hdi_upper?.toFixed(4)})</div>
                                    <div><strong>‰∏≠‰ªãÊØî‰æã:</strong> ${(effect.mediation_ratio_percentage || 0).toFixed(1)}%</div>
                                    <div><strong>ÊòæËëóÊÄßÊ¶ÇÁéá:</strong> ${(effect.significance_probability || 0).toFixed(3)}</div>
                                    <div><strong>ÊïàÂ∫îÂº∫Â∫¶:</strong> ${effect.effect_strength}</div>
                                    <div><strong>‰∏≠‰ªãÁ±ªÂûã:</strong> ${effect.mediation_type}</div>
                                    <div><strong>ÁªìËÆ∫:</strong> ${effect.conclusion}</div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;

            modal.style.display = 'flex';
        }

        // ÊòæÁ§∫Ë∑ØÂæÑËØ¶ÊÉÖ
        function showPathwayDetails(sourceKey, pathwayId) {
            const modal = document.getElementById('detail-modal');
            const title = document.getElementById('modal-title');
            const body = document.getElementById('modal-body');

            title.textContent = `Ë∑ØÂæÑËØ¶ÊÉÖ: ${sourceKey} - Ë∑ØÂæÑ ${pathwayId}`;
            
            const data = knowledgeGraph[sourceKey];
            const mediationData = data?.mediation_effects;
            if (!mediationData || !mediationData[pathwayId]) {
                body.innerHTML = '<div>Êú™ÊâæÂà∞Ë∑ØÂæÑÊï∞ÊçÆ</div>';
                return;
            }

            const pathway = mediationData[pathwayId];
            
            body.innerHTML = `
                <div class="parameter-section">
                    <div class="parameter-title">üõ§Ô∏è Ë∑ØÂæÑÊ¶ÇËßà</div>
                    <div class="parameter-content">
                        <div><strong>Ë∑ØÂæÑÊèèËø∞:</strong> ${pathway.pathway_description}</div>
                        <div><strong>ÊòæËëóÊÄßÊ¶ÇÁéá:</strong> ${(pathway.significance_probability || 0).toFixed(3)}</div>
                        <div><strong>ÊòØÂê¶ÊòæËëó:</strong> ${pathway.is_significant ? '‚úÖ ÊòØ' : '‚ùå Âê¶'}</div>
                        <div><strong>ÊïàÂ∫îÂº∫Â∫¶:</strong> ${pathway.effect_strength}</div>
                        <div><strong>‰∏≠‰ªãÁ±ªÂûã:</strong> ${pathway.mediation_type}</div>
                        <div><strong>‰∏≠‰ªãÊØî‰æã:</strong> ${(pathway.mediation_ratio_percentage || 0).toFixed(1)}%</div>
                    </div>
                </div>
                
                <div class="parameter-section">
                    <div class="parameter-title">üìä ÊïàÂ∫îÂàÜÊûê</div>
                    <div class="parameter-content">
                        <div style="margin-bottom: 15px;">
                            <h4>Èó¥Êé•ÊïàÂ∫î</h4>
                            <div><strong>ÂùáÂÄº:</strong> ${pathway.indirect_effect?.mean?.toFixed(4) || 'N/A'}</div>
                            <div><strong>ÁΩÆ‰ø°Âå∫Èó¥:</strong> [${pathway.indirect_effect?.hdi_lower?.toFixed(4) || 'N/A'}, ${pathway.indirect_effect?.hdi_upper?.toFixed(4) || 'N/A'}]</div>
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <h4>Áõ¥Êé•ÊïàÂ∫î</h4>
                            <div><strong>ÂùáÂÄº:</strong> ${pathway.direct_effect?.mean?.toFixed(4) || 'N/A'}</div>
                            <div><strong>ÁΩÆ‰ø°Âå∫Èó¥:</strong> [${pathway.direct_effect?.hdi_lower?.toFixed(4) || 'N/A'}, ${pathway.direct_effect?.hdi_upper?.toFixed(4) || 'N/A'}]</div>
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <h4>ÊÄªÊïàÂ∫î</h4>
                            <div><strong>ÂùáÂÄº:</strong> ${pathway.total_effect?.mean?.toFixed(4) || 'N/A'}</div>
                            <div><strong>ÁΩÆ‰ø°Âå∫Èó¥:</strong> [${pathway.total_effect?.hdi_lower?.toFixed(4) || 'N/A'}, ${pathway.total_effect?.hdi_upper?.toFixed(4) || 'N/A'}]</div>
                        </div>
                    </div>
                </div>
                
                <div class="parameter-section">
                    <div class="parameter-title">üìù ÁªìËÆ∫</div>
                    <div class="parameter-content">
                        <div>${pathway.conclusion || 'Êó†ÁªìËÆ∫‰ø°ÊÅØ'}</div>
                    </div>
                </div>
            `;

            modal.style.display = 'flex';
        }

        // CanvasÁΩëÁªúÂõæË∞±Á±ª
        class CanvasNetworkGraph {
            constructor(container) {
                this.container = container;
                this.canvas = null;
                this.ctx = null;
                this.nodes = [];
                this.links = [];
                this.width = 0;
                this.height = 0;
                this.animationId = null;
                
                // Áâ©ÁêÜÊ®°ÊãüÂèÇÊï∞
                this.simulation = {
                    alpha: 1,
                    alphaDecay: 0.0228,
                    velocityDecay: 0.4,
                    forces: {
                        charge: -300,
                        link: 30,
                        center: { x: 0, y: 0 }
                    }
                };
                
                // ‰∫§‰∫íÁä∂ÊÄÅ
                this.isDragging = false;
                this.dragNode = null;
                this.mousePos = { x: 0, y: 0 };
                this.hoveredNode = null;
                this.hoveredLink = null;
                this.transform = { x: 0, y: 0, scale: 1 };
                
                this.init();
            }
            
            init() {
                console.log('CanvasNetworkGraph init() ÂºÄÂßãÊâßË°å');
                console.log('ÂÆπÂô®‰ø°ÊÅØ:', this.container, 'ÂÆπÂô®Â∞∫ÂØ∏:', this.container.getBoundingClientRect());
                
                // ÂàõÂª∫CanvasÂÖÉÁ¥†
                this.canvas = document.createElement('canvas');
                this.canvas.style.cssText = `
                    width: 100%;
                    height: 100%;
                    display: block;
                    cursor: grab;
                    background: #f8f9fa;
                `;
                this.ctx = this.canvas.getContext('2d');
                this.container.appendChild(this.canvas);
                
                console.log('CanvasÂÖÉÁ¥†Â∑≤ÂàõÂª∫Âπ∂Ê∑ªÂä†Âà∞ÂÆπÂô®');
                console.log('CanvasÂÖÉÁ¥†:', this.canvas);
                
                // ËÆæÁΩÆCanvasÂ∞∫ÂØ∏
                this.resize();
                
                console.log('CanvasÂ∞∫ÂØ∏ËÆæÁΩÆÂÆåÊàê:', this.width, 'x', this.height);
                
                // ÁªëÂÆö‰∫ã‰ª∂
                this.bindEvents();
                
                console.log('‰∫ã‰ª∂ÁªëÂÆöÂÆåÊàê');
                
                // ÂºÄÂßãÂä®ÁîªÂæ™ÁéØ
                this.animate();
                
                console.log('Âä®ÁîªÂæ™ÁéØÂ∑≤ÂêØÂä®');
            }
            
            resize() {
                const rect = this.container.getBoundingClientRect();
                this.width = rect.width;
                this.height = rect.height;
                
                // ËÆæÁΩÆCanvasÂÆûÈôÖÂ∞∫ÂØ∏ÔºàËÄÉËôëËÆæÂ§áÂÉèÁ¥†ÊØîÔºâ
                const dpr = window.devicePixelRatio || 1;
                this.canvas.width = this.width * dpr;
                this.canvas.height = this.height * dpr;
                this.canvas.style.width = this.width + 'px';
                this.canvas.style.height = this.height + 'px';
                this.ctx.scale(dpr, dpr);
                
                // Êõ¥Êñ∞‰∏≠ÂøÉÁÇπ
                this.simulation.forces.center = { x: this.width / 2, y: this.height / 2 };
            }
            
            setData(nodes, links) {
                this.nodes = nodes.map(node => ({
                    ...node,
                    x: Math.random() * this.width,
                    y: Math.random() * this.height,
                    vx: 0,
                    vy: 0,
                    fx: null,
                    fy: null
                }));
                
                this.links = links.map(link => ({
                    ...link,
                    source: this.nodes.find(n => n.id === (link.source.id || link.source)),
                    target: this.nodes.find(n => n.id === (link.target.id || link.target))
                })).filter(link => link.source && link.target);
                
                // ÈáçÁΩÆÊ®°Êãü
                this.simulation.alpha = 1;
            }
            
            bindEvents() {
                // Èº†Ê†á‰∫ã‰ª∂
                this.canvas.addEventListener('mousedown', this.onMouseDown.bind(this));
                this.canvas.addEventListener('mousemove', this.onMouseMove.bind(this));
                this.canvas.addEventListener('mouseup', this.onMouseUp.bind(this));
                this.canvas.addEventListener('click', this.onClick.bind(this));
                this.canvas.addEventListener('wheel', this.onWheel.bind(this));
                
                // Á™óÂè£Â§ßÂ∞èÂèòÂåñ
                window.addEventListener('resize', this.resize.bind(this));
            }
            
            getMousePos(event) {
                const rect = this.canvas.getBoundingClientRect();
                return {
                    x: (event.clientX - rect.left - this.transform.x) / this.transform.scale,
                    y: (event.clientY - rect.top - this.transform.y) / this.transform.scale
                };
            }
            
            findNodeAt(x, y) {
                for (let node of this.nodes) {
                    const dx = x - node.x;
                    const dy = y - node.y;
                    const radius = Math.max(8, node.size || 8);
                    if (dx * dx + dy * dy < radius * radius) {
                        return node;
                    }
                }
                return null;
            }
            
            findLinkAt(x, y) {
                const threshold = 5;
                for (let link of this.links) {
                    const dx = link.target.x - link.source.x;
                    const dy = link.target.y - link.source.y;
                    const length = Math.sqrt(dx * dx + dy * dy);
                    
                    if (length === 0) continue;
                    
                    const t = Math.max(0, Math.min(1, ((x - link.source.x) * dx + (y - link.source.y) * dy) / (length * length)));
                    const projection = {
                        x: link.source.x + t * dx,
                        y: link.source.y + t * dy
                    };
                    
                    const distance = Math.sqrt((x - projection.x) ** 2 + (y - projection.y) ** 2);
                    if (distance < threshold) {
                        return link;
                    }
                }
                return null;
            }
            
            onMouseDown(event) {
                const pos = this.getMousePos(event);
                const node = this.findNodeAt(pos.x, pos.y);
                
                if (node) {
                    this.isDragging = true;
                    this.dragNode = node;
                    this.canvas.style.cursor = 'grabbing';
                    node.fx = node.x;
                    node.fy = node.y;
                    this.simulation.alpha = Math.max(this.simulation.alpha, 0.3);
                }
            }
            
            onMouseMove(event) {
                const pos = this.getMousePos(event);
                this.mousePos = pos;
                
                if (this.isDragging && this.dragNode) {
                    this.dragNode.fx = pos.x;
                    this.dragNode.fy = pos.y;
                    this.simulation.alpha = Math.max(this.simulation.alpha, 0.3);
                } else {
                    // Êõ¥Êñ∞ÊÇ¨ÂÅúÁä∂ÊÄÅ
                    const node = this.findNodeAt(pos.x, pos.y);
                    const link = node ? null : this.findLinkAt(pos.x, pos.y);
                    
                    this.hoveredNode = node;
                    this.hoveredLink = link;
                    
                    this.canvas.style.cursor = node ? 'pointer' : 'grab';
                }
            }
            
            onMouseUp(event) {
                if (this.dragNode) {
                    this.dragNode.fx = null;
                    this.dragNode.fy = null;
                }
                this.isDragging = false;
                this.dragNode = null;
                this.canvas.style.cursor = 'grab';
            }
            
            onClick(event) {
                const pos = this.getMousePos(event);
                const node = this.findNodeAt(pos.x, pos.y);
                const link = node ? null : this.findLinkAt(pos.x, pos.y);
                
                if (node) {
                    showVertexDetails(node.id);
                } else if (link) {
                    showEdgeDetails(link.source.id, link.target.id);
                }
            }
            
            onWheel(event) {
                event.preventDefault();
                const pos = this.getMousePos(event);
                const scaleFactor = event.deltaY > 0 ? 0.9 : 1.1;
                const newScale = Math.max(0.1, Math.min(3, this.transform.scale * scaleFactor));
                
                this.transform.x = pos.x - (pos.x - this.transform.x) * (newScale / this.transform.scale);
                this.transform.y = pos.y - (pos.y - this.transform.y) * (newScale / this.transform.scale);
                this.transform.scale = newScale;
            }
            
            // ÂäõÂØºÂêëÂ∏ÉÂ±ÄÊ®°Êãü
            tick() {
                if (this.simulation.alpha < 0.001) return;
                
                // Â∫îÁî®Âäõ
                this.applyForces();
                
                // Êõ¥Êñ∞‰ΩçÁΩÆ
                for (let node of this.nodes) {
                    if (node.fx == null) {
                        node.vx *= this.simulation.velocityDecay;
                        node.x += node.vx;
                    } else {
                        node.x = node.fx;
                        node.vx = 0;
                    }
                    
                    if (node.fy == null) {
                        node.vy *= this.simulation.velocityDecay;
                        node.y += node.vy;
                    } else {
                        node.y = node.fy;
                        node.vy = 0;
                    }
                }
                
                // Ë°∞Âáèalpha
                this.simulation.alpha *= (1 - this.simulation.alphaDecay);
            }
            
            applyForces() {
                const alpha = this.simulation.alpha;
                const nodes = this.nodes;
                const links = this.links;
                
                // ÈáçÁΩÆÂäõ
                for (let node of nodes) {
                    node.fx_temp = 0;
                    node.fy_temp = 0;
                }
                
                // 1. ËäÇÁÇπÈó¥ÊéíÊñ•Âäõ (Coulomb's law)
                const chargeStrength = this.simulation.forces.charge;
                for (let i = 0; i < nodes.length; i++) {
                    const nodeA = nodes[i];
                    for (let j = i + 1; j < nodes.length; j++) {
                        const nodeB = nodes[j];
                        
                        let dx = nodeB.x - nodeA.x;
                        let dy = nodeB.y - nodeA.y;
                        let distanceSquared = dx * dx + dy * dy;
                        
                        // ÈÅøÂÖçÈô§Èõ∂ÂíåËøáÂ∞èË∑ùÁ¶ª
                        if (distanceSquared < 1) {
                            dx = (Math.random() - 0.5) * 2;
                            dy = (Math.random() - 0.5) * 2;
                            distanceSquared = dx * dx + dy * dy;
                        }
                        
                        const distance = Math.sqrt(distanceSquared);
                        const force = chargeStrength * alpha / distanceSquared;
                        const fx = (dx / distance) * force;
                        const fy = (dy / distance) * force;
                        
                        nodeA.fx_temp -= fx;
                        nodeA.fy_temp -= fy;
                        nodeB.fx_temp += fx;
                        nodeB.fy_temp += fy;
                    }
                }
                
                // 2. ËøûÊé•ÂºπÁ∞ßÂäõ (Hooke's law)
                const linkStrength = 0.1;
                for (let link of links) {
                    const source = link.source;
                    const target = link.target;
                    
                    const dx = target.x - source.x;
                    const dy = target.y - source.y;
                    const distance = Math.sqrt(dx * dx + dy * dy) || 1;
                    
                    // Ê†πÊçÆÊùÉÈáçÂíåÂ±ÇÁ∫ßË∞ÉÊï¥ÁõÆÊ†áË∑ùÁ¶ª
                    const baseDistance = this.simulation.forces.link;
                    const weightFactor = link.weight ? Math.max(0.5, 1 / link.weight) : 1;
                    const hierarchyFactor = link.hierarchy ? (1 + link.hierarchy * 0.2) : 1;
                    const targetDistance = baseDistance * weightFactor * hierarchyFactor;
                    
                    const force = (distance - targetDistance) * linkStrength * alpha;
                    const fx = (dx / distance) * force;
                    const fy = (dy / distance) * force;
                    
                    source.fx_temp += fx;
                    source.fy_temp += fy;
                    target.fx_temp -= fx;
                    target.fy_temp -= fy;
                }
                
                // 3. ‰∏≠ÂøÉÂäõ (Âêë‰∏≠ÂøÉËÅöÊã¢)
                const centerStrength = 0.01;
                const centerX = this.simulation.forces.center.x;
                const centerY = this.simulation.forces.center.y;
                
                for (let node of nodes) {
                    const dx = centerX - node.x;
                    const dy = centerY - node.y;
                    node.fx_temp += dx * centerStrength * alpha;
                    node.fy_temp += dy * centerStrength * alpha;
                }
                
                // 4. ËæπÁïåÂäõ (Èò≤Ê≠¢ËäÇÁÇπË∑ëÂá∫ÁîªÂ∏É)
                const boundaryStrength = 0.1;
                const margin = 50;
                
                for (let node of nodes) {
                    // Â∑¶ËæπÁïå
                    if (node.x < margin) {
                        node.fx_temp += (margin - node.x) * boundaryStrength * alpha;
                    }
                    // Âè≥ËæπÁïå
                    if (node.x > this.width - margin) {
                        node.fx_temp -= (node.x - (this.width - margin)) * boundaryStrength * alpha;
                    }
                    // ‰∏äËæπÁïå
                    if (node.y < margin) {
                        node.fy_temp += (margin - node.y) * boundaryStrength * alpha;
                    }
                    // ‰∏ãËæπÁïå
                    if (node.y > this.height - margin) {
                        node.fy_temp -= (node.y - (this.height - margin)) * boundaryStrength * alpha;
                    }
                }
                
                // 5. Â∫îÁî®ÂäõÂà∞ÈÄüÂ∫¶
                for (let node of nodes) {
                    node.vx += node.fx_temp;
                    node.vy += node.fy_temp;
                }
                
                // 6. ÈôêÂà∂ÊúÄÂ§ßÈÄüÂ∫¶
                const maxVelocity = 10;
                for (let node of nodes) {
                    const velocity = Math.sqrt(node.vx * node.vx + node.vy * node.vy);
                    if (velocity > maxVelocity) {
                        const scale = maxVelocity / velocity;
                        node.vx *= scale;
                        node.vy *= scale;
                    }
                }
            }
            
            render() {
                // ÊØè100Â∏ßËæìÂá∫‰∏ÄÊ¨°Ë∞ÉËØï‰ø°ÊÅØ
                if (!this.renderCount) this.renderCount = 0;
                this.renderCount++;
                
                if (this.renderCount % 100 === 1) {
                    console.log('Ê∏≤ÊüìÁ¨¨', this.renderCount, 'Â∏ß, ËäÇÁÇπÊï∞:', this.nodes.length, 'ËæπÊï∞:', this.links.length);
                }
                
                this.ctx.clearRect(0, 0, this.width, this.height);
                
                this.ctx.save();
                this.ctx.translate(this.transform.x, this.transform.y);
                this.ctx.scale(this.transform.scale, this.transform.scale);
                
                // ÁªòÂà∂ËøûÊé•Á∫ø
                this.renderLinks();
                
                // ÁªòÂà∂ËäÇÁÇπ
                this.renderNodes();
                
                this.ctx.restore();
            }
            
            drawMediationIndicator(link) {
                const midX = (link.source.x + link.target.x) / 2;
                const midY = (link.source.y + link.target.y) / 2;
                
                // ËÆ°ÁÆóÂûÇÁõ¥‰∫éËøûÁ∫øÁöÑÂÅèÁßª‰ΩçÁΩÆ
                const dx = link.target.x - link.source.x;
                const dy = link.target.y - link.source.y;
                const length = Math.sqrt(dx * dx + dy * dy);
                
                if (length === 0) return;
                
                // ÂûÇÁõ¥ÊñπÂêëÁöÑÂçï‰ΩçÂêëÈáè
                const perpX = -dy / length;
                const perpY = dx / length;
                
                // ÊåáÁ§∫Âô®‰ΩçÁΩÆÔºàÂÅèÁßªÂà∞ËøûÁ∫ø‰∏Ä‰æßÔºâ
                const offset = 15;
                const indicatorX = midX + perpX * offset;
                const indicatorY = midY + perpY * offset;
                
                this.ctx.save();
                
                // ÁªòÂà∂‰∏≠‰ªãÊïàÂ∫îÊåáÁ§∫Âô®ÔºàÂ∞èËè±ÂΩ¢Ôºâ
                const size = 6;
                this.ctx.beginPath();
                this.ctx.moveTo(indicatorX, indicatorY - size);
                this.ctx.lineTo(indicatorX + size, indicatorY);
                this.ctx.lineTo(indicatorX, indicatorY + size);
                this.ctx.lineTo(indicatorX - size, indicatorY);
                this.ctx.closePath();
                
                // Ê†πÊçÆ‰∏≠‰ªãÊïàÂ∫îÂº∫Â∫¶ËÆæÁΩÆÈ¢úËâ≤
                let indicatorColor = '#f39c12';
                if (link.mediationEffect > 0.7) {
                    indicatorColor = '#e74c3c';
                } else if (link.mediationEffect > 0.3) {
                    indicatorColor = '#f39c12';
                } else {
                    indicatorColor = '#27ae60';
                }
                
                this.ctx.fillStyle = indicatorColor;
                this.ctx.fill();
                this.ctx.strokeStyle = '#fff';
                this.ctx.lineWidth = 1;
                this.ctx.stroke();
                
                // Ê∑ªÂä†‰∏≠‰ªãÊïàÂ∫îÂÄºÊ†áÁ≠æ
                this.ctx.fillStyle = '#333';
                this.ctx.font = '8px Arial';
                this.ctx.textAlign = 'center';
                this.ctx.textBaseline = 'middle';
                
                const effectText = `M:${link.mediationEffect.toFixed(2)}`;
                const textY = indicatorY + size + 10;
                
                // ÊñáÂ≠óËÉåÊôØ
                const metrics = this.ctx.measureText(effectText);
                const padding = 2;
                this.ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
                this.ctx.fillRect(
                    indicatorX - metrics.width / 2 - padding,
                    textY - 4 - padding,
                    metrics.width + padding * 2,
                    8 + padding * 2
                );
                
                // ÊñáÂ≠ó
                this.ctx.fillStyle = '#333';
                this.ctx.fillText(effectText, indicatorX, textY);
                
                this.ctx.restore();
            }
            
            renderLinks() {
                for (let link of this.links) {
                    const isHovered = this.hoveredLink === link;
                    
                    // Ê†πÊçÆÂÖ≥Á≥ªÁ±ªÂûãËÆæÁΩÆÈ¢úËâ≤
                    let linkColor = link.color || '#999';
                    if (link.relation) {
                        switch (link.relation.toLowerCase()) {
                            case 'positive':
                            case 'activation':
                                linkColor = '#27ae60';
                                break;
                            case 'negative':
                            case 'inhibition':
                                linkColor = '#e74c3c';
                                break;
                            case 'regulation':
                                linkColor = '#3498db';
                                break;
                            case 'interaction':
                                linkColor = '#9b59b6';
                                break;
                            case 'pathway':
                                linkColor = '#f39c12';
                                break;
                            default:
                                linkColor = link.color || '#999';
                        }
                    }
                    
                    // Ê†πÊçÆÊùÉÈáçË∞ÉÊï¥Á∫øÂÆΩ
                    let lineWidth = link.width || 1;
                    if (link.weight) {
                        lineWidth = Math.max(1, Math.min(5, link.weight * 3));
                    }
                    
                    // ÊÇ¨ÂÅúÊïàÊûú
                    if (isHovered) {
                        linkColor = '#ff6b6b';
                        lineWidth += 2;
                    }
                    
                    // ÁªòÂà∂ËøûÊé•Á∫ø
                    this.ctx.beginPath();
                    this.ctx.moveTo(link.source.x, link.source.y);
                    this.ctx.lineTo(link.target.x, link.target.y);
                    
                    this.ctx.strokeStyle = linkColor;
                    this.ctx.lineWidth = lineWidth;
                    this.ctx.globalAlpha = isHovered ? 1 : (link.opacity || 0.6);
                    
                    // Ê†πÊçÆË¥®ÈáèÁ≠âÁ∫ßËÆæÁΩÆÁ∫øÂûã
                    if (link.quality) {
                        switch (link.quality.toLowerCase()) {
                            case 'high':
                                this.ctx.setLineDash([]);
                                break;
                            case 'medium':
                                this.ctx.setLineDash([5, 3]);
                                break;
                            case 'low':
                                this.ctx.setLineDash([3, 3]);
                                break;
                            default:
                                this.ctx.setLineDash([]);
                        }
                    } else {
                        this.ctx.setLineDash([]);
                    }
                    
                    this.ctx.stroke();
                    this.ctx.setLineDash([]); // ÈáçÁΩÆÁ∫øÂûã
                    
                    // ÁªòÂà∂ÁÆ≠Â§¥
                    if (link.isDirect) {
                        this.drawArrow(link.source, link.target, isHovered);
                    }
                    
                    // ÁªòÂà∂ÊùÉÈáçÊ†áÁ≠æ
                    if (link.hasWeight && (isHovered || this.transform.scale > 1.5)) {
                        this.drawLinkLabel(link);
                    }
                    
                    // ÁªòÂà∂‰∏≠‰ªãÊïàÂ∫îÊåáÁ§∫Âô®
                    if (link.mediationEffect && (isHovered || this.transform.scale > 1.2)) {
                        this.drawMediationIndicator(link);
                    }
                }
                this.ctx.globalAlpha = 1;
            }
            
            drawArrow(source, target, isHovered) {
                const dx = target.x - source.x;
                const dy = target.y - source.y;
                const length = Math.sqrt(dx * dx + dy * dy);
                
                if (length === 0) return;
                
                const arrowLength = isHovered ? 12 : 8;
                const nodeRadius = Math.max(8, target.size || 8);
                
                // ÁÆ≠Â§¥‰ΩçÁΩÆÔºàÂú®ÁõÆÊ†áËäÇÁÇπËæπÁºòÔºâ
                const arrowX = target.x - (dx / length) * nodeRadius;
                const arrowY = target.y - (dy / length) * nodeRadius;
                
                // ÁÆ≠Â§¥ÊñπÂêë
                const angle = Math.atan2(dy, dx);
                
                this.ctx.beginPath();
                this.ctx.moveTo(arrowX, arrowY);
                this.ctx.lineTo(
                    arrowX - arrowLength * Math.cos(angle - Math.PI / 6),
                    arrowY - arrowLength * Math.sin(angle - Math.PI / 6)
                );
                this.ctx.moveTo(arrowX, arrowY);
                this.ctx.lineTo(
                    arrowX - arrowLength * Math.cos(angle + Math.PI / 6),
                    arrowY - arrowLength * Math.sin(angle + Math.PI / 6)
                );
                this.ctx.stroke();
            }
            
            drawLinkLabel(link) {
                const midX = (link.source.x + link.target.x) / 2;
                const midY = (link.source.y + link.target.y) / 2;
                
                this.ctx.save();
                this.ctx.fillStyle = '#333';
                this.ctx.font = '10px Arial';
                this.ctx.textAlign = 'center';
                this.ctx.textBaseline = 'middle';
                
                // ËÉåÊôØ
                const text = link.finalWeight.toFixed(3);
                const metrics = this.ctx.measureText(text);
                const padding = 4;
                
                this.ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
                this.ctx.fillRect(
                    midX - metrics.width / 2 - padding,
                    midY - 6 - padding,
                    metrics.width + padding * 2,
                    12 + padding * 2
                );
                
                // ÊñáÂ≠ó
                this.ctx.fillStyle = '#333';
                this.ctx.fillText(text, midX, midY);
                
                this.ctx.restore();
            }
            
            renderNodes() {
                for (let node of this.nodes) {
                    const isHovered = this.hoveredNode === node;
                    const isDragging = this.dragging && this.dragging.node === node;
                    
                    // ËäÇÁÇπÂü∫Á°ÄÊ†∑Âºè
                    let radius = Math.max(8, node.size || 8);
                    let fillColor = node.color || '#69b3a2';
                    let strokeColor = '#fff';
                    let strokeWidth = 2;
                    
                    // ÊÇ¨ÂÅúÂíåÊãñÊãΩÊïàÊûú
                    if (isHovered || isDragging) {
                        radius += 3;
                        strokeWidth = 3;
                        strokeColor = '#333';
                    }
                    
                    // Ê†πÊçÆËäÇÁÇπÁ±ªÂûãË∞ÉÊï¥Ê†∑Âºè
                    if (node.type) {
                        switch (node.type.toLowerCase()) {
                            case 'gene':
                                fillColor = '#ff6b6b';
                                break;
                            case 'protein':
                                fillColor = '#4ecdc4';
                                break;
                            case 'pathway':
                                fillColor = '#45b7d1';
                                break;
                            case 'disease':
                                fillColor = '#f9ca24';
                                break;
                            case 'drug':
                                fillColor = '#6c5ce7';
                                break;
                            default:
                                fillColor = node.color || '#a8e6cf';
                        }
                    }
                    
                    // ÁªòÂà∂ËäÇÁÇπÈò¥ÂΩ±ÔºàÂ¢ûÂº∫ËßÜËßâÊïàÊûúÔºâ
                    if (isHovered || isDragging) {
                        this.ctx.save();
                        this.ctx.shadowColor = 'rgba(0, 0, 0, 0.3)';
                        this.ctx.shadowBlur = 10;
                        this.ctx.shadowOffsetX = 2;
                        this.ctx.shadowOffsetY = 2;
                    }
                    
                    // ÁªòÂà∂ËäÇÁÇπ‰∏ª‰Ωì
                    this.ctx.beginPath();
                    this.ctx.arc(node.x, node.y, radius, 0, 2 * Math.PI);
                    this.ctx.fillStyle = fillColor;
                    this.ctx.fill();
                    this.ctx.strokeStyle = strokeColor;
                    this.ctx.lineWidth = strokeWidth;
                    this.ctx.stroke();
                    
                    if (isHovered || isDragging) {
                        this.ctx.restore();
                    }
                    
                    // ÁªòÂà∂ËäÇÁÇπÂ∫¶Êï∞ÊåáÁ§∫Âô®ÔºàÂ∞èÂúÜÂúàÔºâ
                    if (node.degree && node.degree > 5) {
                        const indicatorRadius = Math.min(radius * 0.3, 6);
                        this.ctx.beginPath();
                        this.ctx.arc(node.x + radius * 0.7, node.y - radius * 0.7, indicatorRadius, 0, 2 * Math.PI);
                        this.ctx.fillStyle = '#ff4757';
                        this.ctx.fill();
                        this.ctx.strokeStyle = '#fff';
                        this.ctx.lineWidth = 1;
                        this.ctx.stroke();
                        
                        // Â∫¶Êï∞ÊñáÂ≠ó
                        this.ctx.fillStyle = '#fff';
                        this.ctx.font = `${Math.max(8, indicatorRadius)}px Arial`;
                        this.ctx.textAlign = 'center';
                        this.ctx.textBaseline = 'middle';
                        this.ctx.fillText(node.degree.toString(), node.x + radius * 0.7, node.y - radius * 0.7);
                    }
                    
                    // ËäÇÁÇπÊ†áÁ≠æ
                    if (isHovered || this.transform.scale > 1.2) {
                        this.drawNodeLabel(node, isHovered);
                    }
                    
                    // ËäÇÁÇπËØ¶ÁªÜ‰ø°ÊÅØ
                    if (isHovered) {
                        this.drawNodeDetails(node);
                    }
                }
            }
            
            drawNodeLabel(node, isHovered) {
                this.ctx.save();
                this.ctx.fillStyle = '#333';
                this.ctx.font = isHovered ? 'bold 12px Arial' : '10px Arial';
                this.ctx.textAlign = 'center';
                this.ctx.textBaseline = 'top';
                
                const text = node.name || node.id;
                const y = node.y + Math.max(8, node.size || 8) + 5;
                
                // ËÉåÊôØ
                if (isHovered) {
                    const metrics = this.ctx.measureText(text);
                    const padding = 4;
                    
                    this.ctx.fillStyle = 'rgba(255, 255, 255, 0.95)';
                    this.ctx.fillRect(
                        node.x - metrics.width / 2 - padding,
                        y - padding,
                        metrics.width + padding * 2,
                        16 + padding * 2
                    );
                }
                
                // ÊñáÂ≠ó
                this.ctx.fillStyle = '#333';
                this.ctx.fillText(text, node.x, y);
                
                this.ctx.restore();
            }
            
            drawNodeDetails(node) {
                const details = [];
                
                // Âü∫Á°Ä‰ø°ÊÅØ
                details.push(`ÂêçÁß∞: ${node.name || node.id}`);
                if (node.type) details.push(`Á±ªÂûã: ${node.type}`);
                
                // Â∫¶Êï∞‰ø°ÊÅØ
                if (node.totalDegree !== undefined) details.push(`ÊÄªÂ∫¶Êï∞: ${node.totalDegree}`);
                if (node.inDegree !== undefined) details.push(`ÂÖ•Â∫¶: ${node.inDegree}`);
                if (node.outDegree !== undefined) details.push(`Âá∫Â∫¶: ${node.outDegree}`);
                
                // ÊùÉÈáçÂíåÂ±ÇÁ∫ß‰ø°ÊÅØ
                if (node.weight !== undefined) details.push(`ÊùÉÈáç: ${node.weight.toFixed(3)}`);
                if (node.hierarchy !== undefined) details.push(`Â±ÇÁ∫ß: ${node.hierarchy}`);
                
                // ‰∏≠ÂøÉÊÄßÊåáÊ†á
                if (node.betweennessCentrality !== undefined) {
                    details.push(`‰ªãÊï∞‰∏≠ÂøÉÊÄß: ${node.betweennessCentrality.toFixed(3)}`);
                }
                if (node.closenessCentrality !== undefined) {
                    details.push(`Êé•Ëøë‰∏≠ÂøÉÊÄß: ${node.closenessCentrality.toFixed(3)}`);
                }
                if (node.pageRank !== undefined) {
                    details.push(`PageRank: ${node.pageRank.toFixed(3)}`);
                }
                
                // ÁîüÁâ©Â≠¶‰ø°ÊÅØÔºàÂ¶ÇÊûúÊòØÂü∫Âõ†ÊàñËõãÁôΩË¥®Ôºâ
                if (node.type && (node.type.toLowerCase() === 'gene' || node.type.toLowerCase() === 'protein')) {
                    if (node.expression !== undefined) {
                        details.push(`Ë°®ËææÊ∞¥Âπ≥: ${node.expression.toFixed(2)}`);
                    }
                    if (node.pValue !== undefined) {
                        details.push(`PÂÄº: ${node.pValue.toExponential(2)}`);
                    }
                    if (node.foldChange !== undefined) {
                        details.push(`ÂÄçÊï∞ÂèòÂåñ: ${node.foldChange.toFixed(2)}`);
                    }
                }
                
                // ÈÄöË∑Ø‰ø°ÊÅØÔºàÂ¶ÇÊûúÊòØÈÄöË∑ØËäÇÁÇπÔºâ
                if (node.type && node.type.toLowerCase() === 'pathway') {
                    if (node.pathwaySize !== undefined) {
                        details.push(`ÈÄöË∑ØÂ§ßÂ∞è: ${node.pathwaySize}`);
                    }
                    if (node.enrichmentScore !== undefined) {
                        details.push(`ÂØåÈõÜÂàÜÊï∞: ${node.enrichmentScore.toFixed(3)}`);
                    }
                }
                
                // ÁñæÁóÖ‰ø°ÊÅØÔºàÂ¶ÇÊûúÊòØÁñæÁóÖËäÇÁÇπÔºâ
                if (node.type && node.type.toLowerCase() === 'disease') {
                    if (node.prevalence !== undefined) {
                        details.push(`ÊÇ£ÁóÖÁéá: ${(node.prevalence * 100).toFixed(1)}%`);
                    }
                    if (node.severity !== undefined) {
                        details.push(`‰∏•ÈáçÁ®ãÂ∫¶: ${node.severity}`);
                    }
                }
                
                // ËçØÁâ©‰ø°ÊÅØÔºàÂ¶ÇÊûúÊòØËçØÁâ©ËäÇÁÇπÔºâ
                if (node.type && node.type.toLowerCase() === 'drug') {
                    if (node.dosage !== undefined) {
                        details.push(`ÂâÇÈáè: ${node.dosage}`);
                    }
                    if (node.efficacy !== undefined) {
                        details.push(`ÁñóÊïà: ${node.efficacy.toFixed(2)}`);
                    }
                }
                
                if (details.length === 0) return;
                
                this.ctx.save();
                this.ctx.font = '10px Arial';
                this.ctx.textAlign = 'left';
                this.ctx.textBaseline = 'top';
                
                const lineHeight = 14;
                const padding = 8;
                const maxWidth = Math.max(...details.map(d => this.ctx.measureText(d).width));
                const boxWidth = Math.min(maxWidth + padding * 2, 200); // ÈôêÂà∂ÊúÄÂ§ßÂÆΩÂ∫¶
                const boxHeight = details.length * lineHeight + padding * 2;
                
                let x = node.x + 20;
                let y = node.y - boxHeight / 2;
                
                // Á°Æ‰øù‰∏çË∂ÖÂá∫ÁîªÂ∏ÉËæπÁïå
                if (x + boxWidth > this.width / this.transform.scale) {
                    x = node.x - boxWidth - 20;
                }
                if (y < 0) y = 10;
                if (y + boxHeight > this.height / this.transform.scale) {
                    y = this.height / this.transform.scale - boxHeight - 10;
                }
                
                // ÁªòÂà∂Èò¥ÂΩ±
                this.ctx.fillStyle = 'rgba(0, 0, 0, 0.2)';
                this.ctx.fillRect(x + 2, y + 2, boxWidth, boxHeight);
                
                // ËÉåÊôØÊ∏êÂèò
                const gradient = this.ctx.createLinearGradient(x, y, x, y + boxHeight);
                gradient.addColorStop(0, 'rgba(0, 0, 0, 0.95)');
                gradient.addColorStop(1, 'rgba(0, 0, 0, 0.85)');
                this.ctx.fillStyle = gradient;
                this.ctx.fillRect(x, y, boxWidth, boxHeight);
                
                // ËæπÊ°Ü
                this.ctx.strokeStyle = '#4ecdc4';
                this.ctx.lineWidth = 2;
                this.ctx.strokeRect(x, y, boxWidth, boxHeight);
                
                // Ê†áÈ¢òËÉåÊôØ
                this.ctx.fillStyle = 'rgba(78, 205, 196, 0.2)';
                this.ctx.fillRect(x, y, boxWidth, lineHeight + padding);
                
                // ÊñáÂ≠ó
                details.forEach((detail, i) => {
                    if (i === 0) {
                        // Ê†áÈ¢ò‰ΩøÁî®‰∏çÂêåÈ¢úËâ≤
                        this.ctx.fillStyle = '#4ecdc4';
                        this.ctx.font = 'bold 10px Arial';
                    } else {
                        this.ctx.fillStyle = '#fff';
                        this.ctx.font = '10px Arial';
                    }
                    
                    // ÊñáÂ≠óÊà™Êñ≠Â§ÑÁêÜ
                    let text = detail;
                    const textWidth = this.ctx.measureText(text).width;
                    if (textWidth > boxWidth - padding * 2) {
                        while (this.ctx.measureText(text + '...').width > boxWidth - padding * 2 && text.length > 0) {
                            text = text.slice(0, -1);
                        }
                        text += '...';
                    }
                    
                    this.ctx.fillText(text, x + padding, y + padding + i * lineHeight);
                });
                
                this.ctx.restore();
            }
            
            animate() {
                this.tick();
                this.render();
                this.animationId = requestAnimationFrame(() => this.animate());
            }
            
            destroy() {
                if (this.animationId) {
                    cancelAnimationFrame(this.animationId);
                }
                if (this.canvas && this.canvas.parentNode) {
                    this.canvas.parentNode.removeChild(this.canvas);
                }
            }
        }



        // ÊòæÁ§∫ËäÇÁÇπËØ¶ÁªÜ‰ø°ÊÅØ - Â¢ûÂº∫ÁâàÊú¨
        function showVertexDetails(vertexId) {
            const modal = document.getElementById('detail-modal');
            const title = document.getElementById('modal-title');
            const body = document.getElementById('modal-body');

            title.textContent = `ËäÇÁÇπËØ¶ÊÉÖ: ${vertexId}`;
            
            // Ëé∑ÂèñËäÇÁÇπÂü∫Êú¨‰ø°ÊÅØ
            const type = vertexId.split('_')[0];
            const name = vertexId.split('_').slice(1).join('_');
            
            // ËÆ°ÁÆóËøûÊé•‰ø°ÊÅØ
            const incomingEdges = knowledgeGraph.E_core.filter(edge => edge.target === vertexId);
            const outgoingEdges = knowledgeGraph.E_core.filter(edge => edge.source === vertexId);
            const allEdges = [...incomingEdges, ...outgoingEdges];
            
            // ÁªüËÆ°‰∏çÂêåÁ±ªÂûãÁöÑËæπ
            const triangulatedEdges = allEdges.filter(e => e.edge_hierarchy === 'triangulated_verified');
            const directEdges = allEdges.filter(e => e.is_direct);
            
            // Ëé∑ÂèñÁõ∏ÂÖ≥ÁöÑÊùÉÈáçÊï∞ÊçÆ
            const relatedWeights = [];
            allEdges.forEach(edge => {
                if (edge.weight_ref && knowledgeGraph.W && knowledgeGraph.W[edge.weight_ref]) {
                    relatedWeights.push({
                        ref: edge.weight_ref,
                        data: knowledgeGraph.W[edge.weight_ref],
                        edge: edge
                    });
                }
            });
            
            // Ëé∑ÂèñÁõ∏ÂÖ≥ÁöÑÊù°‰ª∂Ê¶ÇÁéáÊï∞ÊçÆ
            const relatedTheta = [];
            if (knowledgeGraph.Theta) {
                Object.entries(knowledgeGraph.Theta).forEach(([key, data]) => {
                    if (key.includes(vertexId)) {
                        relatedTheta.push({ key, data });
                    }
                });
            }
            
            // Ëé∑ÂèñÁõ∏ÂÖ≥ÁöÑ‰∏≠‰ªãÊïàÂ∫îÊï∞ÊçÆ
            const relatedPhi = [];
            if (knowledgeGraph.Phi) {
                Object.entries(knowledgeGraph.Phi).forEach(([key, data]) => {
                    if (key.includes(vertexId)) {
                        relatedPhi.push({ key, data });
                    }
                });
            }

            // ËÆ°ÁÆóËäÇÁÇπÁöÑÂΩ±ÂìçÂäõÊåáÊ†á
            const nodeInfluence = calculateNodeInfluence(vertexId, allEdges, relatedWeights);
            
            // Ëé∑ÂèñËäÇÁÇπÁöÑÂõ†ÊûúË∑ØÂæÑ‰ø°ÊÅØ
            const causalPaths = getCausalPaths(vertexId, knowledgeGraph.E_core);
            
            // ËÆ°ÁÆóËäÇÁÇπÁöÑÁ®≥ÂÆöÊÄßÊåáÊ†á
            const stabilityMetrics = calculateNodeStability(vertexId, relatedWeights, relatedTheta);

            body.innerHTML = `
                <div class="parameter-section">
                    <div class="parameter-title">üè∑Ô∏è ËäÇÁÇπÂü∫Êú¨‰ø°ÊÅØ</div>
                    <div class="parameter-content">
                        <div><strong>ÂÆåÊï¥ÂêçÁß∞:</strong> ${vertexId}</div>
                        <div><strong>ÊòæÁ§∫ÂêçÁß∞:</strong> ${name}</div>
                        <div><strong>ËäÇÁÇπÁ±ªÂûã:</strong> <span class="relation-badge ${type}">${type}</span></div>
                        <div><strong>ËäÇÁÇπÈ¢úËâ≤:</strong> <span style="display: inline-block; width: 20px; height: 20px; background: ${getNodeColor(type)}; border-radius: 50%; margin-left: 10px;"></span></div>
                    </div>
                </div>
                
                <div class="parameter-section">
                    <div class="parameter-title">üîó ËøûÊé•ÁªüËÆ°</div>
                    <div class="parameter-content">
                        <div><strong>ÂÖ•Â∫¶:</strong> ${incomingEdges.length}</div>
                        <div><strong>Âá∫Â∫¶:</strong> ${outgoingEdges.length}</div>
                        <div><strong>ÊÄªËøûÊé•Êï∞:</strong> ${allEdges.length}</div>
                        <div><strong>‰∏âËßíÈ™åËØÅËæπ:</strong> ${triangulatedEdges.length}</div>
                        <div><strong>Áõ¥Êé•ÂÖ≥Á≥ªËæπ:</strong> ${directEdges.length}</div>
                        <div><strong>È™åËØÅÁéá:</strong> ${allEdges.length > 0 ? ((triangulatedEdges.length / allEdges.length) * 100).toFixed(1) : 0}%</div>
                    </div>
                </div>
                
                <div class="parameter-section">
                    <div class="parameter-title">üìä Áõ∏ÂÖ≥ÊùÉÈáçÊï∞ÊçÆ (${relatedWeights.length})</div>
                    <div class="parameter-content">
                        ${relatedWeights.length > 0 ? relatedWeights.slice(0, 5).map(w => `
                            <div style="margin-bottom: 10px; padding: 10px; background: white; border-radius: 5px; border-left: 3px solid #4facfe;">
                                <strong>${w.ref}</strong><br>
                                <small>ÊúÄÁªàÊùÉÈáç: ${w.data.hierarchy_weight?.final_weight?.toFixed(4) || 'N/A'}</small><br>
                                <small>Ëæπ: ${w.edge.source} ‚Üí ${w.edge.target}</small>
                            </div>
                        `).join('') : '<div style="color: #666;">Êó†Áõ∏ÂÖ≥ÊùÉÈáçÊï∞ÊçÆ</div>'}
                        ${relatedWeights.length > 5 ? `<div style="text-align: center; color: #666; margin-top: 10px;">... ËøòÊúâ ${relatedWeights.length - 5} ‰∏™ÊùÉÈáçÊï∞ÊçÆ</div>` : ''}
                    </div>
                </div>
                
                <div class="parameter-section">
                    <div class="parameter-title">üéØ Êù°‰ª∂Ê¶ÇÁéáË°® Œò (${relatedTheta.length})</div>
                    <div class="parameter-content">
                        ${relatedTheta.length > 0 ? relatedTheta.slice(0, 3).map(t => `
                            <div style="margin-bottom: 10px; padding: 10px; background: white; border-radius: 5px; border-left: 3px solid #28a745;">
                                <strong>${t.key}</strong><br>
                                <small>Ê¶ÇÁéáË°®È°π: ${Object.keys(t.data.conditional_probability_table || {}).length}</small>
                            </div>
                        `).join('') : '<div style="color: #666;">Êó†Áõ∏ÂÖ≥Êù°‰ª∂Ê¶ÇÁéáÊï∞ÊçÆ</div>'}
                        ${relatedTheta.length > 3 ? `<div style="text-align: center; color: #666; margin-top: 10px;">... ËøòÊúâ ${relatedTheta.length - 3} ‰∏™Ê¶ÇÁéáË°®</div>` : ''}
                    </div>
                </div>
                
                <div class="parameter-section">
                    <div class="parameter-title">üîÑ ‰∏≠‰ªãÊïàÂ∫î Œ¶ (${relatedPhi.length})</div>
                    <div class="parameter-content">
                        ${relatedPhi.length > 0 ? relatedPhi.slice(0, 3).map(p => `
                            <div style="margin-bottom: 10px; padding: 10px; background: white; border-radius: 5px; border-left: 3px solid #e74c3c;">
                                <strong>${p.key}</strong><br>
                                <small>‰∏≠‰ªãË∑ØÂæÑ: ${Object.keys(p.data.mediation_effects || {}).length}</small>
                            </div>
                        `).join('') : '<div style="color: #666;">Êó†Áõ∏ÂÖ≥‰∏≠‰ªãÊïàÂ∫îÊï∞ÊçÆ</div>'}
                        ${relatedPhi.length > 3 ? `<div style="text-align: center; color: #666; margin-top: 10px;">... ËøòÊúâ ${relatedPhi.length - 3} ‰∏™‰∏≠‰ªãÊïàÂ∫î</div>` : ''}
                    </div>
                </div>
                
                <div class="parameter-section">
                    <div class="parameter-title">üîó Áõ∏ÈÇªËäÇÁÇπ</div>
                    <div class="parameter-content">
                        <div style="margin-bottom: 10px;">
                            <strong>ÂÖ•ÈÇªÂ±Ö (${incomingEdges.length}):</strong><br>
                            ${incomingEdges.slice(0, 10).map(e => `
                                <span style="display: inline-block; margin: 2px 5px 2px 0; padding: 2px 8px; background: #e3f2fd; border-radius: 12px; font-size: 12px;">
                                    ${e.source}
                                </span>
                            `).join('')}
                            ${incomingEdges.length > 10 ? `<span style="color: #666;">... ËøòÊúâ ${incomingEdges.length - 10} ‰∏™</span>` : ''}
                        </div>
                        <div>
                            <strong>Âá∫ÈÇªÂ±Ö (${outgoingEdges.length}):</strong><br>
                            ${outgoingEdges.slice(0, 10).map(e => `
                                <span style="display: inline-block; margin: 2px 5px 2px 0; padding: 2px 8px; background: #fff3e0; border-radius: 12px; font-size: 12px;">
                                    ${e.target}
                                </span>
                            `).join('')}
                            ${outgoingEdges.length > 10 ? `<span style="color: #666;">... ËøòÊúâ ${outgoingEdges.length - 10} ‰∏™</span>` : ''}
                        </div>
                    </div>
                </div>
            `;

            modal.style.display = 'flex';
        }

        // ÊòæÁ§∫ËæπËØ¶ÁªÜ‰ø°ÊÅØ - Â¢ûÂº∫ÁâàÊú¨
        function showEdgeDetails(sourceId, targetId) {
            const modal = document.getElementById('detail-modal');
            const title = document.getElementById('modal-title');
            const body = document.getElementById('modal-body');

            title.textContent = `ËæπËØ¶ÊÉÖ: ${sourceId} ‚Üí ${targetId}`;
            
            // Êü•ÊâæÂØπÂ∫îÁöÑËæπ
            const edge = knowledgeGraph.E_core.find(e => 
                e.source === sourceId && e.target === targetId
            );
            
            if (!edge) {
                body.innerHTML = '<div>Êú™ÊâæÂà∞ÂØπÂ∫îÁöÑËæπÊï∞ÊçÆ</div>';
                modal.style.display = 'flex';
                return;
            }
            
            // Ëé∑ÂèñÊùÉÈáçÊï∞ÊçÆ
            const weightData = edge.weight_ref && knowledgeGraph.W ? 
                knowledgeGraph.W[edge.weight_ref] : null;
            
            // Ëé∑ÂèñÁõ∏ÂÖ≥ÁöÑ‰∏≠‰ªãÊïàÂ∫îÊï∞ÊçÆ
            const relatedMediation = [];
            if (knowledgeGraph.Phi) {
                Object.entries(knowledgeGraph.Phi).forEach(([key, data]) => {
                    if (key.includes(sourceId) && key.includes(targetId)) {
                        relatedMediation.push({ key, data });
                    }
                });
            }

            body.innerHTML = `
                <div class="parameter-section">
                    <div class="parameter-title">üîó ËæπÂü∫Êú¨‰ø°ÊÅØ</div>
                    <div class="parameter-content">
                        <div><strong>Ê∫êËäÇÁÇπ:</strong> ${edge.source}</div>
                        <div><strong>ÁõÆÊ†áËäÇÁÇπ:</strong> ${edge.target}</div>
                        <div><strong>ÂÖ≥Á≥ªÁ±ªÂûã:</strong> <span class="relation-badge ${edge.relation_type}">${edge.relation_type}</span></div>
                        <div><strong>ËæπÂ±ÇÊ¨°:</strong> ${edge.edge_hierarchy}</div>
                        <div><strong>ÊòØÂê¶Áõ¥Êé•:</strong> ${edge.is_direct ? '‚úÖ ÊòØ' : '‚ùå Âê¶'}</div>
                        <div><strong>ËØÜÂà´Êó∂Èó¥:</strong> ${edge.identification_time || 'N/A'}</div>
                        <div><strong>ÊùÉÈáçÂºïÁî®:</strong> ${edge.weight_ref || 'Êó†'}</div>
                    </div>
                </div>
                
                ${weightData ? `
                <div class="parameter-section">
                    <div class="parameter-title">‚öñÔ∏è ÊùÉÈáçËØ¶ÁªÜ‰ø°ÊÅØ</div>
                    <div class="parameter-content">
                        <div><strong>ÊùÉÈáçID:</strong> ${edge.weight_ref}</div>
                        <div><strong>ÊúÄÁªàÊùÉÈáç:</strong> ${weightData.hierarchy_weight?.final_weight?.toFixed(4) || 'N/A'}</div>
                        <div><strong>Âü∫Á°ÄÊùÉÈáç:</strong> ${weightData.base_weight?.weight?.toFixed(4) || 'N/A'}</div>
                        <div><strong>ÊùÉÈáçÁ±ªÂûã:</strong> ${weightData.base_weight?.weight_type || 'N/A'}</div>
                        <div><strong>ÁΩÆ‰ø°Â∫¶:</strong> ${weightData.base_weight?.confidence?.toFixed(4) || 'N/A'}</div>
                        <div><strong>Êï∞ÊçÆÊù•Ê∫ê:</strong> ${weightData.base_weight?.data_source || 'N/A'}</div>
                        ${weightData.hierarchy_weight?.adjustment_factors ? `
                            <div><strong>Ë∞ÉÊï¥Âõ†Â≠ê:</strong></div>
                            <div style="margin-left: 20px;">
                                ${Object.entries(weightData.hierarchy_weight.adjustment_factors).map(([key, value]) => `
                                    <div>${key}: ${typeof value === 'number' ? value.toFixed(4) : value}</div>
                                `).join('')}
                            </div>
                        ` : ''}
                    </div>
                </div>
                ` : ''}
                
                <div class="parameter-section">
                    <div class="parameter-title">üîÑ Áõ∏ÂÖ≥‰∏≠‰ªãÊïàÂ∫î (${relatedMediation.length})</div>
                    <div class="parameter-content">
                        ${relatedMediation.length > 0 ? relatedMediation.map(m => `
                            <div style="margin-bottom: 15px; padding: 10px; background: white; border-radius: 5px; border-left: 3px solid #e74c3c;">
                                <strong>${m.key}</strong><br>
                                <small>‰∏≠‰ªãË∑ØÂæÑÊï∞: ${Object.keys(m.data.mediation_effects || {}).length}</small><br>
                                <button onclick="showMediationDetails('${m.key}')" style="margin-top: 5px; padding: 4px 8px; background: #e74c3c; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 12px;">
                                    Êü•ÁúãËØ¶ÊÉÖ
                                </button>
                            </div>
                        `).join('') : '<div style="color: #666;">Êó†Áõ∏ÂÖ≥‰∏≠‰ªãÊïàÂ∫îÊï∞ÊçÆ</div>'}
                    </div>
                </div>
                
                <div class="parameter-section">
                    <div class="parameter-title">üìä ËæπÁªüËÆ°‰ø°ÊÅØ</div>
                    <div class="parameter-content">
                        <div><strong>ËæπÈ¢úËâ≤:</strong> <span style="display: inline-block; width: 30px; height: 4px; background: ${getEdgeColor(edge.relation_type)}; margin-left: 10px;"></span></div>
                        <div><strong>ËæπÂÆΩÂ∫¶:</strong> ${edge.edge_hierarchy === 'triangulated_verified' ? '3px (È™åËØÅËæπ)' : '1px (ÂÄôÈÄâËæπ)'}</div>
                        <div><strong>ÈÄèÊòéÂ∫¶:</strong> ${edge.edge_hierarchy === 'triangulated_verified' ? '100% (È™åËØÅËæπ)' : '70% (ÂÄôÈÄâËæπ)'}</div>
                        <div><strong>Âú®Âõæ‰∏≠ÊòæÁ§∫:</strong> ‚úÖ ÊòØ</div>
                    </div>
                </div>
            `;

            modal.style.display = 'flex';
        }

        // ÊòæÁ§∫ÂÖ≥Á≥ªËØ¶ÊÉÖ
        function showRelationDetails(relationType) {
            const modal = document.getElementById('detail-modal');
            const title = document.getElementById('modal-title');
            const body = document.getElementById('modal-body');

            title.textContent = `ÂÖ≥Á≥ªÁ±ªÂûãËØ¶ÊÉÖ: ${relationType}`;

            // Êü•ÊâæËØ•ÂÖ≥Á≥ªÁ±ªÂûãÁöÑÊâÄÊúâËæπ
            const relatedEdges = knowledgeGraph.E_core.filter(edge => 
                edge.relation_type === relationType
            );

            // ÁªüËÆ°‰ø°ÊÅØ
            const triangulatedCount = relatedEdges.filter(edge => 
                edge.edge_hierarchy === 'triangulated_verified'
            ).length;
            const directCount = relatedEdges.filter(edge => edge.is_direct).length;

            body.innerHTML = `
                <div class="parameter-section">
                    <div class="parameter-title">üè∑Ô∏è ÂÖ≥Á≥ªÁªüËÆ°</div>
                    <div class="parameter-content">
                        <div><strong>ÂÖ≥Á≥ªÁ±ªÂûã:</strong> <span class="relation-badge ${relationType}">${relationType}</span></div>
                        <div><strong>ÊÄªËæπÊï∞:</strong> ${relatedEdges.length}</div>
                        <div><strong>‰∏âËßíÈ™åËØÅËæπÊï∞:</strong> ${triangulatedCount}</div>
                        <div><strong>Áõ¥Êé•ÂÖ≥Á≥ªËæπÊï∞:</strong> ${directCount}</div>
                        <div><strong>È™åËØÅÁéá:</strong> ${((triangulatedCount / relatedEdges.length) * 100).toFixed(1)}%</div>
                    </div>
                </div>
                
                <div class="parameter-section">
                    <div class="parameter-title">üîó Áõ∏ÂÖ≥ËæπÂàóË°®</div>
                    <div class="parameter-content">
                        ${relatedEdges.slice(0, 20).map(edge => `
                            <div style="margin-bottom: 8px; padding: 8px; background: white; border-radius: 5px; border-left: 3px solid ${getEdgeColor(edge.relation_type)};">
                                <strong>${edge.source} ‚Üí ${edge.target}</strong><br>
                                <small>Â±ÇÊ¨°: ${edge.edge_hierarchy} | Áõ¥Êé•: ${edge.is_direct ? 'ÊòØ' : 'Âê¶'}</small>
                            </div>
                        `).join('')}
                        ${relatedEdges.length > 20 ? `<div style="text-align: center; color: #666; margin-top: 10px;">... ËøòÊúâ ${relatedEdges.length - 20} Êù°Ëæπ</div>` : ''}
                    </div>
                </div>
            `;

            modal.style.display = 'flex';
        }

        // ËÆæÁΩÆÊêúÁ¥¢ÁõëÂê¨Âô®
        function setupSearchListeners() {
            // ËäÇÁÇπÊêúÁ¥¢
            document.getElementById('vertices-search').addEventListener('input', function(e) {
                const query = e.target.value.toLowerCase();
                const items = document.querySelectorAll('#vertices-list .vertex-item');
                
                items.forEach(item => {
                    const title = item.querySelector('.item-title').textContent.toLowerCase();
                    item.style.display = title.includes(query) ? 'block' : 'none';
                });
            });

            // ËæπÊêúÁ¥¢
            document.getElementById('edges-search').addEventListener('input', function(e) {
                const query = e.target.value.toLowerCase();
                const items = document.querySelectorAll('#edges-list .edge-item');
                
                items.forEach(item => {
                    const title = item.querySelector('.item-title').textContent.toLowerCase();
                    item.style.display = title.includes(query) ? 'block' : 'none';
                });
            });

            // ÊùÉÈáçÊêúÁ¥¢
            document.getElementById('weights-search').addEventListener('input', function(e) {
                const query = e.target.value.toLowerCase();
                const items = document.querySelectorAll('#weights-list .list-item');
                
                items.forEach(item => {
                    const title = item.querySelector('.item-title').textContent.toLowerCase();
                    item.style.display = title.includes(query) ? 'block' : 'none';
                });
            });

            // ‰∏≠‰ªãÊïàÂ∫îÊêúÁ¥¢
            document.getElementById('mediation-search').addEventListener('input', function(e) {
                const query = e.target.value.toLowerCase();
                const items = document.querySelectorAll('#mediation-list .list-item');
                
                items.forEach(item => {
                    const title = item.querySelector('.item-title').textContent.toLowerCase();
                    item.style.display = title.includes(query) ? 'block' : 'none';
                });
            });

            // Ë∑ØÂæÑÊêúÁ¥¢
            document.getElementById('pathways-search').addEventListener('input', function(e) {
                const query = e.target.value.toLowerCase();
                const items = document.querySelectorAll('#pathways-list .list-item');
                
                items.forEach(item => {
                    const title = item.querySelector('.item-title').textContent.toLowerCase();
                    item.style.display = title.includes(query) ? 'block' : 'none';
                });
            });
        }

        // ËÆæÁΩÆÁ≠õÈÄâÁõëÂê¨Âô®
        function setupFilterListeners() {
            // ËäÇÁÇπÁ±ªÂûãÁ≠õÈÄâ
            document.getElementById('vertex-type-filters').addEventListener('click', function(e) {
                if (e.target.classList.contains('filter-option')) {
                    // Êõ¥Êñ∞Á≠õÈÄâÂô®Áä∂ÊÄÅ
                    this.querySelectorAll('.filter-option').forEach(opt => opt.classList.remove('active'));
                    e.target.classList.add('active');
                    
                    const filterType = e.target.dataset.type;
                    currentFilter.vertices.type = filterType;
                    
                    // Â∫îÁî®Á≠õÈÄâ
                    const items = document.querySelectorAll('#vertices-list .vertex-item');
                    items.forEach(item => {
                        const itemType = item.dataset.type;
                        const shouldShow = filterType === 'all' || itemType === filterType;
                        item.style.display = shouldShow ? 'block' : 'none';
                    });
                }
            });

            // ËæπÂ±ÇÊ¨°Á≠õÈÄâ
            document.getElementById('edge-hierarchy-filters').addEventListener('click', function(e) {
                if (e.target.classList.contains('filter-option')) {
                    this.querySelectorAll('.filter-option').forEach(opt => opt.classList.remove('active'));
                    e.target.classList.add('active');
                    
                    const filterHierarchy = e.target.dataset.hierarchy;
                    currentFilter.edges.hierarchy = filterHierarchy;
                    applyEdgeFilters();
                }
            });

            // ËæπÂÖ≥Á≥ªÁ±ªÂûãÁ≠õÈÄâ
            document.getElementById('edge-relation-filters').addEventListener('click', function(e) {
                if (e.target.classList.contains('filter-option')) {
                    this.querySelectorAll('.filter-option').forEach(opt => opt.classList.remove('active'));
                    e.target.classList.add('active');
                    
                    const filterRelation = e.target.dataset.relation;
                    currentFilter.edges.relation = filterRelation;
                    applyEdgeFilters();
                }
            });
        }

        // Â∫îÁî®ËæπÁ≠õÈÄâ
        function applyEdgeFilters() {
            const items = document.querySelectorAll('#edges-list .edge-item');
            items.forEach(item => {
                const itemHierarchy = item.dataset.hierarchy;
                const itemRelation = item.dataset.relation;
                
                const hierarchyMatch = currentFilter.edges.hierarchy === 'all' || 
                                     itemHierarchy === currentFilter.edges.hierarchy;
                const relationMatch = currentFilter.edges.relation === 'all' || 
                                    itemRelation === currentFilter.edges.relation;
                
                const shouldShow = hierarchyMatch && relationMatch;
                item.style.display = shouldShow ? 'block' : 'none';
            });
        }

        // ÊòæÁ§∫ËæπËØ¶ÊÉÖ
        function showEdgeWeightDetails(link) {
            const modal = document.getElementById('detail-modal');
            const title = document.getElementById('modal-title');
            const body = document.getElementById('modal-body');

            title.textContent = `ËæπËØ¶ÊÉÖ: ${link.source} ‚Üí ${link.target}`;

            body.innerHTML = `
                <div class="parameter-section">
                    <div class="parameter-title">üîó ËæπÂü∫Êú¨‰ø°ÊÅØ</div>
                    <div class="parameter-content">
                        <div><strong>Ê∫êËäÇÁÇπ:</strong> ${link.source}</div>
                        <div><strong>ÁõÆÊ†áËäÇÁÇπ:</strong> ${link.target}</div>
                        <div><strong>ÂÖ≥Á≥ªÁ±ªÂûã:</strong> <span class="relation-badge ${link.relation}">${link.relation}</span></div>
                        <div><strong>ËæπÂ±ÇÁ∫ß:</strong> <span class="hierarchy-badge ${link.hierarchy}">${link.hierarchy === 'triangulated_verified' ? '‰∏âËßíÈ™åËØÅËæπ' : 'ÂÄôÈÄâËæπ'}</span></div>
                    </div>
                </div>
            `;
            
            modal.style.display = 'flex';
        }

        // ÊòæÁ§∫Ê®°ÊÄÅÊ°Ü
        function showModal(title, content) {
            const modal = document.getElementById('detail-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalBody = document.getElementById('modal-body');
            
            modalTitle.textContent = title;
            modalBody.innerHTML = content;
            modal.style.display = 'flex';
        }

        // ÂÖ≥Èó≠Ê®°ÊÄÅÊ°Ü
        function closeModal() {
            document.getElementById('detail-modal').style.display = 'none';
        }

        // ÈáçÁΩÆÂõæË∞±ËßÜÂõæ
        function resetGraph() {
            if (graphInstance) {
                graphInstance.zoomToFit(400);
            }
        }

        // ÂàáÊç¢Áâ©ÁêÜÂºïÊìé
        function togglePhysics() {
            if (graphInstance) {
                const currentEngine = graphInstance.d3Force('charge');
                if (currentEngine) {
                    graphInstance.d3Force('charge', null);
                } else {
                    graphInstance.d3Force('charge', d3.forceManyBody().strength(-300));
                }
            }
        }

        // ÂØºÂá∫ÂõæÁâá
        function exportGraph() {
            if (graphInstance) {
                // ÂàõÂª∫canvasÂπ∂ÂØºÂá∫
                const canvas = document.querySelector('#graph-viz canvas');
                if (canvas) {
                    const link = document.createElement('a');
                    link.download = 'Áü•ËØÜÂõæË∞±.png';
                    link.href = canvas.toDataURL();
                    link.click();
                }
            }
        }

        // ËÆ°ÁÆóËäÇÁÇπÂΩ±ÂìçÂäõÊåáÊ†á
        function calculateNodeInfluence(vertexId, allEdges, relatedWeights) {
            const totalConnections = allEdges.length;
            const totalWeight = relatedWeights.reduce((sum, w) => sum + (w.data.hierarchy_weight?.final_weight || 0), 0);
            const avgWeight = totalConnections > 0 ? totalWeight / totalConnections : 0;
            
            // ËÆ°ÁÆó‰∏≠ÂøÉÊÄßÔºàÂü∫‰∫éËøûÊé•Êï∞ÂíåÊùÉÈáçÔºâ
            const centrality = totalConnections > 0 ? (totalConnections * avgWeight) / 100 : 0;
            
            // ËÆ°ÁÆóÂΩ±ÂìçÂäõËØÑÂàÜÔºà0-1‰πãÈó¥Ôºâ
            const maxConnections = Math.max(1, totalConnections);
            const score = Math.min(1, (centrality + avgWeight) / 2);
            
            return {
                score: score,
                centrality: centrality,
                totalWeight: totalWeight,
                avgWeight: avgWeight
            };
        }

        // Ëé∑ÂèñÂõ†ÊûúË∑ØÂæÑ‰ø°ÊÅØ
        function getCausalPaths(vertexId, edges) {
            const asSource = edges.filter(e => e.source === vertexId).length;
            const asTarget = edges.filter(e => e.target === vertexId).length;
            
            // ÁÆÄÂçï‰º∞ÁÆó‰Ωú‰∏∫‰∏≠‰ªãËäÇÁÇπÁöÑË∑ØÂæÑÊï∞
            const asMediator = Math.min(asSource, asTarget);
            
            // ËÆ°ÁÆóÊúÄÈïøË∑ØÂæÑÈïøÂ∫¶ÔºàÁÆÄÂåñÁâàÊú¨Ôºâ
            const maxPathLength = Math.max(asSource, asTarget, 1);
            
            // Á°ÆÂÆöÂ§çÊùÇÂ∫¶Á≠âÁ∫ß
            let complexity = 'Simple';
            if (asSource + asTarget > 10) complexity = 'Complex';
            else if (asSource + asTarget > 5) complexity = 'Moderate';
            
            return {
                asSource: asSource,
                asTarget: asTarget,
                asMediator: asMediator,
                maxPathLength: maxPathLength,
                complexity: complexity
            };
        }

        // ËÆ°ÁÆóËäÇÁÇπÁ®≥ÂÆöÊÄßÊåáÊ†á
        function calculateNodeStability(vertexId, relatedWeights, relatedTheta) {
            // ÊùÉÈáçÁ®≥ÂÆöÊÄß
            const weights = relatedWeights.map(w => w.data.hierarchy_weight?.final_weight || 0);
            const weightMean = weights.length > 0 ? weights.reduce((a, b) => a + b, 0) / weights.length : 0;
            const weightStd = weights.length > 1 ? Math.sqrt(weights.reduce((sum, w) => sum + Math.pow(w - weightMean, 2), 0) / weights.length) : 0;
            const weightStability = weightMean > 0 ? Math.max(0, 1 - (weightStd / weightMean)) : 0;
            
            // ÂèÇÊï∞Á®≥ÂÆöÊÄßÔºàÂü∫‰∫éThetaÊï∞ÊçÆÔºâ
            let paramStability = 0.5; // ÈªòËÆ§ÂÄº
            if (relatedTheta.length > 0) {
                const stabilityScores = relatedTheta.map(t => t.data.parameter_stability?.stability_score || 0.5);
                paramStability = stabilityScores.reduce((a, b) => a + b, 0) / stabilityScores.length;
            }
            
            // ÂèòÂºÇÁ≥ªÊï∞
            const coefficientOfVariation = weightMean > 0 ? weightStd / weightMean : 0;
            
            // Á®≥ÂÆöÊÄßÁ≠âÁ∫ß
            const avgStability = (weightStability + paramStability) / 2;
            let level = 'Low';
            if (avgStability > 0.8) level = 'High';
            else if (avgStability > 0.6) level = 'Medium';
            
            return {
                weightStability: weightStability,
                paramStability: paramStability,
                coefficientOfVariation: coefficientOfVariation,
                level: level
            };
        }

        // È´ò‰∫ÆÈÇªÂ±ÖËäÇÁÇπ
        function highlightNeighbors(vertexId, direction) {
            if (!graphInstance) return;
            
            const edges = knowledgeGraph.E_core;
            let neighborIds = [];
            
            if (direction === 'incoming') {
                neighborIds = edges.filter(e => e.target === vertexId).map(e => e.source);
            } else if (direction === 'outgoing') {
                neighborIds = edges.filter(e => e.source === vertexId).map(e => e.target);
            }
            
            // È´ò‰∫ÆÊòæÁ§∫ÈÇªÂ±ÖËäÇÁÇπÔºàËøôÈáåÈúÄË¶ÅÊ†πÊçÆÂÆûÈôÖÁöÑÂõæÂΩ¢Â∫ìAPIË∞ÉÊï¥Ôºâ
            console.log(`È´ò‰∫ÆÊòæÁ§∫ ${vertexId} ÁöÑ ${direction} ÈÇªÂ±Ö:`, neighborIds);
        }

        // ËÅöÁÑ¶ËäÇÁÇπ
        function focusOnNode(vertexId) {
            if (graphInstance) {
                // ËøôÈáåÈúÄË¶ÅÊ†πÊçÆÂÆûÈôÖÁöÑÂõæÂΩ¢Â∫ìAPIË∞ÉÊï¥
                console.log(`ËÅöÁÑ¶ËäÇÁÇπ: ${vertexId}`);
            }
        }

        // ÊòæÁ§∫ËäÇÁÇπÂ≠êÂõæ
        function showNodeSubgraph(vertexId) {
            console.log(`ÊòæÁ§∫ ${vertexId} ÁöÑÂ≠êÂõæ`);
        }

        // ÂØºÂá∫ËäÇÁÇπÊï∞ÊçÆ
        function exportNodeData(vertexId) {
            const nodeData = {
                id: vertexId,
                edges: knowledgeGraph.E_core.filter(e => e.source === vertexId || e.target === vertexId),
                weights: knowledgeGraph.W ? Object.entries(knowledgeGraph.W).filter(([key, data]) => key.includes(vertexId)) : [],
                theta: knowledgeGraph.Theta ? Object.entries(knowledgeGraph.Theta).filter(([key, data]) => key.includes(vertexId)) : [],
                phi: knowledgeGraph.Phi ? Object.entries(knowledgeGraph.Phi).filter(([key, data]) => key.includes(vertexId)) : []
            };
            
            const dataStr = JSON.stringify(nodeData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `node_${vertexId}_data.json`;
            link.click();
            URL.revokeObjectURL(url);
        }

        // ÂàÜÊûêËäÇÁÇπÂõ†ÊûúÂÖ≥Á≥ª
        function analyzeNodeCausality(vertexId) {
            console.log(`ÂàÜÊûê ${vertexId} ÁöÑÂõ†ÊûúÂÖ≥Á≥ª`);
            // ËøôÈáåÂèØ‰ª•Ê∑ªÂä†Êõ¥Â§çÊùÇÁöÑÂõ†ÊûúÂàÜÊûêÈÄªËæë
        }

        // ÊòæÁ§∫ÈîôËØØ‰ø°ÊÅØ
        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #ff6b6b;
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                z-index: 3000;
                font-size: 14px;
            `;
            errorDiv.textContent = message;
            document.body.appendChild(errorDiv);
            
            setTimeout(() => {
                document.body.removeChild(errorDiv);
            }, 5000);
        }

        // Á™óÂè£Â§ßÂ∞èË∞ÉÊï¥
        window.addEventListener('resize', function() {
            if (graphInstance) {
                const container = document.getElementById('graph-viz');
                graphInstance
                    .width(container.clientWidth)
                    .height(container.clientHeight);
            }
        });

        // ÂõæË∞±ÊéßÂà∂ÂáΩÊï∞
        function resetGraph() {
            if (graphInstance) {
                // ÈáçÁΩÆÂõæË∞±ËßÜÂõæ
                graphInstance.zoomToFit(400);
                console.log('ÂõæË∞±ËßÜÂõæÂ∑≤ÈáçÁΩÆ');
            }
        }

        function togglePhysics() {
            if (graphInstance) {
                // ÂàáÊç¢Áâ©ÁêÜÂºïÊìéÔºàËøôÈáåÈúÄË¶ÅÊ†πÊçÆÂÆûÈôÖ‰ΩøÁî®ÁöÑÂõæÂΩ¢Â∫ìË∞ÉÊï¥Ôºâ
                console.log('ÂàáÊç¢Áâ©ÁêÜÂºïÊìé');
            }
        }

        function exportGraph() {
            if (graphInstance) {
                // ÂØºÂá∫ÂõæÁâáÔºàËøôÈáåÈúÄË¶ÅÊ†πÊçÆÂÆûÈôÖ‰ΩøÁî®ÁöÑÂõæÂΩ¢Â∫ìË∞ÉÊï¥Ôºâ
                console.log('ÂØºÂá∫ÂõæË∞±');
            }
        }

        // ‰∏≠‰ªãÊïàÂ∫îÂèØËßÜÂåñÁõ∏ÂÖ≥ÂèòÈáè
        let mediationVisualizationActive = false;
        let originalNodeColors = new Map();
        let originalEdgeColors = new Map();

        // ÂàáÊç¢‰∏≠‰ªãÊïàÂ∫îÂèØËßÜÂåñ
        function toggleMediationVisualization() {
            const btn = document.querySelector('.control-btn.mediation-btn');
            const legend = document.getElementById('mediation-legend');
            
            mediationVisualizationActive = !mediationVisualizationActive;
            
            if (mediationVisualizationActive) {
                btn.classList.add('active');
                legend.style.display = 'block';
                applyMediationVisualization();
                console.log('‰∏≠‰ªãÊïàÂ∫îÂèØËßÜÂåñÂ∑≤ÂêØÁî®');
            } else {
                btn.classList.remove('active');
                legend.style.display = 'none';
                resetMediationVisualization();
                console.log('‰∏≠‰ªãÊïàÂ∫îÂèØËßÜÂåñÂ∑≤Á¶ÅÁî®');
            }
        }

        // Â∫îÁî®‰∏≠‰ªãÊïàÂ∫îÂèØËßÜÂåñ
        function applyMediationVisualization() {
            if (!knowledgeGraph || !knowledgeGraph.W) {
                showError('Ê≤°ÊúâÂèØÁî®ÁöÑÊùÉÈáçÊï∞ÊçÆ');
                return;
            }

            // ‰øùÂ≠òÂéüÂßãÈ¢úËâ≤
            saveOriginalColors();

            let mediationCount = 0;
            
            // Ê†πÊçÆ‰∏≠‰ªãÊïàÂ∫îÂº∫Â∫¶‰∏∫ËäÇÁÇπÂíåËæπÁùÄËâ≤
            Object.entries(knowledgeGraph.W).forEach(([edgeKey, weightData]) => {
                // Ê£ÄÊü•ÊòØÂê¶Êúâ‰∏âËßíÊµãÈáèÊùÉÈáçÂíå‰∏≠‰ªãÊîØÊåÅÊï∞ÊçÆ
                if (weightData.triangulation_weights && 
                    weightData.triangulation_weights.four_dimension_scores &&
                    weightData.triangulation_weights.four_dimension_scores.mediation_support) {
                    
                    const mediationSupport = weightData.triangulation_weights.four_dimension_scores.mediation_support;
                    const strength = Math.abs(mediationSupport);
                    const color = getMediationColor(strength);
                    
                    // Ëß£ÊûêËæπÁöÑÊ∫êÂíåÁõÆÊ†áËäÇÁÇπ
                    const [source, target] = edgeKey.split('->');
                    if (source && target) {
                        // ‰∏∫Áõ∏ÂÖ≥ËäÇÁÇπÂíåËæπÁùÄËâ≤
                        colorNodeByMediation(source, color);
                        colorNodeByMediation(target, color);
                        colorEdgeByMediation(source, target, color);
                        mediationCount++;
                    }
                }
            });

            console.log(`Â∫îÁî®‰∫Ü ${mediationCount} ‰∏™‰∏≠‰ªãÊïàÂ∫îÂèØËßÜÂåñ`);
            
            if (mediationCount === 0) {
                showError('Êú™ÊâæÂà∞ÊúâÊïàÁöÑ‰∏≠‰ªãÊïàÂ∫îÊï∞ÊçÆ');
            }
        }

        // ÈáçÁΩÆ‰∏≠‰ªãÊïàÂ∫îÂèØËßÜÂåñ
        function resetMediationVisualization() {
            // ÊÅ¢Â§çÂéüÂßãÈ¢úËâ≤
            restoreOriginalColors();
        }

        // ÊòæÁ§∫‰∏≠‰ªãË∑ØÂæÑ
        function showMediationPaths() {
            if (!knowledgeGraph || !knowledgeGraph.W) {
                showError('Ê≤°ÊúâÂèØÁî®ÁöÑÊùÉÈáçÊï∞ÊçÆ');
                return;
            }

            // Êî∂ÈõÜÊâÄÊúâ‰∏≠‰ªãË∑ØÂæÑ
            const paths = [];
            Object.entries(knowledgeGraph.W).forEach(([edgeKey, weightData]) => {
                // Ê£ÄÊü•ÊòØÂê¶Êúâ‰∏âËßíÊµãÈáèÊùÉÈáçÂíå‰∏≠‰ªãÊîØÊåÅÊï∞ÊçÆ
                if (weightData.triangulation_weights && 
                    weightData.triangulation_weights.four_dimension_scores &&
                    weightData.triangulation_weights.four_dimension_scores.mediation_support) {
                    
                    const mediationSupport = weightData.triangulation_weights.four_dimension_scores.mediation_support;
                    const [source, target] = edgeKey.split('->');
                    
                    if (source && target) {
                        paths.push({
                            path: `${source} ‚Üí ${target}`,
                            effect: mediationSupport,
                            significance: mediationSupport > 0.5 ? 'Âº∫ÊïàÂ∫î' : mediationSupport > 0.2 ? '‰∏≠Á≠âÊïàÂ∫î' : 'Âº±ÊïàÂ∫î',
                            confidence: weightData.triangulation_weights.joint_confidence || 'N/A'
                        });
                    }
                }
            });

            if (paths.length === 0) {
                showError('Êú™ÊâæÂà∞‰∏≠‰ªãË∑ØÂæÑÊï∞ÊçÆ');
                return;
            }

            // ÊåâÊïàÂ∫îÂº∫Â∫¶ÊéíÂ∫è
            paths.sort((a, b) => Math.abs(b.effect) - Math.abs(a.effect));

            // ÊòæÁ§∫Ë∑ØÂæÑÂàóË°®
            showMediationPathsModal(paths);
        }

        // Á™ÅÂá∫ÊòæÁ§∫Âº∫ÊïàÂ∫î
        function highlightStrongEffects() {
            if (!knowledgeGraph || !knowledgeGraph.W) {
                showError('Ê≤°ÊúâÂèØÁî®ÁöÑÊùÉÈáçÊï∞ÊçÆ');
                return;
            }

            const strongEffects = [];
            Object.entries(knowledgeGraph.W).forEach(([edgeKey, weightData]) => {
                // Ê£ÄÊü•ÊòØÂê¶Êúâ‰∏âËßíÊµãÈáèÊùÉÈáçÂíå‰∏≠‰ªãÊîØÊåÅÊï∞ÊçÆ
                if (weightData.triangulation_weights && 
                    weightData.triangulation_weights.four_dimension_scores &&
                    weightData.triangulation_weights.four_dimension_scores.mediation_support) {
                    
                    const mediationSupport = weightData.triangulation_weights.four_dimension_scores.mediation_support;
                    
                    // Âè™ÈÄâÊã©Âº∫ÊïàÂ∫î (> 0.5)
                    if (Math.abs(mediationSupport) > 0.5) {
                        const [source, target] = edgeKey.split('->');
                        if (source && target) {
                            strongEffects.push({
                                key: edgeKey,
                                effect: mediationSupport,
                                source: source,
                                target: target,
                                data: weightData
                            });
                        }
                    }
                }
            });

            if (strongEffects.length === 0) {
                showError('Ê≤°ÊúâÊâæÂà∞Âº∫‰∏≠‰ªãÊïàÂ∫î (|ÊïàÂ∫îÂÄº| > 0.5)');
                return;
            }

            // È´ò‰∫ÆÊòæÁ§∫Âº∫ÊïàÂ∫î
            highlightStrongEffectsInGraph(strongEffects);
            
            // ÊòæÁ§∫Âº∫ÊïàÂ∫îËØ¶ÁªÜ‰ø°ÊÅØ
            showStrongEffectsModal(strongEffects);
            
            console.log(`ÊâæÂà∞ ${strongEffects.length} ‰∏™Âº∫‰∏≠‰ªãÊïàÂ∫î`);
        }

        // ËæÖÂä©ÂáΩÊï∞ÔºöËé∑Âèñ‰∏≠‰ªãÊïàÂ∫îÈ¢úËâ≤
        function getMediationColor(strength) {
            if (strength > 0.5) {
                return '#ff6b6b'; // Âº∫ÊïàÂ∫î - Á∫¢Ëâ≤
            } else if (strength > 0.2) {
                return '#feca57'; // ‰∏≠Á≠âÊïàÂ∫î - ÈªÑËâ≤
            } else {
                return '#48dbfb'; // Âº±ÊïàÂ∫î - ËìùËâ≤
            }
        }

        // ËæÖÂä©ÂáΩÊï∞ÔºöËß£ÊûêPhiÈîÆÂÄº
        function parsePhiKey(key) {
            // ÂÅáËÆæÈîÆÊ†ºÂºè‰∏∫ "source_mediator_target" ÊàñÁ±ª‰ººÊ†ºÂºè
            const parts = key.split('_');
            if (parts.length >= 3) {
                return {
                    source: parts[0],
                    mediator: parts[1],
                    target: parts[2]
                };
            }
            return null;
        }

        // ËæÖÂä©ÂáΩÊï∞Ôºö‰øùÂ≠òÂéüÂßãÈ¢úËâ≤
        function saveOriginalColors() {
            // ËøôÈáåÈúÄË¶ÅÊ†πÊçÆÂÆûÈôÖ‰ΩøÁî®ÁöÑÂõæÂΩ¢Â∫ìÊù•ÂÆûÁé∞
            console.log('‰øùÂ≠òÂéüÂßãËäÇÁÇπÂíåËæπÁöÑÈ¢úËâ≤');
        }

        // ËæÖÂä©ÂáΩÊï∞ÔºöÊÅ¢Â§çÂéüÂßãÈ¢úËâ≤
        function restoreOriginalColors() {
            // ËøôÈáåÈúÄË¶ÅÊ†πÊçÆÂÆûÈôÖ‰ΩøÁî®ÁöÑÂõæÂΩ¢Â∫ìÊù•ÂÆûÁé∞
            console.log('ÊÅ¢Â§çÂéüÂßãËäÇÁÇπÂíåËæπÁöÑÈ¢úËâ≤');
        }

        // ËæÖÂä©ÂáΩÊï∞Ôºö‰∏∫ËäÇÁÇπÁùÄËâ≤
        function colorNodeByMediation(nodeId, color) {
            // ËøôÈáåÈúÄË¶ÅÊ†πÊçÆÂÆûÈôÖ‰ΩøÁî®ÁöÑÂõæÂΩ¢Â∫ìÊù•ÂÆûÁé∞
            console.log(`‰∏∫ËäÇÁÇπ ${nodeId} ÁùÄËâ≤: ${color}`);
        }

        // ËæÖÂä©ÂáΩÊï∞Ôºö‰∏∫ËæπÁùÄËâ≤
        function colorEdgeByMediation(sourceId, targetId, color) {
            // ËøôÈáåÈúÄË¶ÅÊ†πÊçÆÂÆûÈôÖ‰ΩøÁî®ÁöÑÂõæÂΩ¢Â∫ìÊù•ÂÆûÁé∞
            console.log(`‰∏∫Ëæπ ${sourceId} ‚Üí ${targetId} ÁùÄËâ≤: ${color}`);
        }

        // ÊòæÁ§∫‰∏≠‰ªãË∑ØÂæÑÊ®°ÊÄÅÊ°Ü
        function showMediationPathsModal(paths) {
            const modal = document.getElementById('detail-modal');
            const title = document.getElementById('modal-title');
            const body = document.getElementById('modal-body');

            title.textContent = '‰∏≠‰ªãË∑ØÂæÑÂàÜÊûê';
            
            body.innerHTML = `
                <div class="parameter-section">
                    <div class="parameter-title">üõ§Ô∏è ‰∏≠‰ªãË∑ØÂæÑÂàóË°®</div>
                    <div class="parameter-content">
                        <div style="margin-bottom: 15px;">
                            <strong>ÊÄªË∑ØÂæÑÊï∞:</strong> ${paths.length}
                        </div>
                        <div class="paths-list" style="max-height: 400px; overflow-y: auto;">
                            ${paths.map((path, index) => `
                                <div class="path-item" style="background: white; padding: 12px; margin: 8px 0; border-radius: 6px; border-left: 4px solid ${getMediationColor(Math.abs(path.effect))};">
                                    <div style="font-weight: bold; margin-bottom: 5px;">${path.path}</div>
                                    <div style="font-size: 12px; color: #666;">
                                        <span>Èó¥Êé•ÊïàÂ∫î: <strong style="color: ${path.effect > 0 ? '#28a745' : '#dc3545'};">${path.effect.toFixed(4)}</strong></span>
                                        <span style="margin-left: 15px;">ÊòæËëóÊÄß: <strong>${path.significance}</strong></span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;

            modal.style.display = 'flex';
        }

        // È´ò‰∫ÆÊòæÁ§∫Âº∫ÊïàÂ∫î
        function highlightStrongEffectsInGraph(strongEffects) {
            // ‰øùÂ≠òÂéüÂßãÈ¢úËâ≤
            saveOriginalColors();
            
            // ‰∏∫Âº∫ÊïàÂ∫îËæπÂíåËäÇÁÇπÁùÄËâ≤
            strongEffects.forEach(effect => {
                const color = '#ff6b6b'; // Âº∫ÊïàÂ∫îÁî®Á∫¢Ëâ≤
                colorNodeByMediation(effect.source, color);
                colorNodeByMediation(effect.target, color);
                colorEdgeByMediation(effect.source, effect.target, color);
                
                console.log(`È´ò‰∫ÆÂº∫ÊïàÂ∫î: ${effect.source} ‚Üí ${effect.target}, ÊïàÂ∫îÂÄº: ${effect.effect.toFixed(4)}`);
            });
        }

        // ÊòæÁ§∫Âº∫ÊïàÂ∫îÊ®°ÊÄÅÊ°Ü
        function showStrongEffectsModal(strongEffects) {
            const modal = document.getElementById('detail-modal');
            const title = document.getElementById('modal-title');
            const body = document.getElementById('modal-body');

            title.textContent = 'Âº∫‰∏≠‰ªãÊïàÂ∫îÂàÜÊûê';
            
            body.innerHTML = `
                <div class="parameter-section">
                    <div class="parameter-title">‚ö° Âº∫‰∏≠‰ªãÊïàÂ∫îÂàóË°® (|ÊïàÂ∫îÂÄº| > 0.5)</div>
                    <div class="parameter-content">
                        <div style="margin-bottom: 15px;">
                            <strong>Âº∫ÊïàÂ∫îÊï∞Èáè:</strong> ${strongEffects.length}
                        </div>
                        <div class="effects-list" style="max-height: 400px; overflow-y: auto;">
                            ${strongEffects.map((effect, index) => {
                                const confidence = effect.data.triangulation_weights?.joint_confidence || 'N/A';
                                const structuralConsistency = effect.data.triangulation_weights?.four_dimension_scores?.structural_consistency || 'N/A';
                                
                                return `
                                    <div class="effect-item" style="background: white; padding: 12px; margin: 8px 0; border-radius: 6px; border-left: 4px solid ${getMediationColor(Math.abs(effect.effect))};">
                                        <div style="font-weight: bold; margin-bottom: 5px;">${effect.source} ‚Üí ${effect.target}</div>
                                        <div style="font-size: 12px; color: #666;">
                                            <span>‰∏≠‰ªãÊîØÊåÅ: <strong style="color: ${effect.effect > 0 ? '#28a745' : '#dc3545'};">${effect.effect.toFixed(4)}</strong></span>
                                            <span style="margin-left: 15px;">ÁΩÆ‰ø°Â∫¶: <strong>${typeof confidence === 'number' ? confidence.toFixed(4) : confidence}</strong></span>
                                        </div>
                                        <div style="font-size: 12px; color: #666; margin-top: 5px;">
                                            <span>ÁªìÊûÑ‰∏ÄËá¥ÊÄß: <strong>${typeof structuralConsistency === 'number' ? structuralConsistency.toFixed(4) : structuralConsistency}</strong></span>
                                            <span style="margin-left: 15px;">Âº∫Â∫¶: <strong>Âº∫ÊïàÂ∫î</strong></span>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                </div>
            `;

            modal.style.display = 'flex';
        }
    </script>

    <!-- Ê®°ÊÄÅÊ°Ü -->
    <div id="detail-modal" class="detail-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">ËØ¶ÁªÜ‰ø°ÊÅØ</h3>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div id="modal-body">
                <!-- Ê®°ÊÄÅÊ°ÜÂÜÖÂÆπÂ∞ÜÂú®ËøôÈáåÂä®ÊÄÅÊèíÂÖ• -->
            </div>
        </div>
    </div>
</body>
</html>