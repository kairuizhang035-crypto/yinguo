# 贝叶斯中介分析流程说明

## 概述

本文档详细说明了贝叶斯中介分析的完整流程，包括中介路径提取、贝叶斯中介效应分析以及统一运行脚本的使用方法。该分析流程基于因果发现结果，通过贝叶斯方法量化中介效应的强度和可信度。

## 分析流程架构

```
精简因果边列表.csv
        ↓
01提取完整中介路径.py
        ↓
01中介路径分析结果/
        ↓
02贝叶斯中介分析.py
        ↓
02贝叶斯中介分析结果/
```

## 核心脚本介绍

### 1. 01提取完整中介路径.py

**功能描述：**
- 从精简因果边列表中提取完整的中介路径（X→Z→Y形式）
- 分析中介路径的模式和分布
- 生成详细的中介路径报告

**输入文件：**
- `02因果发现/07候选因果边集合/精简因果边列表.csv`

**输出目录：**
- `01中介路径分析结果/`

**主要功能：**
- 构建因果图网络
- 识别所有可能的中介路径
- 分析路径长度分布
- 统计节点参与度
- 生成可视化图表

### 2. 02贝叶斯中介分析.py

**功能描述：**
- 基于提取的中介路径进行贝叶斯中介效应分析
- 量化直接效应、间接效应和总效应
- 计算效应的可信区间和显著性

**输入文件：**
- `01中介路径分析结果/完整中介路径结果.txt`
- `01数据预处理/缩减数据_规格.csv`

**输出目录：**
- `02贝叶斯中介分析结果/`

**主要功能：**
- 贝叶斯线性回归建模
- 中介效应计算
- 统计显著性检验
- 结果可视化

### 3. 03统一运行脚本.py

**功能描述：**
- 依次执行01和02脚本
- 提供详细的运行日志
- 错误处理和结果汇总

## 详细执行流程

### 第一步：中介路径提取

1. **数据读取**
   - 读取精简因果边列表
   - 解析因果关系数据

2. **网络构建**
   - 构建有向图网络
   - 识别节点和边的关系

3. **路径搜索**
   - 使用图遍历算法寻找中介路径
   - 过滤有效的X→Z→Y路径

4. **结果输出**
   - 生成中介路径列表
   - 创建汇总报告
   - 保存分析结果

### 第二步：贝叶斯中介分析

1. **数据准备**
   - 读取中介路径结果
   - 加载原始数据
   - 数据预处理和标准化

2. **模型构建**
   - 构建贝叶斯线性回归模型
   - 设置先验分布
   - 定义模型参数

3. **推断执行**
   - 使用MCMC采样
   - 计算后验分布
   - 评估模型收敛性

4. **效应计算**
   - 计算直接效应 (c')
   - 计算间接效应 (a×b)
   - 计算总效应 (c)
   - 计算中介比例

5. **统计检验**
   - 计算可信区间
   - 进行显著性检验
   - 评估效应强度

6. **结果输出**
   - 生成详细分析报告
   - 创建可视化图表
   - 保存所有结果

## 使用方法

### 方法一：使用统一运行脚本（推荐）

```bash
cd /home/zkr/因果发现/04贝叶斯中介分析
python 03统一运行脚本.py
```

### 方法二：分步执行

```bash
# 步骤1：提取中介路径
python 01提取完整中介路径.py

# 步骤2：贝叶斯中介分析
python 02贝叶斯中介分析.py
```

## 参数配置

### 中介路径提取参数
- **最大路径长度**：默认为3（X→Z→Y）
- **节点过滤**：可设置最小度数阈值
- **输出格式**：支持文本和CSV格式

### 贝叶斯分析参数
- **分析路径数量**：默认分析前10条路径（可调整）
- **MCMC采样数**：默认2000次
- **预热期**：默认1000次
- **先验强度**：默认1.0
- **可信水平**：默认95%

## 输出结果说明

### 01中介路径分析结果/
- `完整中介路径结果.txt`：所有识别的中介路径
- `中介路径汇总报告.txt`：路径统计和分析报告

### 02贝叶斯中介分析结果/
- `贝叶斯中介分析汇总.csv`：所有路径的分析结果
- `详细分析报告.txt`：详细的统计分析报告
- `中介效应可视化.png`：效应大小可视化图表
- `效应分布图.png`：效应分布直方图
- `各路径详细结果/`：每条路径的详细分析文件

## 技术规格

### 依赖库
- **数据处理**：pandas, numpy
- **统计分析**：scipy, statsmodels
- **贝叶斯推断**：pymc3 或 arviz
- **图形分析**：networkx
- **可视化**：matplotlib, seaborn

### 系统要求
- Python 3.7+
- 内存：建议8GB以上
- 存储：预留1GB空间用于结果存储

### 性能优化
- 默认限制分析路径数量以控制运行时间
- 支持并行计算（如果可用）
- 自动内存管理和垃圾回收

## 质量控制

### 数据验证
- 输入文件存在性检查
- 数据格式验证
- 缺失值处理

### 统计验证
- 模型收敛性检查
- 效应显著性验证
- 结果一致性检验

### 错误处理
- 详细的错误日志
- 异常情况处理
- 自动恢复机制

## 故障排除

### 常见问题

1. **文件路径错误**
   - 检查输入文件是否存在
   - 确认路径格式正确

2. **内存不足**
   - 减少分析路径数量
   - 增加系统内存

3. **模型不收敛**
   - 增加采样次数
   - 调整先验参数

4. **运行时间过长**
   - 限制分析路径数量
   - 使用并行计算

### 日志分析
- 查看运行日志了解详细执行过程
- 检查错误信息定位问题
- 使用调试模式获取更多信息

## 最佳实践

1. **数据准备**
   - 确保因果边数据质量
   - 检查数据完整性

2. **参数设置**
   - 根据数据规模调整分析参数
   - 平衡分析精度和运行时间

3. **结果解释**
   - 结合医学背景解释结果
   - 注意统计显著性和实际意义

4. **质量评估**
   - 检查模型诊断指标
   - 验证结果的稳定性

## 更新日志

- **v1.0**：初始版本，支持基础中介分析
- **v1.1**：优化性能，添加路径数量限制
- **v1.2**：改进错误处理和日志记录
- **v1.3**：增强可视化功能和报告生成

---

*本文档最后更新：2024年10月*